æˆ‘ä»¬å®Œæ•´åœ°æ­å»ºäº†æ‰©æ•£æ¨¡å‹çš„æ•´ä½“è¿è¡Œå¥—è·¯ã€‚å°½ç®¡èƒ½å¤Ÿç”Ÿæˆé«˜è´¨é‡çš„æ ·æœ¬ï¼Œä½†æ˜¯åŸºäºLangevin MCMC å’Œéšæœºå¾®åˆ†æ–¹ç¨‹SDEæ±‚è§£å™¨çš„é‡‡æ ·æ‰©æ•£æ­¥éª¤æå…¶ç¹é‡ï¼ˆéœ€è¦1000é€†æ‰©æ•£é‡‡æ ·ï¼‰ã€‚å…¶æ ¸å¿ƒç‚¹åœ¨äºå®ƒä»¬å¼•å…¥äº†â€œéšæœºå™ªå£°â€æˆ–â€œç»´çº³è¿‡ç¨‹â€ï¼Œå½¢æˆâ€œç›¸é‚»ä¸¤æ­¥å…·æœ‰ç›¸å…³æ€§ï¼Œä¸¤æ­¥ä»¥ä¸Šæ²¡æœ‰ç›¸å…³æ€§â€çš„é©¬å°”ç§‘å¤«é“¾ã€‚æˆ‘ä»¬ä¸èƒ½è·³æ­¥é‡‡æ ·ï¼Œå¿…é¡»å®Œæ•´å®Œæˆ1000æ­¥çš„é‡‡æ ·æ“ä½œã€‚è¿™æ ·çš„ç®—æ³•ç‰¹åˆ«æ…¢ï¼Œä¸å¤ªç¬¦åˆä½¿ç”¨è¦æ±‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»‹ç»ä¸€ç§åŸºäºæ¦‚ç‡æµçš„å¸¸å¾®åˆ†æ–¹ç¨‹ï¼ˆProbability flow ODEï¼‰çš„é‡‡æ ·æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥å®ç°å¿«é€Ÿåœ°è¿›è¡Œé‡‡æ ·è®¡ç®—ã€‚å› ä¸ºå®ƒåœ¨é‡‡æ ·æ—¶ç ´åäº†é©¬å°”å¯å¤«æ€§ï¼Œä»è€Œåœ¨å¤šæ­¥é—´çš„çŠ¶æ€å…·æœ‰ç›¸å…³è½¬æ¢å…¬å¼ï¼Œäº§ç”Ÿè·³æ­¥çš„å¯èƒ½æ€§ï¼Œå¤§å¤§åœ°åŠ å¿«äº†ç”Ÿæˆé‡‡æ ·ã€‚

> [!å¸¸å¾®åˆ†æ–¹ç¨‹ ODE]
â€ŒSDEï¼ˆéšæœºå¾®åˆ†æ–¹ç¨‹ï¼‰å’Œ ODEï¼ˆå¸¸å¾®åˆ†æ–¹ç¨‹ï¼‰åœ¨æè¿°ç³»ç»Ÿæ¼”åŒ–æ—¶çš„ä¸»è¦åŒºåˆ«åœ¨äºæ˜¯å¦åŒ…å«éšæœºé¡¹ã€‚éšæœºå¾®åˆ†æ–¹ç¨‹ SDE ä¸€è¯çš„é‡ç‚¹æ˜¯â€œéšæœºâ€ï¼Œæè¿°äº†ç³»ç»Ÿåœ¨éšæœºæ‰°åŠ¨ä¸‹çš„æ¼”åŒ–è¿‡ç¨‹ã€‚â€œéšæœºâ€çš„ä½“ç°æ˜¯å…¬å¼å…·æœ‰éšæœºé¡¹ï¼ˆè¿™é‡Œæ˜¯ç»´çº³è¿‡ç¨‹ï¼‰ï¼Œä¸€èˆ¬å½¢å¼ä¸º$\mathrm{d}x(t)=f(x,t)\mathrm{d}t + g(x,t)\mathrm{d}w$ã€‚å¸¸å¾®åˆ†æ–¹ç¨‹ ODE ä¸€è¯çš„é‡ç‚¹æ˜¯â€œå¸¸â€ï¼Œé€šå¸¸æè¿°äº†ç³»ç»Ÿåœ¨ç¡®å®šæ¡ä»¶ä¸‹çš„æ¼”åŒ–è¿‡ç¨‹ï¼Œä¸åŒ…å«éšæœºé¡¹ï¼Œç”¨äºæè¿°åœ¨ç»™å®šåˆå§‹æ¡ä»¶ä¸‹çš„ç³»ç»Ÿæ¼”åŒ–ï¼Œä¸€èˆ¬å½¢å¼ä¸º$\mathrm{d}x(t)=f(x,t)\mathrm{d}t$ã€‚å¦‚æœæŒ‰ç…§æˆ‘ä»¬åœ¨å¤§å­¦å­¦ä¹ è¿‡çš„ã€Šé«˜ç­‰æ•°å­¦ã€‹å½¢å¼æ¥æ ‡è®°ï¼Œæˆ‘ä»¬å¯ä»¥å°† ODE è®°ä½œ$y' = f(t)$çš„æç®€å½¢å¼ã€‚ä¸è®ºå¦‚ä½•æ ‡è®°ï¼Œæˆ‘ä»¬éƒ½ä¼šå‘è§‰çœ‹åˆ° ODE çš„å½¢å¼æ›´åŠ ç®€å•ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½ä½¿ç”¨è¿™ä¸ªå½¢å¼æ¥åšæ¨ç†å‘¢ï¼Ÿæˆ‘ä»¬é‡æ–°å›å¿†ä¸€ä¸‹SDEçš„å‰å‘è¿‡ç¨‹ï¼ˆä¼Šè—¤å…¬å¼ï¼‰æ˜¯ï¼š
$$\mathrm{d}x=f(x,t)\mathrm{d}t+g(t)\mathrm{d}w \tag{2.1.1}$$
å¯¹åº”çš„é€†æ‰©æ•£è¿‡ç¨‹SDEï¼ˆAndersonå…¬å¼ï¼Œ1982ï¼‰ä¸ºï¼š
$$\mathrm{d}x=[f(x,t)âˆ’g(t)^2 âˆ‡_x \log â¡p(x)]\mathrm{d}t+g(t)\mathrm{d}w \tag{2.1.2}$$ 
>å…¶ä¸­çš„Â $âˆ‡_x \log â¡p(x)$Â å³ç”¨ä»¥å‚æ•° $\theta$ ä»£è¡¨çš„ç¥ç»ç½‘ç»œÂ $s_Î¸(x)$Â åˆ†æ•°æ¨¡å‹æ¥æ‹Ÿåˆã€‚ç°åœ¨æˆ‘ä»¬è€ƒè™‘â€œé‡‡æ ·è¿‡ç¨‹èƒ½ä¸èƒ½ä¸è¦æœ‰è¿™ä¸ªéš¾ä»¥å¤„ç†çš„ç»´çº³è¿‡ç¨‹å‘¢ï¼Ÿâ€ç®€å•åœ°è®©ç»´çº³è¿‡ç¨‹å‰Â $g(t)=0$Â ï¼Œè®©SDEç›´æ¥é€€åŒ–æˆÂ $\mathrm{d}x=f(x,t)\mathrm{d}t$Â æ˜¯æ²¡æœ‰çš„é“ç†çš„ï¼Œå› æ­¤æˆ‘ä»¬åé¢é‡‡ç”¨å…¶ä»–çš„æ–¹å¼è¿›è¡Œæ¨ç†ã€‚

æœ¬æ–‡å†…å®¹ä¸»è¦æºäºã€ŠScore-Based Generative Modeling through Stochastic Differential Equationsã€‹
### 2.1.1 æ¦‚ç‡æµODEä¼˜åŒ–æ–¹æ³•

> [!Fokker-Planckæ–¹ç¨‹]
> 
>ç¦å…‹-æ™®æœ—å…‹æ–¹ç¨‹ï¼ˆFokkerâ€“Planck Equationï¼Œç®€ç§°FPæ–¹ç¨‹ï¼‰åŸæœ¬æè¿°ç²’å­åœ¨åŠ¿èƒ½åœºä¸­å—åˆ°éšæœºåŠ›åï¼Œéšæ—¶é—´æ¼”åŒ–çš„ä½ç½®æˆ–æ˜¯é€Ÿåº¦çš„åˆ†å¸ƒå‡½æ•° ã€‚åœ¨æˆ‘ä»¬è¿™é‡Œï¼ŒFPæ–¹ç¨‹æ˜¯ä¸€ç±»æè¿°éšæœºè¿‡ç¨‹åœ¨ç›¸ç©ºé—´ä¸­æ¦‚ç‡å¯†åº¦æ¼”åŒ–è§„å¾‹çš„åå¾®åˆ†æ–¹ç¨‹ã€‚ä¸SDEï¼ˆéšæœºå¾®åˆ†æ–¹ç¨‹ï¼‰ç›¸å¯¹åº”çš„ï¼ŒSDEæ–¹ç¨‹åŒ…å«äº†ä¸€ä¸ªç¡®å®šæ€§éƒ¨åˆ†å’Œä¸€ä¸ªéšæœºéƒ¨åˆ†ï¼Œè€ŒFPæ–¹ç¨‹åˆ™ä»æ¦‚ç‡è§’åº¦å‡ºå‘ï¼Œæè¿°äº†è¿™äº›éšæœºå˜é‡éšæ—¶é—´æ¼”åŒ–çš„æ¦‚ç‡å¯†åº¦ã€‚
>å¯¹äºdç»´çš„ä¼Šè—¤è¿‡ç¨‹ $\mathrm{d}x(t)=f(x,t)\mathrm{d}t + G(x,t)\mathrm{d}w,t = 1,2,...,d$ ï¼Œè¿™é‡Œæ˜¯ $G(x,t)$ å°±æ˜¯å‰é¢è¯´çš„ $g(t)$ ã€‚å…¶å®è¿™æ‰æ˜¯SDEçš„åŸå§‹æ ¼å¼ã€‚æˆ‘ä»¬ä¸ºäº†é…åˆå…¬å¼è€Œä½¿ç”¨ $G(x,t)$ åšæ ‡è®°ã€‚ç»™å‡ºè¯¥SDEå¯¹åº”çš„FPæ–¹ç¨‹ï¼Œå¦‚ä¸‹ï¼š
>$$\frac{\partial p_t(x)}{\partial t}= -\sum_{i=1}^{d} \frac{\partial}{\partial \mathbf{x}_i}[f_i(x,t)p_t(x)]+\frac{1}{2}\sum_{i=1}^{d}\sum_{j=1}^{d}\frac{\partial^2}{\partial \mathbf{x}_i\partial \mathbf{x}_j}[\sum_{k=1}^{d}G_{ik}(x,t)G_{jk}(x,t)p_t(x)]$$
>å…¶ä¸­ $p_t(ğ‘¥)$ æ˜¯ $Fx(t)$ï¼ˆå…¶ä¸­$Fx(t)$æ˜¯$\mathbf{x}_t$çš„å‡½æ•°å½¢å¼ï¼‰çš„æ¦‚ç‡å¯†åº¦åˆ†å¸ƒå‡½æ•°ã€‚è¿™é‡Œé¢ $x$ æ˜¯å‘é‡ï¼Œå…¶ä»– $x$ çš„å½¢å¼ï¼Œä¾‹å¦‚ $\mathbf{x}_i,\mathbf{x}_j$ç­‰æ˜¯æ ‡é‡ã€‚æˆ‘ä»¬åˆ©ç”¨ç¦å…‹-æ™®æœ—å…‹æ–¹ç¨‹æ¨ç†SDEï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç²—ç•¥åœ°æ¨å¯¼ä¸€ä¸‹ï¼Œæˆ‘ä»¬å…ˆçœ‹å…¬å¼ååŠæ®µï¼š
>$$\begin{align}
& \sum_{j=1}^{d}\frac{\partial}{\partial \mathbf{x}_j}[\sum_{k=1}^{d}G_{ik}(x,t)G_{jk}(x,t)p_t(x)] \tag{}\\
=& \sum_{j=1}^{d}\frac{\partial}{\partial \mathbf{x}_j}[\sum_{k=1}^{d}G_{ik}(x,t)G_{jk}(x,t)]p_t(x) + \sum_{j=1}^{d}\sum_{k=1}^{d}G_{ik}(x,t)G_{jk}(x,t)p_t(x)\frac{\partial}{\partial \mathbf{x}_j}p_t(x) \tag{}\\
=& p_t(x)\nabla\cdot [G(x,t)G(x,t)^T]+p_t(x)G(x,t)G(x,t)^T \nabla_x \log p_t(x) \tag{}
\end{align}$$
> è¿™é‡Œçš„ $G(x,t)$ æ˜¯çŸ©é˜µå½¢å¼ã€‚æ‰€ä»¥ç¦å…‹-æ™®æœ—å…‹æ–¹ç¨‹ä¸ºï¼š
> $$\begin{align}
\frac{\partial p_t(x)}{\partial t}&=-\sum_{i=1}^{d} \frac{\partial}{\partial \mathbf{x}_i}[f_i(x,t)p_t(x)]+\frac{1}{2}\sum_{i=1}^{d}\frac{\partial}{\partial \mathbf{x}_i}[\sum_{j=1}^{d}\frac{\partial}{\partial \mathbf{x}_j}[\sum_{k=1}^{d}g_{ik}(x,t)g_{jk}(x,t)p_t(x)]] \tag{}\\
&= -\sum_{i=1}^{d} \frac{\partial}{\partial \mathbf{x}_i}[f_i(x,t)p_t(x)]+\frac{1}{2}\sum_{i=1}^{d}\frac{\partial}{\partial \mathbf{x}_i}[p_t(x)\nabla\cdot (G(x,t)G(x,t)^T)+p_t(x)G(x,t)G(x,t)^T \nabla_x \log p_t(x)] \tag{}\\
&= -\sum_{i=1}^{d} \frac{\partial}{\partial \mathbf{x}_i}\big\{f_i(x,t)p_t(x)-\frac{1}{2}\big[\nabla\cdot [G(x,t)G(x,t)^T]+p_t(x)G(x,t)G(x,t)^T \nabla_x \log p_t(x)\big]p_t(x)\big\} \tag{}\\
&= -\sum_{i=1}^{d} \frac{\partial}{\partial \mathbf{x}_i}[\tilde{f}_i(x,t)p_t(x)] \tag{}
\end{align}$$
> è¿™é‡Œæˆ‘ä»¬å®šä¹‰
>$$\tilde{f}(x,t):= f(x,t)-\frac{1}{2}\nabla\cdot [G(x,t)G(x,t)^T] - \frac{1}{2}G(x,t)G(x,t)^T \nabla_x \log p_t(x)$$

æ ¹æ®Fokker planckæ–¹ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“ä¸SDEç›¸åŒè¾¹ç¼˜åˆ†å¸ƒåˆ†æ¦‚ç‡æµODEï¼ˆprobability flow ODEï¼ŒPF-ODEï¼‰å…¬å¼ä¸º
$$\mathrm{d}x=\big\{f(x,t)-\frac{1}{2}\nabla\cdot [G(x,t)G(x,t)^T] - \frac{1}{2}G(x,t)G(x,t)^T \nabla_x \log p_t(x) \big\}\mathrm{d}t \tag{2.1.3}$$
åœ¨æ‰©æ•£æ¨¡å‹SDEé‡Œé¢ $G(x,t)$ æ²¡æœ‰ $x$ï¼Œå…¬å¼ï¼ˆ2.1.3ï¼‰ä¸­çš„é¡¹ $\nabla[G(x,t)G(x,t)^T]=0$ ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨çš„PF-ODEï¼Œæ›´å¸¸å†™ä½œå¦‚ä¸‹å½¢å¼ï¼š
$$\mathrm{d}x=\big[f(x,t)- \frac{1}{2}g^2(t) \nabla_x \log p_t(x) \big]\mathrm{d}t \tag{2.1.4}$$
æ ¹æ®ä¸Šä¸€å•å…ƒ1.8çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯å¾—DDPMçš„ODEå…¬å¼å³ä¸ºï¼š
$$\mathrm{d}x=[-\frac{1}{2}F\beta(t)Fx(t) - \frac{1}{2} F\beta(t)\nabla_x \log p_t(x) \big]\mathrm{d}t \tag{2.1.5}$$

å®‹é£åšå£«å±•ç¤ºäº†PF-ODEå¾—åˆ°çš„è½¨è¿¹ï¼Œåœ¨æ¯ä¸ªæ—¶é—´ç‚¹ä¸Šå…·æœ‰ä¸ SDE è½¨è¿¹ç›¸åŒçš„è¾¹ç¼˜åˆ†å¸ƒã€‚SDEå’Œ PF-ODEåœ¨æŸç§æ„ä¹‰ä¸Šæ˜¯ç­‰ä»·çš„ã€‚ä½†ä¸¤è€…åœ¨æ‰©æ•£è¿‡ç¨‹ä¸­ä¹Ÿæœ‰ä¸€å®šåŒºåˆ«ï¼Œæ•´ä½“çš„æ‰©æ•£è¿‡ç¨‹è¯·çœ‹ä¸‹é¢çš„å›¾åƒï¼š

![](../images/2.1.png)

å›¾åƒä¸­ç™½è‰²å…‰æ»‘çš„çº¿å°±æ˜¯ä½¿ç”¨PF-ODEçš„ä½œä¸ºæ‰©æ•£è¿‡ç¨‹çš„è®°å½•ï¼Œå›¾åƒä¸­æ›²æŠ˜çš„çº¿å°±æ˜¯ä½¿ç”¨SDEä½œä¸ºæ‰©æ•£è¿‡ç¨‹çš„è®°å½•ã€‚åŒæ—¶ä¹Ÿä»ä¸€ä¸ªæ–¹é¢è¯æ˜äº†ï¼šè§£probability flow ODE å¾—åˆ°çš„è½¨è¿¹å…·æœ‰ä¸SDEè½¨è¿¹ç›¸åŒçš„è¾¹ç¼˜åˆ†å¸ƒã€‚
PF-ODEå¸¸å¾®åˆ†ç»™æˆ‘ä»¬ä¸€ä¸ªæƒŠå–œï¼å…¬å¼ï¼ˆ2.1.4ï¼‰ $\mathrm{d}x=\big[f(x,t)- \frac{1}{2}g^2(t) \nabla_x \log p_t(x) \big]\mathrm{d}t$ ä¸­å¹¶æ²¡æœ‰SDEä¸­æ‹¬å™ªå£°çš„ç»´çº³è¿‡ç¨‹çš„ $\mathrm{d}w$ ã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬å»æ‰äº†å„ä¸ªçŠ¶æ€çš„é©¬å°”å¯å¤«æ€§ï¼Œè®©ç›¸è·å¾ˆè¿œäº‹ä»¶æ­¥çš„çŠ¶æ€çªç„¶æœ‰äº†è”ç³»ã€‚ä½¿å¾—åŸå…ˆ1000æ­¥çš„é‡‡æ ·å¯ä»¥è·³æ­¥ï¼Œå˜ä¸ºå‡ åæ­¥çš„é‡‡æ ·ã€‚æ ¹æ®ODEçš„æ•´ä½“çš„æ€è·¯ï¼Œå¤§å¤§åœ°åŠ å¿«äº†ç”Ÿæˆé‡‡æ ·ï¼Œæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„é‡‡æ ·æ–¹æ³•ã€‚

> [!Warning]
>- **å¯èƒ½ç–‘é—®ç‚¹1ï¼šä¸ºä»€ä¹ˆå»æ‰ç»´çº³è¿‡ç¨‹çš„ $\mathrm{d}w$ ï¼Œå°±å»æ‰äº†å„ä¸ªçŠ¶æ€çš„é©¬å°”å¯å¤«æ€§ï¼Ÿ**
>	åŸå§‹SDEçš„â€œå½“å‰çŠ¶æ€â€ $x_t$ï¼Œç›¸å½“äºä»¥â€œä¸Šä¸€ä¸ªçŠ¶æ€â€ $x_{t-1}$ï¼ˆå‡å€¼ï¼‰ä¸ºä¸­å¿ƒçš„ï¼ˆæŒ‰ç…§æ–¹å·®ï¼‰å·¦å³æ‘†åŠ¨.ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥é€šè¿‡ç»Ÿè®¡ç”»å‡ºæ¥æ‘†åŠ¨çš„åˆ†å¸ƒã€‚ä½†æ˜¯â€œå½“å‰çŠ¶æ€â€ ä¸ â€œå‰ä¸¤ä¸ªçŠ¶æ€â€å…³ç³»ä¸å¯é¢„æµ‹ï¼Œå› ä¸ºâ€œä¸Šä¸€ä¸ªçŠ¶æ€â€åªçŸ¥æœ‰å…³ç³»ä½†ä¸å¯é¢„æµ‹äº†ï¼Œä¸â€œä¸Šä¸€ä¸ªçŠ¶æ€â€æœ‰å…³ç³»çš„â€œå‰ä¸¤ä¸ªçŠ¶æ€â€ä½ æ›´ä¸çŸ¥é“äº†ã€‚ä½†è¿™é‡Œæˆ‘ä»¬å»é™¤äº†ç»´çº³è¿‡ç¨‹çš„ $\mathrm{d}w$ ï¼Œå°±è®©è¿™ç§çŠ¹è±«æ¶ˆå¤±ï¼Œä»è€Œå»æ‰äº†å„ä¸ªçŠ¶æ€çš„é©¬å°”å¯å¤«æ€§ã€‚
>- **å¯èƒ½ç–‘é—®ç‚¹2ï¼š åŸå§‹çš„DDPMçš„æ‰©æ•£è¿‡ç¨‹æœ‰1000æ­¥ï¼Œå› æ­¤ç”Ÿæˆé‡‡æ ·ä¹Ÿéœ€è¦1000æ­¥ã€‚ä½†ç”±äºPF-ODEå»æ‰äº†é©¬å°”å¯å¤«æ€§ï¼Œä½¿å¾—é‡‡æ ·å¤šå±‚è”ç³»å˜å¾—å¯èƒ½ï¼Œè¿™1000æ­¥é‡‡æ ·è·³æ­¥è¿ç®—å˜å¾—å¯èƒ½ã€‚é‚£ä¹ˆæ˜¯å¦å¯ä»¥è€ƒè™‘ç”¨ä¸€æ­¥å®Œæˆé€†æ‰©æ•£ç”Ÿæˆå‘¢ï¼Ÿ**
>	ä¸è¡Œï¼å› ä¸ºæ¯ä¸€æ­¥æ‰©æ•£éƒ½å‡ºç°ç†è¯¯å·®ã€‚ä¸€æ¬¡ä»å¤´åˆ°å°¾çš„è¿ç®—ï¼Œæœ¬è´¨ä¸Šæ˜¯å°†è¯¯å·®å åŠ ä¸€èµ·å¤„ç†ï¼Œè¿™æ ·æ•ˆæœæ›´ä¸å¥½ã€‚

### 2.1.2 DDIM
DDIMï¼ˆDenoising Diffusion Implicit Modelsï¼‰æå‡ºçš„æ„å›¾ï¼Œå³æœ€å¤§åŒ–ä½¿ç”¨DDPMè®­ç»ƒçš„æ¨¡å‹ï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ¨ç†æ—¶å°½å¯èƒ½ç»´æŒDDPMçš„å‰ææ¡ä»¶ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå»åšä¸€ä¸ªå°æ‰‹è„šï¼Œå»æ‰äº†å„ä¸ªçŠ¶æ€çš„é©¬å°”å¯å¤«æ€§ï¼Œä»¥æ”¯æŒè·³æ­¥å¿«é€Ÿé‡‡æ ·ç”Ÿæˆæ“ä½œã€‚
#### 2.1.2.1 å»é©¬å°”å¯å¤«æ€§çš„DDIM
æ—¢ç„¶è¦å»é©¬å°”å¯å¤«æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å“ªé‡Œä½¿ç”¨äº†é©¬å°”å¯å¤«æ€§å‘¢ï¼Ÿ
å›é¡¾ç¬¬ä¸€å•å…ƒç¬¬1.4èŠ‚çš„å†…å®¹ï¼ŒDDPMæ ¸å¿ƒç†è®ºVDMçš„é€†å‘æ‰©æ•£è®¡ç®—æ–¹æ³•
$$q(\mathbf{x}_{tâˆ’1}|\mathbf{x}_t,\mathbf{x}_0) = \frac{q(\mathbf{x}_t|\mathbf{x}_{tâˆ’1}, \mathbf{x}_0)q(\mathbf{x}_{tâˆ’1}|\mathbf{x}_0)}{q(\mathbf{x}_t|\mathbf{x}_0)}$$

å› ä¸ºDDPMçš„é©¬å°”å¯å¤«æ€§ $q(\mathbf{x}_{tâˆ’1}|\mathbf{x}_t,\mathbf{x}_0)$ ä¸­ï¼Œ$(\mathbf{x}_t,\mathbf{x}_0),(\mathbf{x}_{t-1},\mathbf{x}_0)$ ï¼Œç›¸äº’çŠ¶æ€éƒ½æ— å…³ï¼Œæ‰€ä»¥å¯ä»¥è¡¨ç¤ºä¸ºé€†å‘è¿‡ç¨‹ $q(\mathbf{x}_{tâˆ’1}|\mathbf{x}_t)$ ã€‚ä½†åœ¨PF-ODEé‡Œé¢å´ä¸è¡Œã€‚**å¦‚æœæˆ‘ä»¬ä¸€å®šè¦å¤ç”¨å·²ç»è®­ç»ƒå¥½çš„DDPMæ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§DDPMçš„VDEæ¨ç†è¿‡ç¨‹å†æ¨ç†ä¸€éï¼Œè¿™æ˜¯DDIMçš„æ€»ä½“æ€æƒ³**ã€‚
å‡è®¾DDIMä¸­ï¼Œé€†å‘å»å™ªåˆ†å¸ƒ $q_{\sigma_t}(\mathbf{x}_{t-1}|\mathbf{x}_t,\mathbf{x}_0)$ æ˜¯ç±»ä¼¼DDPMçš„VDEçš„æ­£æ€åˆ†å¸ƒã€‚DDPMåˆ†å¸ƒå‡å€¼ï¼Œæ–¹å·®å¦‚ä¸‹ï¼ˆå¦‚å…¬å¼ï¼ˆ1.6.4ï¼‰ï¼ˆ1.6.5ï¼‰ï¼‰ï¼š
$$\begin{align}
\mu_q(\mathbf{x}_t,\mathbf{x}_0)&=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}} \tag{1.6.4}  \\
Ïƒ_q^2(t)&=\frac{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})}{1-\bar{{\alpha}}_{t}} \tag{1.6.5}
\end{align}$$
é‚£ä¹ˆæˆ‘ä»¬æŒ‡å®šDDIMå‡å€¼ä¸º $\mu(\mathbf{x}_t,\mathbf{x}_0)=m\mathbf{x}_t+k\mathbf{x}_0$ ï¼Œå…¶ä¸­ $m,k$ æ˜¯å¾…å®šç³»æ•°ã€‚æ–¹å·®ä¸º $\sigma_t^2$æ˜¯ä¸€ä¸ªäººä¸ºæŒ‡å®šçš„å¸¸æ•°ï¼ˆå› ä¸ºåœ¨DDPMä¸­çš„æ–¹å·®å°±æ˜¯å‡½æ•°ï¼‰ã€‚è¿™ç§ä¸¥æ ¼çš„æŒ‡å®šåœ¨æœ¬è´¨ä¸Šå°±æ˜¯å…¨æ–¹ä½å‘DDPMçœ‹é½ï¼Œä»¥ä¾¿å¤ç”¨è®­ç»ƒå¥½çš„DDPMæ¨¡å‹ã€‚DDPMçš„æ­£å‘æ‰©æ•£å…¬å¼å¦‚ä¸‹ï¼š
$$\mathbf{x}_t=\sqrt{\bar{\alpha}_t}\mathbf{x}_0 + \sqrt{1-\bar{\alpha}_t}\epsilon$$
å› ä¸ºæ˜¯ä¸€æ­¥æ‰©æ•£å…¬å¼ï¼Œæ‰€ä»¥æœä»æ­£æ€åˆ†å¸ƒçš„å™ªå£° $\epsilon$ ä¸‹è§’æ ‡æ¨¡ç³ŠåŒ–å¤„ç†äº†ã€‚
>[!Warning]
>ä½†åœ¨DDIMè®ºæ–‡é‡Œé¢ï¼Œ $\bar{\alpha}_t$ å†™ä½œ $\alpha_t$ ï¼Œå¾ˆç®€å•åœ°å»æ‰äº†è¿ä¹˜è®°å·ï¼Œä½†æœ¬è´¨è¿˜æ˜¯è¿ä¹˜ $\bar{\alpha}_t=\alpha_t$ã€‚DDIMå…¬å¼è®°æ³•ï¼š
> $$\mathbf{x}_t=\sqrt{\alpha_t}\mathbf{x}_0 + \sqrt{1-\alpha_t}\epsilon_t$$
> ä½†æœ¬äººä¸å–œæ¬¢æŒ‰åŸæ–‡å†™çš„ï¼Œå¤§å®¶çœ‹è®ºæ–‡æ³¨æ„ä¸€ä¸‹å°±è¡Œã€‚
 
è”ç«‹DDIMå…¬å¼å¯å¾—ï¼š
$$k\mathbf{x}_0+m\mathbf{x}_t+\sigma_t\epsilon_t=\mathbf{x}_{t-1}=\sqrt{\bar{\alpha}_{t-1}}\mathbf{x}_0 + \sqrt{1-\bar{\alpha}_{t-1}}{\epsilon_{t-1}}'$$
${\epsilon_{t-1}}'$åŠ ä¸Šä¸€æ’‡çš„ç›®çš„ï¼Œæ˜¯è®©å¤§å®¶çŸ¥é“ï¼Œå·¦å¼çš„å™ªå£° ${\epsilon_{t}}$ ä¸å³å¼çš„å™ªå£° ${\epsilon_{t-1}}'$ ä¸æ˜¯åŒä¸€ä¸ª0ï¼Œå®ƒçš„æœ¬è´¨æ˜¯éšæœºå™ªå£°ï¼Œç›¸åŠ æˆ–æ¶ˆå»ä¸¤ç§æ“ä½œéƒ½ä¸å¯ã€‚å”¯ä¸€æ“ä½œæ–¹æ³•å°±æ˜¯ä»åˆ†å¸ƒçš„è§’åº¦è¿›è¡Œé…å¯¹ã€‚å¦‚ä¸‹ï¼Œæˆ‘ä»¬æ¶ˆé™¤å·¦è¾¹çš„ $\mathbf{x}_t$ å¯å¾—åˆ°ï¼š
$$k\mathbf{x}_0+m(\sqrt{\bar{\alpha}_t}\mathbf{x}_0 + \sqrt{1-\bar{\alpha}_t}{\epsilon_t}'')+\sigma_t\epsilon_t=\mathbf{x}_{t-1}=\sqrt{\bar{\alpha}_{t-1}}\mathbf{x}_0 + \sqrt{1-\bar{\alpha}_{t-1}}{\epsilon_{t-1}}'$$
å·¦è¾¹æœä» $\mathcal{N}((k+m\sqrt{\bar{\alpha}_t})\mathbf{x}_0, (m^2(1-\bar{\alpha}_t)+\sigma_t^2)I)$ ï¼Œå³è¾¹æœä» $\mathcal{N}(\sqrt{\bar{\alpha}_{t-1}}\mathbf{x}_0, (1-\bar{\alpha}_{t-1})I)$ ã€‚
$$\begin{align}
k+m\sqrt{\bar{\alpha}_t} &= \sqrt{\bar{\alpha}_{t-1}} \tag{}\\
m^2(1-\bar{\alpha}_t)+\sigma_t^2 &= 1-\bar{\alpha}_{t-1} \tag{}
\end{align}$$
ä¸¤ä¸ªå‚æ•° $k,m$ ï¼Œä¸¤ä¸ªæ–¹ç¨‹ã€‚è§£å¾— $k,m$ã€‚å¸¦å…¥ $q_{\sigma_t}(\mathbf{x}_{t-1}|\mathbf{x}_t,\mathbf{x}_0)$ å…¬å¼å¯å¾—ï¼š
$$\begin{align}
q_{\sigma_t}(\mathbf{x}_{t-1}|\mathbf{x}_t,\mathbf{x}_0)&=\mathcal{N}(m\mathbf{x}_t+k\mathbf{x}_0,\sigma_t^2I) \\
&=\mathcal{N}(\sqrt{\bar{\alpha}_{t-1}}\mathbf{x}_0+\sqrt{1-\bar{\alpha}_{t-1}-\sigma_t^2}\frac{\mathbf{x}_t-\sqrt{\bar{\alpha}_t}\mathbf{x}_0}{\sqrt{1-\bar{\alpha}_{t}}} ,\sigma_t^2I) \tag{2.1.6}
\end{align}$$
å› ä¸ºæˆ‘ä»¬è¦è·³æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥è®° $t-1=t'$ï¼Œå¯å¾—
$$q_{\sigma_t}(\mathbf{x}_{t'}|\mathbf{x}_t,\mathbf{x}_0) =\mathcal{N}(\sqrt{\bar{\alpha}_{t'}}\mathbf{x}_0+\sqrt{1-\bar{\alpha}_{t'}-\sigma_t^2}\frac{\mathbf{x}_t-\sqrt{\bar{\alpha}_t}\mathbf{x}_0}{\sqrt{1-\bar{\alpha}_{t}}} ,\sigma_t^2I) \tag{2.1.7}$$
æˆ‘ä»¬è¦ç‰¹åˆ«æ³¨æ„ï¼šå› ä¸ºæˆ‘ä»¬åšçš„æ˜¯è·³æ­¥è¿­ä»£ï¼Œæˆ‘ä»¬å°±éœ€è¦æ‰¾ä¸€ä¸ªæ¯” $t$ æ›´å°çš„ $t'$ åšçŠ¶æ€æè¿°ã€‚å‡å¦‚æˆ‘ä»¬æ‰©æ•£æ¨¡å‹æ€»ä½“éœ€è¦è¦æ±‚$t=1000$ä¸ªæ—¶é—´æ­¥æ­£å‘æ‰©æ•£ä¼ æ’­ï¼Œé‚£ä¹ˆå¯ä»¥è®© $t'=950$ æ—¶é—´ç‚¹ï¼Œ$t''=900$ æ—¶é—´ç‚¹ï¼Œä¸è¦è®¤ä¸ºä»…ä»…æ˜¯ $t'=t-1$ ã€‚ å› æ­¤æˆ‘ä»¬å¯ä»¥åšè·³æ­¥é€†æ‰©æ•£é‡‡æ ·ï¼Œåˆ©ç”¨ $\mathbf{x}_{t}=\sqrt{\bar{\alpha}_{t}}\mathbf{x}_0 + \sqrt{1-\bar{\alpha}_{t}}\epsilon_{t}$ å‰å‘åŠ å™ªå…¬å¼ï¼Œä¸è®­ç»ƒå¥½çš„åŸºäºDDPMå™ªå£°æ¨¡å‹ $\epsilon_\theta(x)$ï¼Œå°†å…¬å¼ï¼ˆ2.1.7ï¼‰çš„ $\mathbf{x}_0$ å…ƒç´ æ¶ˆå»ï¼Œå¯å¾—é‡‡æ ·é€’æ¨å…¬å¼ï¼š
$$\begin{align}
\mathbf{x}_{t'}&=\sqrt{\bar{\alpha}_{t'}}(\frac{\mathbf{x}_t-\sqrt{1-\bar{\alpha}_t}\epsilon_\theta(\mathbf{x}_t)}{\sqrt{\bar{\alpha}_t}})+\sqrt{1-\bar{\alpha}_{t'}-\sigma_t^2}\epsilon_\theta(\mathbf{x}_t) + \sigma_t \epsilon_t \tag{2.1.7} \\
\end{align}$$
åœ¨DDIMä¸­ï¼Œè®© $\sigma_t=0$ ä½¿å¾—æ”¹è¿›åçš„DDPMå…¬å¼ä¸§å¤±äº†éšæœºæ€§ï¼ˆéšæœºé¡¹ï¼‰ï¼ˆè¿™é‡Œçš„ $\epsilon_\theta(\mathbf{x}_t)$ æ˜¯è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹ï¼Œæ‰€ä»¥æ²¡æœ‰éšæœºæ€§ï¼‰ï¼ŒåŒæ—¶ä¹Ÿä¸ç¬¦åˆé©¬å°”å¯å¤«åŸåˆ™ã€‚

> [! ä¸ºä»€ä¹ˆæˆ‘ä»¬å¤§èƒ†å°†æ–¹å·®æ”¹å†™ä¸º0?]
> 
> æ­£æ€åˆ†å¸ƒå¯ä»¥è®¤ä¸ºæ˜¯ä»¥å‡å€¼ä¸ºåŸºå‡†ï¼Œæ–¹å·®ä¸ºåŒºå›´å·¦å³æ¨ªè·³çš„é‡‡æ ·ã€‚å¦‚æœè‹¥å¹²ä¸ªæ­£æ€åˆ†å¸ƒè¿åœ¨ä¸€èµ·ï¼ŒåŒæ—¶è¿™è‹¥å¹²ä¸ªæ­£æ€åˆ†å¸ƒçš„å‡å€¼ç¡®å®šï¼Œé‚£ä¹ˆæ•´ä½“çš„æ‰©æ•£æ–¹å‘å°†ä¼šå¤§è‡´ç¡®å®šã€‚æ–¹å·®è®¾ä¸º0å°±æ˜¯æ˜ç¡®äº†æ‰©æ•£æ¨¡å‹ä¸»å¹²è¿åŠ¨æ–¹å‘ï¼Œä¸»æ–¹å‘æ˜ç¡®ï¼Œå› æ­¤å¯ä»¥è·³æ­¥ã€‚è¯´åˆ°è¿™é‡Œè¯·æ³¨æ„ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå‰æï¼šæ¯é‡‡æ ·æ­¥çš„å‡å€¼å·²ç»ç¡®å®šå¥½äº†ã€‚åœ¨é‡‡æ ·æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸ªæ¨¡å‹ $\epsilon_\theta(\mathbf{x}_t)$ ï¼Œå¤§è‡´è¿˜çŸ¥é“æ€»ä½“é‡‡æ ·æ–¹å‘ã€‚è€Œåœ¨åŠ å™ªæ‰©æ•£æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜ç¡®è·¯å¾„ï¼Œåªèƒ½æ‰¾ä¸€æ­¥çœ‹ä¸€æ­¥ã€‚å› æ­¤åŠ å™ªæ—¶ï¼Œä¸èƒ½æœ‰è¿™ç§æ–¹å·®ç›´æ¥è®¾ä¸º0çš„æ€è·¯ã€‚
#### 1.2.2 DDIMæœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§ODE

æˆ‘ä»¬å‘ç°å¦‚æœå…¬å¼ï¼ˆ2.1.7ï¼‰ä¸­ $\sigma_t \neq 0$  ï¼Œæ­¤å…¬å¼DDPMä¹Ÿèƒ½ç”¨ï¼Œæ•´ä¸ªæ¨ç†è¿‡ç¨‹ä¸­åªæ˜¯æ²¡æœ‰ç”¨â€œé©¬å°”å¯å¤«æ€§çš„æ¡ä»¶â€ï¼Œå…¶ä½™çš„å¹¶æ²¡è¿èƒŒDDPMè®¾å®šã€‚æ ¸å¿ƒå°±åœ¨äºDDIMä¸­ $\sigma_t=0$ ã€‚æˆ‘ä»¬ä»è¿™ä¸ªå…¬å¼è¿›è¡Œæ¨è®ºå¯å¾— DDIM é€’æ¨å…¬å¼å¦‚ä¸‹ï¼š
$$\begin{align}
\mathbf{x}_{t-1}&=\sqrt{\bar{\alpha}_{t-1}}(\frac{\mathbf{x}_t-\sqrt{1-\bar{\alpha}_t}\epsilon_\theta(\mathbf{x}_t)}{\sqrt{\bar{\alpha}_t}})+\sqrt{1-\bar{\alpha}_{t-1}}\epsilon_\theta(\mathbf{x}_t) \\
\frac{\mathbf{x}_t}{\sqrt{\bar{\alpha}_{t}}} -\frac{\mathbf{x}_{t-1}}{\sqrt{\bar{\alpha}_{t-1}}} &= (\sqrt{\frac{1-\bar{\alpha}_t}{\bar{\alpha}_t}}-\sqrt{\frac{1-\bar{\alpha}_{t-1}}{\bar{\alpha}_{t-1}}})\epsilon_\theta(\mathbf{x}_t)
\end{align}$$
æˆ‘ä»¬å‘ç°è¿™æ˜¯ä¸€ä¸ªç»å¥½çš„å·®åˆ†å½¢å¼ã€‚ä»¤$\frac{\mathbf{x}_t}{\sqrt{\bar{\alpha}_{t}}}=\hat{\mathbf{x}}_t, \sqrt{\frac{1-\bar{\alpha}_t}{\bar{\alpha}_t}}=\hat{\sigma}_t$  å¯å¾— $\mathbf{x}_t=\frac{\hat{\mathbf{x}}_t}{\sqrt{\hat{\sigma}_t^2+1}}$ ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯å°†æ–¹ç¨‹è¿ç»­åŒ–ï¼Œæ¨è®ºä¸ºï¼š
$$\begin{align}
\hat{\mathbf{x}}_t - \hat{\mathbf{x}}_{t-1} &= (\hat{\sigma}_t-\hat{\sigma}_{t-1})\epsilon_\theta(\frac{\hat{\mathbf{x}}_t}{\sqrt{\hat{\sigma}_t^2+1}}) \\
\hat{\mathbf{x}}_t - \hat{\mathbf{x}}_{t-\Delta t} &= (\hat{\sigma}_t-\hat{\sigma}_{t-\Delta t})\epsilon_\theta(\frac{\hat{\mathbf{x}}_t}{\sqrt{\hat{\sigma}_t^2+1}}) \\
\mathrm{d}\hat{\mathbf{x}}_t &= \epsilon_\theta(\frac{\hat{\mathbf{x}}_t}{\sqrt{\hat{\sigma}^2+1}})\mathrm{d}\hat{\sigma}_t
\end{align}$$
æ­¤æ—¶æˆ‘ä»¬å‘ç°DDIMçš„SDEå½¢å¼ä¹Ÿæ˜¯ä¸ªODEã€‚
