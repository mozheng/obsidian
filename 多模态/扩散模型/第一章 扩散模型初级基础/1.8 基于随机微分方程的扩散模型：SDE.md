ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ä» DDPMã€SMLD ä¸¤ä¸ªè§†è§’æ¨å¯¼å‡ºäº†æ‰©æ•£æ¨¡å‹æ‰©æ•£çš„æ–¹æ¡ˆã€‚åœ¨æœ¬èŠ‚å†…å®¹ä¸­ï¼Œæˆ‘ä»¬å°†å€ŸåŠ©**éšæœºå¾®åˆ†æ–¹ç¨‹**ï¼ˆStochastic Differential Equationï¼ŒSDEï¼‰æ¥ä»‹ç»æ‰©æ•£æ¨¡å‹çš„ç¬¬ä¸‰ç§è§†è§’ï¼Œæ­¤è§†è§’äº¦æ˜¯å‰ä¸¤ç§è§†è§’çš„ç»Ÿä¸€æ ¼å¼ã€‚DDPMã€SMLD å¯è¢«è§†ä½œä¸¤ç§ä¸åŒçš„ SDEã€‚

å¾®åˆ†æ–¹ç¨‹åœ¨å¤§å­¦é«˜ç­‰æ•°å­¦ä¸­æœ‰æ¶‰åŠã€‚ç„¶è€Œï¼Œè¾ƒä¸ºé—æ†¾çš„æ˜¯ï¼Œæˆ‘ä»¬çš„æ•™æå¹¶æœªç»™å‡ºè¿‡å¤šå¾®åˆ†æ–¹ç¨‹çš„è§£é¢˜æ–¹æ³•ï¼ŒåŸå› åœ¨äºè§£å¾®åˆ†æ–¹ç¨‹å¹¶æ— é€šç”¨ä¹‹æ³•ã€‚å¸¸ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡å…¬å¼çš„æ ¼å¼å°†æ–¹ç¨‹åˆ†ç±»ï¼Œä»è€Œé’ˆå¯¹ä¸åŒå¾®åˆ†æ–¹ç¨‹æ ¼å¼çš„æ±‚è§£ã€‚å› æ­¤ä¸åŒç§ç±»çš„å¾®åˆ†æ–¹ç¨‹ï¼Œå¦‚å¸¸å¾®åˆ†æ–¹ç¨‹ã€éšæœºå¾®åˆ†æ–¹ç¨‹ã€åå¾®åˆ†æ–¹ç¨‹ã€é«˜é˜¶å¾®åˆ†æ–¹ç¨‹ç­‰éƒ½æœ‰ä¸åŒçš„æ±‚è§£æ–¹æ³•ã€‚å› ä¸ºéšæœºå¾®åˆ†æ–¹ç¨‹çš„æ¦‚å¿µå¾ˆé‡è¦ï¼Œæˆ‘ä»¬åœ¨åé¢ä¼šè¯¦è§£ã€‚
### 1.8.1 æ‰©æ•£æ¨¡å‹çš„SDE
æ­¤å‰æ›¾æåŠä»¥â€œéƒä¹‹ä¸‡åŠ¨åŠ›å­¦æ–¹ç¨‹â€æ¥æè¿°å¸ƒæœ—è¿åŠ¨ï¼Œç„¶è€Œæ­¤æ–¹ç¨‹å¹¶éå¾®åˆ†æ–¹ç¨‹ã€‚å¦æœ‰ä¸€ä¸ªç”¨äºæè¿°å¸ƒæœ—è¿åŠ¨è¿‡ç¨‹çš„å¾®åˆ†æ–¹ç¨‹å…¬å¼ï¼Œè¢«æˆ‘ä»¬ç§°ä½œç»´çº³è¿‡ç¨‹ï¼ˆWiener processï¼‰ã€‚è¯¥è¿‡ç¨‹æ˜¯ä¸€ä¸ªé‡è¦çš„ç‹¬ç«‹å¢é‡è¿‡ç¨‹ã€‚å…¶å¯¹åœ¨è¿ç»­æ—¶é—´å†…ä¸€ä¸ªç²’å­äºç©ºé—´ä¸­çš„éšæœºè¿åŠ¨è½¨è¿¹è¿›è¡Œäº†æè¿°ã€‚è¿™ç§è¿åŠ¨å‘ˆç°æ— è§„åˆ™çŠ¶æ€ï¼Œå³åœ¨ä»»æ„çŸ­æš‚çš„æ—¶é—´é—´éš”å†…ï¼Œç²’å­çš„è¿åŠ¨æ–¹å‘ä¸è·ç¦»çš†ä¸ºéšæœºçš„ï¼Œæ‰€ä»¥è¯¥å¾®åˆ†æ–¹ç¨‹å«åš**éšæœºå¾®åˆ†æ–¹ç¨‹**ã€‚
> [!ç»´çº³è¿‡ç¨‹]
> 
> ç»´çº³è¿‡ç¨‹æ‰“åˆ†å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š
 åœ¨ç»™å®šäºŒé˜¶çŸ©è¿‡ç¨‹${W(t),t>=0}$ ï¼Œå¦‚æœå®ƒæ»¡è¶³å¦‚ä¸‹ä¸‰ä¸ªæ¡ä»¶
> - æ¯ä¸€æ­¥tå…·æœ‰ç‹¬ç«‹çš„å¢é‡ï¼Œè¯¥è¿‡ç¨‹åœ¨ä»»ä¸€æ—¶é—´åŒºé—´ä¸Šå˜åŒ–çš„æ¦‚ç‡åˆ†å¸ƒç‹¬ç«‹äºå…¶åœ¨ä»»ä¸€çš„å…¶ä»–æ—¶é—´åŒºé—´ä¸Šå˜åŒ–çš„æ¦‚ç‡ã€‚
> - å¯¹ä»»æ„çš„$\Delta t>0ï¼Œå¢é‡W(t+\Delta t)-W(t) \sim N(0,Ïƒ^2\Delta tï¼‰$ï¼Œæ–¹å·®éšæ—¶é—´åŒºé—´çš„é•¿åº¦å‘ˆçº¿æ€§å¢åŠ ã€‚
> - $W(0)=0, W(t)\sim N(0,Ïƒ^2t)$
> åˆ™ç§°æ­¤è¿‡ç¨‹ä¸ºç»´çº³è¿‡ç¨‹ã€‚æœ‰äº›æ•°æ®è®¾ç½® $\sigma=1$ ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¦å…³æ³¨çš„æ¨ç†è¿‡ç¨‹ã€‚æ­¤æ—¶å¯ä»¥å¾—åˆ°é€šè¿‡å˜åŒ–æ±‚ç§¯åˆ†ï¼Œå¯å¾—ï¼š
> $$\begin{align}W(\Delta t)=\sqrt{\Delta t}N(0,I) \\ 
> \mathrm{d}W=\sqrt{\mathrm{d}t}\epsilon,\epsilon\sim N(0,I)\end{align}$$
> è¿™é‡Œçš„ $\sqrt{\mathrm{d}t}$ ä½ å¯ä»¥ç†è§£æˆ$\mathrm{d}\sqrt{t}$ï¼Œåé¢æˆ‘ä»¬ä¼šä½¿ç”¨è¿™ä¸ªå…¬å¼ã€‚
> åé¢æˆ‘ä»¬ä½¿ç”¨éšæœºè¿‡ç¨‹ï¼ˆéäºŒé˜¶çŸ©è¿‡ç¨‹ï¼‰æ—¶å°±ä¸ç”¨å¤§å†™$W$åšæ ‡è¯†äº†ï¼Œè€Œæ˜¯ç”¨å°å†™$w$ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œç»´çº³è¿‡ç¨‹ $w$ æ˜¯æœ‰æ–¹å‘çš„ï¼Œæ­£å‘å’Œåå‘çš„æ•°å­¦ç¬¦å·æ˜¯ä¸åŒçš„ã€‚

ä¼Šè—¤è¿‡ç¨‹ï¼ˆItÃ´ processï¼‰å¯çœ‹ä½œä¸€èˆ¬åŒ–çš„ç»´çº³è¿‡ç¨‹ï¼Œå®ƒç›´æ¥æŠŠâ€œä»»ä¸€æ—¶é—´åŒºé—´ä¸Šçš„å˜åŒ–â€ç†è§£ä¸ºéšæœºå¹²æ‰°ã€‚å…¶éšæœºå¾®åˆ†æ–¹ç¨‹çš„è¡¨ç¤ºå¦‚ä¸‹ï¼š
$$\mathrm{d}x_t = \mu (t,x)\mathrm{d}t+ \sigma(t,x)\mathrm{d}w$$
å› ä¸ºåœ¨æˆ‘ä»¬çš„æ–‡ç« ä¸­ï¼Œ$\mu,\sigma$ éƒ½æœ‰å…¶ç‰¹æ®Šå«ä¹‰è¡¨å‡å€¼ä¸æ–¹å·®ï¼Œå¹¶ä¸”ä¸ä»£è¡¨å‡å€¼ä¸æ–¹å·®å‡½æ•°ã€‚æ‰€ä»¥æˆ‘ä»¬å°†ä¼Šè—¤è¿‡ç¨‹è®°ä¸ºå¦‚ä¸‹å…¬å¼
$$\mathrm{d}x_t = f(x,t)\mathrm{d}t+ g(t)\mathrm{d}w$$
ç”±äºå…¬å¼çš„æ¦‚å¿µæ˜¯é€šè¿‡å‡å€¼ä¸æ–¹å·®æ¼”å˜ã€‚æ‰€ä»¥å…¶ä¸­$f(x,t)$ä»£è¡¨æ¼‚ç§»é¡¹ä¹Ÿå°±æ˜¯å‰é¢çš„å‡å€¼ï¼› $g(t)$ä»£è¡¨å¹²æ‰°å¼ºåº¦ä¹Ÿå°±æ˜¯å‰é¢çš„æ–¹å·®ã€‚è¿™é‡Œçš„ $g(t)$ æ²¡æœ‰ $x$ å˜é‡ï¼Œåœ¨åé¢çš„æ¨è®ºæˆ‘ä»¬ä¼šè¯æ˜è¿™ä¸€ç‚¹ã€‚è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªéšè—çš„æ€§è´¨ï¼Œå› ä¸º $g(t)$ æ²¡æœ‰ $x$ å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸º $\mathrm{d}x_t$ æ˜¯åŸºäº $f(x,t)\mathrm{d}t$ ä»¥ $g(t)$ çš„æµ®åŠ¨åšæ­£æ€æ‘†åŠ¨ï¼Œå³ä¸º $\mathrm{d}x_t = \mathcal{N}(f(x,t)\mathrm{d}t, g(t))$ã€‚äº†è§£è¿™ä¸€ç‚¹æˆ‘ä»¬å°±çŸ¥é“å…¶å®æ˜¯æœ‰ã€‚
æœ‰äº›ä¹¦ç±ä¼šå°† $x$ å˜é‡åŠ ä¸Šå†™ä½œ $g(x,t)$ é‚£æ˜¯ä¸ºäº†é€‚é…åŸå§‹SDEå½¢å¼ï¼Œåœ¨å½“å‰çš„æ¨ç†ä¸­å®Œå…¨å¯ä»¥å»æ‰ $x$ã€‚
è¿œåœ¨1982å¹´ï¼Œæ•°å­¦å·¥ä½œè€…Andersonå°±æå‡ºäº†å®ƒçš„é€†å‘SDEæ‰©æ•£å…¬å¼ï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š
$$\mathrm{d}x=[f(x,t)-g^2(t)s_\theta(x_t)]\mathrm{d}t+g(t)\mathrm{d}w$$
å…¶ä¸­ $s_\theta(x_t)$ å°±æ˜¯å‰é¢æåˆ°çš„åˆ†æ•°å½¢å¼ï¼Œå…¶ä»–çš„ç¬¦å·éƒ½å¯ä»¥ä¸å‰é¢çš„æ‰©æ•£å…¬å¼å¯¹åº”ã€‚è¯¥å…¬å¼çš„æ¨ç†è¿‡ç¨‹ä¸æ˜¯æœ¬æ–‡å…³æ³¨çš„ç‚¹ï¼Œå¦‚éœ€è¦å¯è‡ªè¡ŒæŸ¥æ‰¾ã€‚å¦‚æœæˆ‘ä»¬ç…§ç€ä¸Šé¢çš„å…¬å¼æ¨å¯¼ï¼Œå¯ä»¥å°†DDPMçš„å…¬å¼æ¨ç†åˆ°ä»¥ä¸Šçš„å½¢å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯æ˜æˆ‘ä»¬çš„çŒœæƒ³ã€‚
è¿™ä¸€å¯¹ SDE å…¬å¼æè¿°äº†æ•°æ®åˆ†å¸ƒåœ¨è¿ç»­æ—¶é—´è½´ä¸Šçš„æ‰©æ•£ä¸æ¼”å˜ï¼šï¼ˆä¼Šè—¤å…¬å¼ï¼‰éšç€æ—¶é—´æ¨è¿›ï¼Œå™ªå£°ä¸æ–­æ³¨å…¥æ•°æ®ï¼Œæ•°æ®åˆ†å¸ƒé€æ¸åç¦»åŸå§‹çŠ¶æ€ï¼Œå‘ç®€å•çš„æ­£æ€åˆ†å¸ƒé è¿‘ï¼Œè¿™ä¸€è¿‡ç¨‹æ°ä¼¼å¸ƒæœ—è¿åŠ¨é©±åŠ¨ä¸‹çš„éšæœºæ¸¸èµ°ï¼ŒåŒæ—¶å—æ¼‚ç§»é¡¹æ§åˆ¶ï¼Œç¡®ä¿æ•´ä½“æœç€æ—¢å®šçš„å™ªå£°åŒ–æ–¹å‘å‘å±•ï¼›ï¼ˆAndersonå…¬å¼ï¼‰åå‘æ‰©æ•£æ—¶ï¼ŒSDE åˆ™ä¸ºä»å™ªå£°ä¸­è¿˜åŸæ•°æ®æä¾›äº†ç†è®ºæ”¯æ’‘ï¼Œä¾æ®å½“å‰å™ªå£°æ ·æœ¬ï¼ˆè•´å«äºå…¬å¼$W$ä¸­ï¼‰çš„çŠ¶æ€ä»¥åŠå¯¹è¿‡å¾€æ‰©æ•£è·¯å¾„çš„â€œè®°å¿†â€ï¼ˆè•´å«äºåˆ†æ•°$s_\theta(x_t)$ä¸­ï¼‰ï¼Œé€æ­¥æ¨ç®—å‡ºæ•°æ®çš„å»å™ªæ–¹å‘ä¸æ­¥é•¿ï¼Œå¦‚åŒé€†ç€éšæœºæ½®æµï¼Œæ‰¾å›æ•°æ®çš„æœ¬æºã€‚è¿™ç§å¯¹éšæœºåŠ¨æ€ç³»ç»Ÿçš„ç²¾ç¡®åˆ»ç”»èƒ½åŠ›ï¼Œä½¿å¾— SDE èƒ½å¤Ÿæ¨¡æ‹Ÿè¯¸å¤šç°å®ä¸–ç•Œä¸­çš„ä¸ç¡®å®šæ€§ç°è±¡ï¼Œæ— è®ºæ˜¯ç‰©ç†ç³»ç»Ÿä¸­çš„ç²’å­æ‰©æ•£ã€é‡‘èå¸‚åœºçš„ä»·æ ¼æ³¢åŠ¨ï¼Œè¿˜æ˜¯ç”Ÿç‰©ç§ç¾¤çš„éšæœºç¹è¡ï¼Œéƒ½èƒ½æ‰¾åˆ°å…¶å¯¹åº”çš„æŠ½è±¡æè¿°ï¼Œä¸ºå¤æ‚ç³»ç»Ÿå»ºæ¨¡å¥ å®šåŸºçŸ³ã€‚ï¼ˆå¦‚æœå­¦å¾—å¥½ï¼Œè¿˜èƒ½è½¬è¡Œå»é‡‘èï¼Œå› ä¸ºè¿™æ˜¯é‡‘èå¸‚åœºé¢„æµ‹çš„æ•°å­¦åŸºç¡€ã€‚å­¦æ•°å­¦ç®¡ç”¨å§ã€‚ï¼‰

#### 1.8.1.1 DDPMçš„SDEå½¢å¼
æˆ‘ä»¬å¯Ÿè§‰åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¾®åˆ†æ–¹ç¨‹æ˜¯è¿ç»­å˜åŒ–çš„ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰æ¨å¯¼çš„æ‰©æ•£è¿‡ç¨‹å¦‚DDPMæ˜¯ç¦»æ•£çš„ã€‚æˆ‘ä»¬å¦‚ä½•å°†ç¦»æ•£çš„DDPMè½¬æ¢æˆå¾®åˆ†æ–¹ç¨‹å‘¢ï¼Ÿæ¢å…ƒã€‚
é¦–å…ˆæˆ‘ä»¬åˆ—å‡ºDDPMçš„é€’å½’åŠ å™ªå…¬å¼ã€‚(å› æœ¬éƒ¨åˆ†çš„ $t$ å˜é‡æœ‰è‡ªå·±çš„å«ä¹‰ï¼Œæˆ‘ä»¬å°†å‰é¢çš„ $t$ æ”¹æˆ $i$ éƒ½æ˜¯è¡¨ç¤ºç¬¬ $i$ æ­¥çš„æ„æ€)
$$\begin{align}
x_i &= \sqrt{\alpha_i}x_{i-1} + \sqrt{1-\alpha_i}\epsilon_i  \\
&= \sqrt{1- \beta_i}x_{i-1} + \sqrt{\beta_i}\epsilon_i \\
\text{with}&: \epsilon_i \sim \mathcal{N}(\epsilon;0,I) 
\end{align}$$
å°†é€’å½’æ­¥éª¤çš„iå˜é‡ï¼Œæ¢æˆtå˜é‡ï¼Œå®ƒæœ€å¥½æœ‰æ±‚å¾®åˆ†çš„èƒ½åŠ›ã€‚å¦‚ä¸‹ï¼š
$$\begin{align*}
t&=\frac{i}{N},\Delta t =\frac{1}{N} \\
x_i &= x_{Nt}=Fx(t) \\
N\beta_i &= \beta_{Nt} = F\beta(t)
\end{align*}$$
è¯·æ³¨æ„ $Fx(t),F\beta(t)$ æ˜¯å‡½æ•°è¡¨ç¤ºå½¢å¼ã€‚è¿™é‡Œçš„ $\Delta t=\frac{1}{N}$ çœ‹èµ·æ¥æ¯”è¾ƒæ€ªå¼‚ã€‚ä½†æˆ‘ä»¬çŸ¥é“å½“$N$ è¶Šå¤§æ—¶ $t$ è¶Šå°ï¼Œè¿™å°±ä¼šæœ‰å¾®åˆ† $\Delta t$ çš„æ¦‚å¿µï¼Œä»è€Œå¼•å¯¼å¾®åˆ†æ–¹ç¨‹ã€‚ä»å¦ä¸€ä¸ªè§’åº¦çœ‹è¿™ç§æ“ä½œï¼Œå°±æ˜¯å°†åŸæ¥çš„æ‰©æ•£æ¨¡å‹çš„$x_0$ä»£è¡¨åŸå§‹å›¾åƒï¼Œ$x_N$ä»£è¡¨å™ªå£°å›¾åƒï¼Œæ˜ å°„åˆ°0åˆ°1ä¹‹é—´ï¼Œè®©$x_0$ä»£è¡¨åŸå§‹å›¾åƒï¼Œ$x_1$ ä»£è¡¨å™ªå£°å›¾åƒã€‚è¿™é‡Œæ˜¯æˆ‘ä»¬ä½¿ç”¨ $\beta$ ä½œä¸ºä¸»è¦æ¨ç†è¿‡ç¨‹è¿™æ˜¯ä¸ºäº†åœ¨åé¢å‡‘æ³°å‹’å±•å¼€ã€‚è¿™å°±æ˜¯â€œåŒ–æœªçŸ¥ä¸ºå·²çŸ¥â€çš„æ€æƒ³ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ $Fx,F\beta$ éƒ½æ˜¯å‡½æ•°åï¼Œè¿™ä¸¤ä¸ªå‡½æ•°åœ¨å®‹é£åšå£«çš„è®ºæ–‡ä¸­ç›´æ¥ç”¨ $x,\beta$è¡¨ç¤ºï¼Œæœ¬äººè¡¨ç¤ºç†è§£ä½†ä¸å¤ªè®¤å¯ï¼Œå› ä¸ºå®šä¹‰å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥æœ€å¥½ç”¨å…¶ä»–ç¬¦å·åšè¡¨ç¤ºä»¥å…é”™è¯¯ç†è§£ã€‚å…·ä½“æ¨è®ºå¦‚ä¸‹ï¼š
$$\begin{align}
x_i & \rightarrow x_{t+\Delta t},x_{i-1} \rightarrow x_t \\
x_i &= \sqrt{1- \beta_i}x_{i-1} + \sqrt{\beta_i}\epsilon_i \rightarrow \\
Fx(t+\Delta t) &= \sqrt{1 - \frac{F\beta(t+\Delta t)}{N}}Fx(t)  + \sqrt{\frac{F\beta(t+\Delta t)}{N}}\epsilon_i \\
Fx(t+\Delta t) &= \sqrt{1 - F\beta(t+\Delta t)\Delta t} Fx(t)  + \sqrt{ F\beta(t+\Delta t)\Delta t }\epsilon_i
\end{align}$$
è¿™é‡Œçš„ç®­å¤´ä»£è¡¨å…¬å¼å«ä¹‰çš„ç­‰ä»·ä»£æ¢ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ $t \rightarrow 0$ å¤„åšåšæ³°å‹’å±•å¼€ï¼Œå¯ä»¥å¾—åˆ°ä¸‹é¢çš„æ¨ç†
$$\begin{align}
\lim_{\Delta t \rightarrow 0} Fx(t+\Delta t) &= \sqrt{1 - F\beta(t+\Delta t)\Delta t} X_t  + \sqrt{ F\beta(t+\Delta t)\Delta t }\epsilon_i \\
&= (1 - \frac{1}{2}F\beta(t+\Delta t)\Delta t +o(\Delta t^2)) Fx(t)  + \sqrt{ F\beta(t+\Delta t)\Delta t }\epsilon_i \\
&= Fx(t) - \frac{1}{2}F\beta(t)\Delta t Fx(t) + \sqrt{ F\beta(t)\Delta t }\epsilon_i \\
\lim_{\Delta t \rightarrow 0} Fx(t+\Delta t) -Fx(t) &= - \frac{1}{2}F\beta(t)\Delta t Fx(t) + \sqrt{ F\beta(t)\Delta t }\epsilon_i \\
\mathrm{d}x=\mathrm{d}(Fx) &= - \frac{1}{2}F\beta(t)Fx(t)\mathrm{d}t + \sqrt{ F\beta(t)}\mathrm{d}w
\end{align}$$
æ­¤æ—¶æˆ‘ä»¬å‘ç°DDPMä¸SDEä¼Šè—¤è¿‡ç¨‹æ­é…ä¸Šäº†ã€‚æ ¹æ®å¯¹åº”çš„å‡½æ•°é…å¯¹å¯å¾—  $f(x,t)=-\frac{1}{2}F\beta(t)Fx(t)$ ï¼Œ $g(t)=\sqrt{ F\beta(t)}$ ã€‚å¦‚æœæˆ‘ä»¬å°†å…¶é…å¥—åˆ°é€†å‘æ‰©æ•£è¿‡ç¨‹ä¸­ï¼ˆAndersonå…¬å¼ï¼‰ã€‚å†æ ¹æ®å‰æ–‡DDPMä¸SMLDçš„å…³ç³»ï¼Œæˆ‘ä»¬å¯å¾—åˆ°â€œåˆ†æ•°å‡½æ•°â€ä¸â€œDDPMâ€çš„è½¬æ¢å…¬å¼ $s_\theta(x_i)=âˆ‡_x \logâ¡ ğ‘(x_i)= -\frac{1}{\sqrt{1-\bar{\alpha}_i}}\epsilon_\theta$
è¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼Œç”±äºâ€œåˆ†æ•°â€æ˜¯ä¸ªæ•´ä½“é‡ã€‚$\epsilon_0$ ç”±äºæ˜¯æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼Œç›´æ¥éšæœºè®¾ç½®ä¸ªå‚æ•°å°±å¯ä»¥äº†å§ï¼Ÿå½“ç„¶ä¸å¯¹ï¼ä¸€å®šè¦æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ $\epsilon_0$ ä»£è¡¨ç¬¬ä¸€æ¬¡æ‰©æ•£çš„å™ªå£°ï¼Œè€Œæˆ‘ä»¬æ­¤æ—¶åœ¨ç¬¬$i$æ¬¡ã€‚æˆ‘ä»¬è¿˜ç”¨éœ€è¦è®­ç»ƒä»¥$\theta$å‚æ•°è¡¨ç¤ºçš„ç¥ç»ç½‘ç»œæ¥é¢„æµ‹â€œåˆ†æ•°æ–¹ç¨‹â€ã€‚
å¸¦å…¥Andersonå…¬å¼å¯å¾—ï¼š
$$\begin{align}
\mathrm{d}x&=[f(x,t)-g^2(t)s_\theta(x_t)]\mathrm{d}t+g(t)\mathrm{d}w \\
&=[-\frac{1}{2}F\beta(t)Fx(t)+ F\beta(t)(\frac{1}{\sqrt{1-\bar{\alpha}_i}}\epsilon_\theta)]\mathrm{d}t + \sqrt{ F\beta(t)}\mathrm{d}w
\end{align}$$
å› ä¸ºè¿™é‡Œæ˜¯é€†æ‰©æ•£è¿‡ç¨‹ï¼Œ$\mathrm{d}w$ çš„æ–¹å‘åº”è¯¥ä¸æ‰©æ•£æ¨¡å‹çš„æ–¹å‘ç›¸åï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ $d\bar{w}=-\mathrm{d}w$ è¡¨ç¤ºé€†æ‰©æ•£è¿‡ç¨‹ï¼š

|          |                        æ­£å‘æ‰©æ•£è¿‡ç¨‹SDE                        |                                                        é€†å‘æ‰©æ•£è¿‡ç¨‹SDE                                                        |
| :------: | :-----------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------: |
|   SDE    |             ä¼Šè—¤å…¬å¼ï¼š$\mathrm{d}x_t = f(x,t)\mathrm{d}t+ g(t)\mathrm{d}w$              |                                  Andersonå…¬å¼ï¼š$\mathrm{d}x=[f(x,t)-g^2(t)s_\theta(x_t)]\mathrm{d}t+g(t)\mathrm{d}w$                                  |
| DDPMå¾®åˆ†æ–¹ç¨‹ | $\mathrm{d}x=-\frac{1}{2}F\beta(t)Fx(t)\mathrm{d}t + \sqrt{ F\beta(t)}\mathrm{d}w$ | $\mathrm{d}x=[-\frac{1}{2}F\beta(t)Fx(t)+ F\beta(t)(\frac{1}{\sqrt{1-\bar{\alpha}_i}}\epsilon_0)]\mathrm{d}t + \sqrt{ F\beta(t)}d\bar{w}$ |

#### 1.8.1.2 ä½¿ç”¨DDPMçš„SDEåšå€¼è¿­ä»£

ä¸Šæ–‡å¯çŸ¥ï¼Œåœ¨DDPMçš„é€†å‘æ‰©æ•£SDEæ–¹ç¨‹ä¸º
$$\mathrm{d}x=\mathrm{d}(Fx)=[-\frac{1}{2}F\beta(t)Fx(t)- F\beta(t)s_\theta(x_t)]\mathrm{d}t + \sqrt{ F\beta(t)}d\bar{w}$$
åœ¨æœ€åçš„å®é™…åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç¦»æ•£è¿­ä»£æ–¹æ¡ˆçš„å…¬å¼ï¼Œå¦åˆ™å¾ªç¯ç®—æ³•ä»£ç æ— æ³•ä¹¦å†™ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™å‡ºå…¶å¯¹åº”çš„è¿­ä»£å¼ã€‚æˆ‘ä»¬æ‹†å¼€å¾®åˆ†å…¬å¼å¯å¾—å…¬å¼ $$\begin{align}
\mathrm{d}x &= \mathrm{d}(Fx) = Fx(t) âˆ’ Fx(tâˆ’\Delta t) \\
d\bar{w} &\rightarrow W(t-\Delta t)-W(t)=- \sqrt{\Delta t}\epsilon \\
\mathrm{d}t &\rightarrow \Delta t
\end{align}$$
$Fx(t) âˆ’ Fx(tâˆ’\Delta t)$ç›¸å‡çš„å†™æ³•æ­£å¥½æ˜¯ç¬¦åˆè¿­ä»£çš„å…¬å¼ã€‚æˆ‘ä»¬çš„æ€è·¯æ˜¯æŠŠ$Fx(t)$ ï¼Œ$Fx(tâˆ’\Delta t)$ä¸¤é¡¹æ”¾åœ¨ç­‰å¼ä¸¤è¾¹ï¼Œå³å¯ä»¥å¾—åˆ°è¿­ä»£å¼æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡**æ¬§æ‹‰-ä¸¸å±±æ³•**å°†å¾®åˆ†æ–¹ç¨‹è½¬æ¢ä¸ºè¿­ä»£å¼ï¼š

> [!æ¬§æ‹‰-ä¸¸å±±æ³•]
> æ¬§æ‹‰-ä¸¸å±±æ³•ï¼ˆEuler-Maruyama discretizationï¼‰æ˜¯ç”¨æ•°å€¼æ±‚è§£éšæœºå¾®åˆ†æ–¹ç¨‹ï¼ˆSDEï¼‰çš„æ–¹æ³•ã€‚
> $\mathrm{d}x_t = f(x,t)\mathrm{d}t+ g(t)\mathrm{d}w$ çš„é€’æ¨å…¬å¼å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š
>$$x(t)=x(t-\Delta t)+f(x,t)\Delta t + g(t)\Delta w$$

$$\begin{align}
Fx(t) âˆ’ Fx(tâˆ’\Delta t) &= -F\beta(t)\Delta t[\frac{Fx(t)}{2}+s_\theta(Fx(t))] - \sqrt{ F\beta(t)\Delta t}\epsilon \\
Fx(tâˆ’\Delta t) &= Fx(t) + F\beta(t)\Delta t[\frac{Fx(t)}{2}+ s_\theta(Fx(t))] + \sqrt{ F\beta(t)\Delta t}\epsilon \\
&= Fx(t)[1+ \frac{F\beta(t)\Delta t}{2}]+ F\beta(t)\Delta ts_\theta(Fx(t)) + \sqrt{ F\beta(t)\Delta t}\epsilon
\end{align}$$
æ­¤æ—¶æˆ‘ä»¬å‡‘ä¸€ä¸ªæå°é¡¹ $o(\Delta t)=\frac{(F\beta(t)\Delta t)^2}{2}s_\theta(Fx(t))$ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æœ‰ä¸€ä¸ªç§å¿ƒï¼šå€˜è‹¥åé¢ä½¿ç”¨æ³°å‹’å…¬å¼ï¼Œå–æé™ç­‰æ“ä½œï¼Œè¿™é‡Œçš„æå°å€¼å°†ä¼šè¢«æŠ¹å¹³ã€‚æˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š
$$\begin{align}
Fx(tâˆ’\Delta t) &= [1+ \frac{F\beta(t)\Delta t}{2}](Fx(t)+F\beta(t)\Delta ts_\theta(Fx(t))) + \sqrt{ F\beta(t)\Delta t}\epsilon - o(\Delta t)
\end{align}$$
å‰é¢æˆ‘ä»¬å°†ç¦»æ•£DDPMç®—æ³•è¿ç»­åŒ–ï¼Œæ˜¯ä¸ºäº†æ¨ç†å‡ºDDPMå¯¹åº”çš„SDEå½¢å¼ã€‚è¿™é‡Œä¸ºäº†æ±‚è§£ï¼Œæ‰å†å°†SDEå…¬å¼ç¦»æ•£åŒ–ã€‚ç¦»æ•£åŒ–çš„æ–¹æ³•ä¸å‰è€…è¿ç»­åŒ–çš„æ–¹æ³•ä¸€æ¨¡ä¸€æ ·ã€‚
$$\begin{align}
âˆ†t &=1/N \\
Fx(tâˆ’âˆ†t)&=x_{iâˆ’1},Fx(t) = x_i\\
FÎ²(t)âˆ†t &= Î²_i
\end{align}$$
å½“$N$è¶³å¤Ÿå¤§æ—¶ï¼Œå³è¿ç»­å‡½æ•°é‡‡æ ·è¶³å¤Ÿå¯†æ—¶ï¼Œ $o(\Delta t)=o(\frac{1}{N}) \approx 0$ å› æ­¤ï¼š
$$\begin{align}
x_{i-1} &= (1+\frac{\beta_i}{2}+o'(\beta_{i}))[x_i + \beta_i s_\theta(x_i)] + \sqrt{\beta_i}\epsilon_i - o(\frac{1}{N}) \\
& \approx \frac{1}{\sqrt{1-\beta_i}}[x_i + \beta_i s_\theta(x_i)] + \sqrt{\beta_i}\epsilon_i 
\end{align}$$
æœ€åä¸€æ­¥æ˜¯æ³°å‹’å…¬å¼çš„ç»“æœï¼Œå°±æ˜¯è¿™ä¸ªæˆ‘ä»¬è¦æ±‚çš„DDPMçš„SDEè¿­ä»£å¼ã€‚å®‹é£åšå£«è®ºæ–‡ä¸­åˆä»‹ç»äº†å¦ä¸€ç§æ›´ç›´æ¥çš„æ¨ç†å…¬å¼ï¼š
$$\begin{align}
Fx(tâˆ’\Delta t)&= Fx(t)[1+ \frac{F\beta(t)\Delta t}{2}]+ F\beta(t)\Delta ts_\theta(Fx(t)) + \sqrt{ F\beta(t)\Delta t}\epsilon \\
\rightarrow x_i &=(1+\frac{\beta_i}{2})x_i + \beta_i s_\theta(x_i) + \sqrt{\beta_i}\epsilon_i \\
&\approx[2 - (1-\frac{\beta_i}{2}+o'(\beta_i))]x_i + \beta_i s_\theta(x_i) + \sqrt{\beta_i}\epsilon_i \\
&=(2-\sqrt{1-\beta_i})x_i + \beta_i s_\theta(x_i) + \sqrt{\beta_i}\epsilon_i
\end{align}$$

ä»ä¸Šé¢ä¸¤ä¸ªå…¬å¼æˆ‘ä»¬å¾—çŸ¥ï¼Œåˆ†æ•°æ¨¡å‹çœŸçš„å¾ˆé‡è¦ã€‚

|          |                                     æ­£å‘æ‰©æ•£è¿‡ç¨‹SDE                                      |                                                                                     é€†å‘æ‰©æ•£è¿‡ç¨‹SDE                                                                                     |
| :------: | :--------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|   SDE    |             ä¼Šè—¤å…¬å¼ï¼š$\mathrm{d}x_t = f(x,t)\mathrm{d}t+ g(t)\mathrm{d}w$              |                                                 Andersonå…¬å¼ï¼š$\mathrm{d}x=[f(x,t)-g^2(t)s_\theta(x_t)]\mathrm{d}t+g(t)\mathrm{d}w$                                                  |
| DDPMå¾®åˆ†æ–¹ç¨‹ | $\mathrm{d}x=-\frac{1}{2}F\beta(t)Fx(t)\mathrm{d}t + \sqrt{ F\beta(t)}\mathrm{d}w$ |                     $\mathrm{d}x=[-\frac{1}{2}F\beta(t)Fx(t)+ F\beta(t)(\frac{1}{\sqrt{1-\bar{\alpha}_i}}\epsilon_0)]\mathrm{d}t + \sqrt{ F\beta(t)}d\bar{w}$                     |
| DDPMè¿­ä»£æ–¹ç¨‹ |            $x_i = \sqrt{1- \beta_i}x_{i-1} + \sqrt{\beta_i}\epsilon_i$             | $x_{i-1}=\frac{1}{\sqrt{1-\beta_i}}[x_i + \beta_i s_\theta(x_i)] + \sqrt{\beta_i}\epsilon_i$æˆ–$x_{i-1}=(2-\sqrt{1-\beta_i})x_i + \beta_i s_\theta(x_i) + \sqrt{\beta_i}\epsilon_i$ |
ç»ç”±è¿™ä¸¤èŠ‚çš„é˜è¿°ã€‚DDPM çš„ SDE ç¡®ä¿åœ¨æ•´ä¸ªæ‰©æ•£è¿›ç¨‹ä¸­ï¼Œéšæœºå˜é‡çš„æ–¹å·®ç»´æŒæ’å®šï¼ˆ$\beta<1$ç³»äººä¸ºå®šä¹‰å¦¥å½“ï¼‰ï¼Œæ­¤æ—¶çš„ SDE è¢«ç§°ä½œ variance Preserving SDEï¼ˆ`VP-SDE`ï¼‰ï¼Œå³â€œ**åœ¨æ‰©æ•£è¿‡ç¨‹ä¸­æ–¹å·®ä¿æŒä¸å˜çš„éšæœºå¾®åˆ†æ–¹ç¨‹**â€ã€‚æ­¤æ„å‘³ç€ä¸è®ºæ—¶é—´å¦‚ä½•å˜è¿ï¼Œéšæœºå˜é‡çš„æ³¢åŠ¨æ€§ï¼ˆäº¦å³æ–¹å·®ï¼‰çš†ä¿æŒæ’å®šçŠ¶æ€ã€‚è¿™æ ·çš„æ€§è´¨ä½¿å¾— VP-SDE åœ¨æŸäº›åº”ç”¨é¢†åŸŸæä¸ºæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¯¹éšæœºè¿‡ç¨‹æ³¢åŠ¨æ€§è¿›è¡Œæ§åˆ¶çš„åœºæ™¯ä¹‹ä¸­ã€‚æ­¤æ—¶ä¸è¦è®¤ä¸ºæ‰©æ•£æ¨¡å‹çš„éšæœºå¾®åˆ†æ–¹ç¨‹éƒ½æ˜¯VP-SDEçš„ï¼Œä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸€ç§VE-SDEï¼ˆvariance Exploding SDEï¼‰çš„æ‰©æ•£æ¨¡å‹çš„éšæœºå¾®åˆ†æ–¹ç¨‹ï¼Œè¿™é‡Œä½¿ç”¨ç”¨SMLDçš„SDEä¸ºå…¶ä¸¾ä¾‹ã€‚
#### 1.8.1.3 SMLDçš„SDEå½¢å¼
é¦–å…ˆï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åœ¨SMLDè®¾ç½®ä¸­ï¼Œå¹¶ä¸å­˜åœ¨ä¸€ä¸ªçœŸæ­£çš„â€œå‰å‘æ‰©æ•£æ­¥éª¤â€ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œå°†åŠ å™ªè¿‡ç¨‹ $\tilde{x}=x+\sigma\epsilon$ å½“æˆå‰å‘è¿‡ç¨‹ï¼Œå½“ç„¶æˆ‘ä»¬åœ¨â€œ**7.2.2 åŸºäºåŠ å™ªåˆ†æ•°ä¼˜åŒ–çš„éƒä¹‹ä¸‡åŠ¨åŠ›æ–¹ç¨‹**â€ä¸­ä¹Ÿæåˆ°è¿‡ï¼šè¿™é‡Œçš„éƒä¹‹ä¸‡åŠ¨åŠ›æ–¹ç¨‹ä¸åŠ å™ªä¹Ÿå¯ä»¥ï¼Œä½†ä¸ºäº†ç»Ÿä¸€æ ¼å¼ï¼Œæˆ‘ä»¬è®¾ç½®åŠ å™ªè¿­ä»£å…¬å¼å¦‚ä¸‹ï¼Œå…¶ä¸­ $x_0$ æ˜¯åŠ å™ªå‰çš„å›¾ï¼š
$$x_i=x_{i-1}+\sqrt{\sigma_i^2-\sigma_{i-1}^2}\epsilon_{i-1},\epsilon \in \mathcal{N}(0,I),\sigma_0=0$$
è¯¥å…¬å¼çœ‹èµ·æ¥å¾ˆéš¾ç†è§£ï¼Œä½†æ˜¯æŒ‰ç…§ä¹‹å‰DDPMæ¨ç†æ–¹å¼ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚ä¸‹çš„é‡å‚æ•°åŒ–æ–¹æ³•å°±æ˜¯SMLDçš„åŠ å™ªå…¬å¼ $\tilde{x}=x+\sigma\epsilon$ ã€‚
$$\begin{align}
x_i&=x_{i-1}+\sqrt{\sigma_i^2-\sigma_{i-1}^2}\epsilon_{i-1} \\
&=  x_{i-2}+\sqrt{\sigma_{i-1}^2-\sigma_{i-2}^2}\epsilon_{i-2} +\sqrt{\sigma_i^2-\sigma_{i-1}^2}\epsilon_{i-1} \\
&=x_{i-2}+\sqrt{\sigma_{i-1}^2-\sigma_{i-2}^2+\sigma_i^2-\sigma_{i-1}^2}\bar{\epsilon}_{i-2} \\
&=x_0 + \sqrt{\sigma_i^2-\sigma_{0}^2}\bar{\epsilon}_{0} \\
&=x_0 + \sigma_i \bar{\epsilon}_{0} 
\end{align}$$
å’ŒDDPMä¸€æ ·ï¼Œæˆ‘ä»¬å‘ç°åŠ å™ªè¿‡ç¨‹éƒ½å¯ä»¥ä¼˜åŒ–æˆä¸€æ­¥æ“ä½œã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å€Ÿé‰´DDPMçš„è¿ç»­åŒ–çš„ç»éªŒï¼Œå°†SMLDè®­ç»ƒä¸­çš„å™ªå£°å°ºåº¦åˆ’åˆ†ä¸º$N$ä¸ªçº§åˆ«ã€‚
$$\begin{align*}
t&=\frac{i}{N},\Delta t =\frac{1}{N} \\
x_i &= x_{t}=Fx(t) \\
\sigma_i &= \sigma_{t}=F\sigma(t)
\end{align*}$$
åŒç†DDPMï¼Œè¿™é‡Œçš„ $Fx,F\sigma$ ä¹Ÿæ˜¯ä¸¤ä¸ªå‡½æ•°è¡¨ç¤ºï¼ŒåŸè®ºæ–‡ç›´æ¥å¤ç”¨åŸç¬¦å·ï¼Œè™½ç›´è§‚ä½†ä¸å¤ªåˆç†ã€‚é‚£ä¹ˆé€’å½’åº”è¯¥éµå¾ªä¸€ä¸ªé©¬å°”å¯å¤«é“¾ï¼Œå…¶SDEå¯ä»¥åšå‡ºå¦‚ä¸‹æ¨ç†ï¼š
$$\begin{align}
x_i&=x_{i-1}+\sqrt{\sigma_i^2-\sigma_{i-1}^2}\epsilon_{i-1} \\
\rightarrow Fx(t+\Delta t)&=Fx(t)+\sqrt{\frac{F\sigma(t+\Delta t)^2-F\sigma(t)^2}{\Delta t}}\sqrt{\Delta t}\epsilon_{t}
\end{align}$$
å½“ $\Delta t\rightarrow0$ æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¬å¼å¾®åˆ†åŒ–å¦‚ä¸‹ï¼š
$$\mathrm{d}x=d(Fx)=\sqrt{\frac{d[F\sigma(t)^2]}{\mathrm{d}t}}\mathrm{d}w$$
è¯¥å½¢å¼å¾ˆç®€å•ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œçš„æ–¹å·®æ²¡æœ‰DDPMçš„é‚£æ ·å¾ˆç¨³å®šåœ¨ä¸€ä¸ªåŒºé—´ï¼Œæ‰€ä»¥æ­¤æ—¶çš„SDEç§°ä¹‹ä¸ºâ€œ**æ–¹å·®çˆ†ç‚¸å‹éšæœºå¾®åˆ†æ–¹ç¨‹**â€variance explode SDE(`VE SDE`)ã€‚ç”±SDEæ¨¡ç‰ˆä¼Šè—¤å…¬å¼ $\mathrm{d}x_t = f(x,t)\mathrm{d}t+ g(t)\mathrm{d}w$ ï¼Œå¯çŸ¥ $f(x,t)=0,g(t)=\sqrt{\frac{d[F\sigma(t)^2]}{\mathrm{d}t}}$ ã€‚å¯æ ¹æ®Andersonå…¬å¼ $\mathrm{d}x=[f(x,t)-g^2(t)s_\theta(x_t)]\mathrm{d}t+g(t)\mathrm{d}w$ å¾—å‡ºSMLDå¯¹åº”çš„SDEé€†æ‰©æ•£å½¢å¼ï¼š
$$\mathrm{d}x=\mathrm{d}(Fx)=-[\frac{\mathrm{d}[F\sigma(t)^2]}{\mathrm{d}t}s_\theta(Fx(t))]\mathrm{d}t+\sqrt{\frac{\mathrm{d}[F\sigma(t)^2]}{\mathrm{d}t}}\mathrm{d}\bar{w}$$
SMLDçš„é€†æ‰©æ•£æ–¹ç¨‹ä¹Ÿå¾ˆå®¹æ˜“æ¨ç†ã€‚åŒæ ·æ ¹æ® **æ¬§æ‹‰-ä¸¸å±±æ³•** å†™å‡ºè¿­ä»£å¼ï¼š
$$\begin{align}
x(t+\Delta t) &= x(t) -[\frac{\mathrm{d}[F\sigma(t)^2]}{\mathrm{d}t}s_\theta(Fx(t))]\Delta t-\sqrt{\frac{\mathrm{d}[F\sigma(t)^2]}{\mathrm{d}t}}\Delta w\\
x(t) &= x(t+\Delta t) + [\frac{\mathrm{d}[F\sigma(t)^2]}{\mathrm{d}t}s_\theta(Fx(t))]\Delta t + \sqrt{\frac{\mathrm{d}[F\sigma(t)^2]}{\mathrm{d}t}}\Delta w \\
\rightarrow x_{i-1} &= x_i + (\sigma_i^2-\sigma_{i-1}^2)s_\theta(x_i)+\sqrt{\sigma_i^2-\sigma_{i-1}^2}\epsilon_i
\end{align}$$


å› æ­¤æˆ‘ä»¬å¯ä»¥åˆ—å‡ºå†åˆ—å‡ºè¿™å¼ å®Œæ•´çš„è¡¨

|          |                                        æ­£å‘æ‰©æ•£è¿‡ç¨‹SDE                                         |                                                                                     é€†å‘æ‰©æ•£è¿‡ç¨‹SDE                                                                                     |
| :------: | :--------------------------------------------------------------------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|   SDE    |                ä¼Šè—¤å…¬å¼ï¼š$\mathrm{d}x_t = f(x,t)\mathrm{d}t+ g(t)\mathrm{d}w$                 |                                                 Andersonå…¬å¼ï¼š$\mathrm{d}x=[f(x,t)-g^2(t)s_\theta(x_t)]\mathrm{d}t+g(t)\mathrm{d}w$                                                  |
| DDPMå¾®åˆ†æ–¹ç¨‹ | $\mathrm{d}x=d(Fx)=-\frac{1}{2}F\beta(t)Fx(t)\mathrm{d}t + \sqrt{ F\beta(t)}\mathrm{d}w$ |                  $\mathrm{d}x=d(Fx)=[-\frac{1}{2}F\beta(t)Fx(t)+ F\beta(t)(\frac{1}{\sqrt{1-\bar{\alpha}_i}}\epsilon_0)]\mathrm{d}t + \sqrt{ F\beta(t)}d\bar{w}$                  |
| DDPMè¿­ä»£æ–¹ç¨‹ |               $x_i = \sqrt{1- \beta_i}x_{i-1} + \sqrt{\beta_i}\epsilon_i$                | $x_{i-1}=\frac{1}{\sqrt{1-\beta_i}}[x_i + \beta_i s_\theta(x_i)] + \sqrt{\beta_i}\epsilon_i$æˆ–$x_{i-1}=(2-\sqrt{1-\beta_i})x_i + \beta_i s_\theta(x_i) + \sqrt{\beta_i}\epsilon_i$ |
| SMLDå¾®åˆ†æ–¹ç¨‹ |    $\mathrm{d}x=d(Fx)=\sqrt{\frac{\mathrm{d}[F\sigma(t)^2]}{\mathrm{d}t}}\mathrm{d}w$    |             $\mathrm{d}x=d(Fx)=-[\frac{\mathrm{d}[F\sigma(t)^2]}{\mathrm{d}t}s_\theta(Fx(t))]\mathrm{d}t+\sqrt{\frac{d[F\sigma(t)^2]}{\mathrm{d}t}}\mathrm{d}\bar{w}$             |
| SMLDè¿­ä»£æ–¹ç¨‹ |               $x_i=x_{i-1}+\sqrt{\sigma_i^2-\sigma_{i-1}^2}\epsilon_{i-1}$               |                                       $x_{i-1} = x_i + (\sigma_i^2-\sigma_{i-1}^2)s_\theta(x_i)+\sqrt{\sigma_i^2-\sigma_{i-1}^2}\epsilon_i$                                       |
|          |                                                                                          |                                                                                                                                                                                   |

### 1.8.2 æ±‚è§£éšæœºå¾®åˆ†æ–¹ç¨‹ï¼šé¢„ä¼°-æ ¡æ­£é‡‡æ ·ç®—æ³•
æ±‚è§£éšæœºå¾®åˆ†æ–¹ç¨‹é€šå¸¸æ˜¯åœ¨ç”Ÿæˆé˜¶æ®µè¦åšçš„äº‹ã€‚æŒ‰ç…§â€œæ¬§æ‹‰-ä¸¸å±±æ³•â€æ¨ç†å‡ºæ¥çš„è¿­ä»£æ–¹ç¨‹ï¼Œè‡ªç„¶èƒ½å¤Ÿä¸€æ­¥ä¸€æ­¥åœ°é€†æ‰©æ•£ç”Ÿæˆå›¾ç‰‡$x_0$ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•çš„ç”Ÿæˆè¿‡ç¨‹ï¼Œç†è®ºä¸Šä¸å­˜åœ¨é—®é¢˜ï¼Œä¸è¿‡æˆ‘ä»¬å¸¸å¸¸æœ‰ä¸€äº›ç‰¹æ®Šéœ€æ±‚ï¼Œæ¯”å¦‚æ¨ç†å¾—æ›´å¿«æˆ–è€…æ›´ç²¾å‡†ç­‰ç­‰ã€‚æœ¬éƒ¨åˆ†ä»‹ç»çš„æ­£æ˜¯é™¤äº†ä½¿ç”¨â€œè¿­ä»£æ–¹ç¨‹â€ä¹‹å¤–çš„ä¸åŒé‡‡æ ·ç”Ÿæˆæ–¹æ³•ã€‚ä»¥ä¸‹å†…å®¹åŸºäºä¸€ä¸ªå‰æï¼šé»˜è®¤åˆ†æ•°æ¨¡å‹$s_\theta(x)=\nabla _{x}\log p_x$å·²ç»è®­ç»ƒå®Œæ¯•ã€‚ 
â€Œé¢„ä¼°-æ ¡æ­£é‡‡æ ·ç®—æ³•ï¼ˆ**Predictor-Corrector Samplers**â€Œï¼ŒPCé‡‡æ ·ï¼‰æ˜¯ä¼—å¤šé‡‡æ ·ç®—æ³•ä¸­ä¸€ç§æ¯”è¾ƒç®€å•çš„æ–¹æ³•ã€‚é€šè¿‡é¢„æµ‹ï¼ˆPredictorï¼‰å’Œæ ¡æ­£ï¼ˆCorrectorï¼‰ä¸¤ä¸ªé˜¶æ®µçš„è¿­ä»£è¿‡ç¨‹æ¥é€æ­¥ç”Ÿæˆæ ·æœ¬ã€‚è¿™ç§æ–¹æ³•æ›´å¥½åœ°è§£å†³ç”Ÿæˆç²¾å‡†åº¦çš„é—®é¢˜ã€‚é¢„æµ‹å™¨å®šä¹‰å¤§è‡´çš„é€†æ‰©æ•£æ–¹å‘ï¼ŒçŸ«æ­£å™¨å¾®è°ƒçŸ«æ­£ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€é¢„æµ‹å™¨ä¸çŸ«æ­£å™¨éœ€è¦æ˜¯ä¸¤ä¸ªä¸åŒçš„é¢„æµ‹ç®—æ³•ã€‚ä¸‹è¡¨ä¸ºPCé‡‡æ ·çš„æ•´ä½“æµç¨‹
![](../images/pcsample.png)
æˆ‘ä»¬å¸¦å…¥DDPMä¸SMLDçš„è¿­ä»£å…¬å¼ï¼Œå³å¯å¾—åˆ°ä¸¤ç§é‡‡æ ·æ–¹æ³•ã€‚è¿™é‡ŒDDPMç›´æ¥ç”¨ VP SDEè¡¨ç¤ºï¼ŒSMLDç›´æ¥ç”¨VE SDEè¡¨ç¤ºäº†ã€‚è¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹è¡¨ï¼Œå…¶ä¸­$s_{\theta*}(x_i,i)$ å°±æ˜¯å‰é¢è®­ç»ƒçš„ç”Ÿæˆåˆ†æ•°æ¨¡å‹ã€‚

![](../images/pc.png)
