## 2.1 åˆ†æ•°æ¨¡å‹ç›¸å…³åŸºç¡€
### 2.1.1 åˆ†æ•°ç”Ÿæˆæ¨¡å‹
ç¬¬ä¸€ç« ç¬¬ä¸€èŠ‚æåˆ°äº†**åˆ†æ•°ç”Ÿæˆæ¨¡å‹ï¼ˆScore-based Generative Modelï¼‰**ã€‚è¿™éƒ¨åˆ†ä¸»è¦æºäºNCSN ï¼ˆNoise Conditional Score Networksï¼‰è®ºæ–‡[2]ï¼Œå®ƒæ¥è‡ªäºå®‹é£åšå£«è¿™æ˜¯å®‹é£å‘è¡¨åœ¨ NeurIPS2019 ä¸Šé¢çš„æ–‡ç« ã€‚å®‹é£åšå£«è®¤ä¸ºç°æœ‰çš„ç”Ÿæˆæ¨¡å‹å¯ä»¥å¤§ä½“åˆ†ä¸ºä¸¤ç§[3]ï¼š**åŸºäºä¼¼ç„¶çš„æ¨¡å‹**ä¸**éšå¼ç”Ÿæˆæ¨¡å‹**ã€‚åŸºäºä¼¼ç„¶çš„æ¨¡å‹è¦ä¹ˆä¸ºä¼¼ç„¶çš„è®¡ç®—å¯¹æ¨¡å‹ç»“æ„åšå¾ˆå¼ºçš„é™åˆ¶ï¼Œè¦ä¹ˆä¾èµ–ç›®æ ‡å‡½æ•°æ¥åšâ€œè¿‘ä¼¼æå¤§ä¼¼ç„¶â€çš„è®­ç»ƒã€‚è€Œéšå¼ç”Ÿæˆæ¨¡å‹è¦æ±‚å¯¹æŠ—è®­ç»ƒï¼Œæ¨¡å‹ä¸ç¨³å®šå¾ˆå®¹æ˜“å´©æºƒã€‚ä¸ºäº†è§„é¿è¿™äº›é—®é¢˜ï¼Œå®‹é£åšå£«é€‰æ‹©ä»å¤§é‡è¢«å™ªå£°æ‰°åŠ¨çš„æ•°æ®åˆ†å¸ƒä¸­å­¦ä¹ åˆ†æ•°å‡½æ•°ï¼ˆscore functionï¼‰ï¼Œå³â€œ**steinåˆ†æ•°**â€ $\nabla _{{x}}\log p({x})$ ã€‚å¹¶ä½¿ç”¨æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦ï¼ˆLangevin dynamicsï¼‰çš„æ–¹æ³•ä»ä¼°è®¡çš„æ•°æ®åˆ†å¸ƒä¸­è¿›è¡Œé‡‡æ ·æ¥ç”Ÿæˆæ–°çš„æ ·æœ¬ã€‚è¿™æ ·å¾—åˆ°çš„ç”Ÿæˆæ¨¡å‹é€šå¸¸ç§°ä¸ºâ€œ**åŸºäºåˆ†æ•°çš„ç”Ÿæˆæ¨¡å‹**â€ï¼ˆScore-based Generative Modelsï¼ŒSGMï¼‰ã€‚
### 2.1.2 â€œåˆ†æ•°â€çš„èµ·æº
ä¼ ç»Ÿç”Ÿæˆæ¨¡å‹çš„ç›®æ ‡å°±æ˜¯è¦å¾—åˆ°æ•°æ®çš„åˆ†å¸ƒã€‚ä¾‹å¦‚ä¸€ä¸ªæ•°æ®é›† ${x_1, x_2, ..., x_N}$ çš„æ•°æ®çš„æ¦‚ç‡å¯†åº¦åˆ†å¸ƒï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæ˜¯æ¦‚ç‡å¯†åº¦åˆ†å¸ƒï¼ŒPDFï¼‰ä¸º $p(x)$ ã€‚èµ·åˆæˆ‘ä»¬è®¤ä¸ºåˆå§‹çš„æ•°æ®æ˜¯æ‚ä¹±çš„ï¼Œéšæœºçš„ï¼Œæˆ‘ä»¬å¯ä»¥è®°ä¸ºï¼š
$$
p_{\theta}({x}) = \frac{e^{-f_{\theta}({x})}}{C_{\theta}},f_{\theta}({x})\in \mathbb{R} \tag{2.12}\\
$$
$\theta$ æ˜¯å‚æ•°ç”¨äºå»ºæ¨¡ï¼Œ $f_{\theta}$ è¢«ç§°ä¸ºæ ¸å¿ƒèƒ½é‡æ¨¡å‹ï¼ˆenergy-based modelï¼‰ã€‚è¿™ä¸ªå‡½æ•°å‹å°±å¾ˆåƒé«˜æ–¯å‡½æ•° $f(x)=\frac{1}{Ïƒ \sqrt{2Ï€}} \cdot e^{\frac{-(x - Î¼)^2} {2Ïƒ^2}}$ ã€‚æˆ‘ä»¬é€šè¿‡æœ€å¤§åŒ–logä¼¼ç„¶çš„æ–¹å¼ä¸­æ±‚å‚æ•°$\theta$ ã€‚å³é¦–å…ˆè®¡ç®—åŸºäºxçš„å¯¼æ•°ä¸ºï¼š
$$
\nabla _{{x}}\log(p_{\theta}({x})) = -\nabla _{{x}}f _{\theta}({x}) - \nabla _{{x}}\log C_{\theta} = -\nabla _{{x}}f _{\theta}({x}) \tag{2.13} \\
$$
å› ä¸ºCä¸æ— å…³ï¼Œæ‰€ä»¥ $\nabla _{{x}}\log C_{\theta}=0$ ã€‚è¿™é‡Œçªç„¶å‘ç°ï¼Œå¦‚æœæ±‚è§£ $\nabla _{{x}}\log p({x})$ æˆ‘ä»¬å°±ä¸éœ€æ±‚è§£å¸¸æ•°Cäº†ã€‚

é‚£ä¹ˆï¼Œè¿™ä¸ªåˆ†æ•°å…·ä½“æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿä»æ•°å­¦çš„è§’åº¦å‡ºå‘æ¥çœ‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªâ€œçŸ¢(å‘)é‡åœºâ€(vector field) ã€‚å‘é‡çš„æ–¹å‘æ˜¯ï¼šå¯¹äºè¾“å…¥æ•°æ®(æ ·æœ¬)æ¥è¯´ï¼Œå…¶å¯¹æ•°æ¦‚ç‡å¯†åº¦å¢é•¿æœ€å¿«çš„æ–¹å‘ã€‚ï¼ˆä¸‹å›¾ä»…ä»…æ˜¯ç¤ºæ„ï¼Œä¸ä»£è¡¨çœŸå®åœºæ™¯ï¼‰å¦‚æœåœ¨é‡‡æ ·è¿‡ç¨‹ä¸­æ²¿ç€åˆ†æ•°çš„æ–¹å‘èµ°ï¼Œå°±èƒ½å¤Ÿèµ°åˆ°æ•°æ®åˆ†å¸ƒçš„é«˜æ¦‚ç‡å¯†åº¦åŒºåŸŸï¼ˆå³ä¸ºä¸­å¿ƒï¼Œæ–¹å‘è¿‘ä¹å‚ç›´åŒºï¼‰ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ ·æœ¬å°±ä¼šç¬¦åˆåŸæ•°æ®åˆ†å¸ƒã€‚
### 2.1.3  éƒä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·æ–¹æ³•

æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦ï¼ˆLangevin dynamicsï¼‰åŸæ˜¯æè¿°ç‰©ç†å­¦ä¸­å¸ƒæœ—è¿åŠ¨ï¼ˆæ‚¬æµ®åœ¨æ¶²ä½“æˆ–æ°”ä½“ä¸­çš„å¾®å°é¢—ç²’æ‰€åšçš„æ— è§„åˆ™è¿åŠ¨ï¼‰çš„å¾®åˆ†æ–¹ç¨‹ï¼Œå€Ÿé‰´åˆ°è¿™é‡Œä½œä¸ºä¸€ç§ç”Ÿæˆæ ·æœ¬çš„æ–¹æ³•ã€‚ä»ä¸€ä¸ªåˆ†å¸ƒä¸­é‡‡æ ·æ—¶ï¼Œç»å¸¸ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚æ¦‚æ‹¬åœ°æ¥è¯´ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä»å…ˆéªŒåˆ†å¸ƒéšæœºé‡‡æ ·ä¸€ä¸ªåˆå§‹æ ·æœ¬ï¼Œç„¶ååˆ©ç”¨æ¨¡å‹ä¼°è®¡å‡ºæ¥çš„åˆ†æ•°é€æ¸å°†æ ·æœ¬å‘æ•°æ®åˆ†å¸ƒçš„é«˜æ¦‚ç‡å¯†åº¦åŒºåŸŸé è¿‘ã€‚ä¸ºä¿è¯ç”Ÿæˆç»“æœçš„å¤šæ ·æ€§ï¼Œæˆ‘ä»¬éœ€è¦é‡‡æ ·è¿‡ç¨‹å¸¦æœ‰éšæœºæ€§ã€‚å½“ç»è¿‡ä¸­æ‰€è¿°çš„åˆ†æ•°åŒ¹é…æ–¹æ³•è®­ç»ƒæ·±åº¦ç”Ÿæˆæ¨¡å‹åï¼Œå¯ä»¥ä½¿ç”¨å…·æœ‰è¿­ä»£è¿‡ç¨‹çš„æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·æ–¹æ³•ä»åˆ†å¸ƒä¸­æ¥ç”Ÿæˆæ–°çš„æ ·æœ¬ã€‚
æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·è¿‡ç¨‹æè¿°ï¼šå‡è®¾åˆå§‹æ•°æ®æ»¡è¶³å…ˆéªŒåˆ†å¸ƒÂ $x_0 \sim \pi(x)$ ï¼Œç„¶åä½¿ç”¨è¿­ä»£è¿‡ç¨‹
$$
\begin{align*}
x_{t+1}&=x_t+\frac{\epsilon}{2}\nabla _{x}\log  p\left( x \right) +\sqrt{\epsilon}\boldsymbol{z}_t, t=0,1,2,\cdots ,T\\
&=x_t+\frac{\epsilon}{2}s_{\theta}\left( x \right) +\sqrt{\epsilon}\boldsymbol{z}_t, t=0,1,2,\cdots ,T
\end{align*}
$$
å…¶ä¸­ï¼Œ $z_i \sim \mathcal{N}(0,I)$ ä¸ºæ ‡å‡†é«˜æ–¯åˆ†å¸ƒï¼Œå¯ä»¥çœ‹æˆæ˜¯å™ªå£°çš„æ¦‚å¿µã€‚ç†è®ºä¸Šï¼Œå½“ $k \rightarrow \infty, \epsilon \rightarrow 0$ ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ ·æœ¬Â $x_T$ å°†ä¼šæœä»åŸæ•°æ®åˆ†å¸ƒÂ $p_{data}(x)$ï¼Œè¶‹äºæŸä¸€ä¸ªç‰¹å®šå€¼ã€‚
![](images/2.2.2.jpg)
å›¾ 2.2 ä»å·¦åˆ°å³ï¼Œå›¾ç‰‡æ¨¡æ‹Ÿçš„æ˜¯ä½¿ç”¨éƒä¹‹ä¸‡åŠ¨åŠ›å­¦åœ¨ä¸¤ä¸ªé«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ï¼Œæœ€åé‡‡æ ·çš„ç»“æœå¾ˆç¬¦åˆåŸå§‹é«˜æ–¯åˆ†å¸ƒ

## 2.2 åˆ†æ•°ç”Ÿæˆæ¨ç†è¿‡ç¨‹
### 2.2.1 åˆ†æ•°ç”Ÿæˆæ¨¡å‹å…¬å¼æ¨ç†
ç°åœ¨æˆ‘ä»¬æƒ³è¦è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œæ¥ä¼°è®¡å‡ºçœŸå®çš„åˆ†å¸ƒã€‚ $s_\theta({x})$ å°±æ˜¯è¿™ä¸ªç¥ç»ç½‘ç»œçš„åˆ†æ•°ï¼ŒåŒç† $\theta$ è¿˜æ˜¯ä»£è¡¨ç½‘ç»œå‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥æœ€å°åŒ–çœŸå®çš„score functionï¼Œç”¨è¿™ç§å½¢ä¼¼æ¥ä¼˜åŒ–å³å¯ã€‚
$$\mathcal{L} = \mathbb{E}_{p({x})}[||\nabla _{{x}}\log p({x}) - {s} _{\theta}({x})||^{2}] \tag{2.14}$$
ä½†æ˜¯è¿™æ ·çš„ä¸€ä¸ªlossæˆ‘ä»¬æ˜¯ç®—ä¸å‡ºæ¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸çŸ¥é“çœŸå®çš„$p({x})$æ˜¯ä»€ä¹ˆã€‚æˆ‘ä»¬æŠŠä¸Šé¢lossçš„æœŸæœ›æ ¹æ®ä¸Šä¸€èŠ‚å…¬å¼ï¼ˆ1.7ï¼‰å†™å¼€ï¼ŒåŒæ—¶äºŒæ¬¡èŒƒå¼é¡¹æ‰“å¼€ï¼Œå¯ä»¥å¾—åˆ°
$$
\begin{align*}\mathcal{L} =& \mathbb{E}_{p({x})}[||\nabla _{{x}}\log p({x}) - {s} _{\theta}({x})||^{2}]\\
=& \int p({x}) [||\nabla _{{x}}\log p({x})||^{2} + ||{s} _{\theta}({x})||^{2} - 2(\nabla _{{x}}\log p({x}))^{T}{s} _{\theta}({x})] d {x}\end{align*}\\
$$
ç¬¬ä¸€é¡¹å¯¹äº $\theta$ æ¥è¯´æ˜¯å¸¸æ•°å¯ä»¥å¿½ç•¥ã€‚å› ä¸ºæˆ‘ä»¬è¦ç®—ç½‘ç»œ $\theta$ çš„å‚æ•°ï¼Œä¸ $x$ æ— å…³ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç¬¬ä¸€é¡¹å»æ‰ï¼Œä¸äºˆè€ƒè™‘ã€‚
ç¬¬äºŒé¡¹ä¸ºï¼š
$$\int p({x}) ||{s} _{\theta}({x})||^{2} d {x}$$
å¯¹äºç¬¬ä¸‰é¡¹ï¼Œè‹¥xçš„ç»´åº¦ä¸ºNåˆ™æœ‰ï¼š
$$
\begin{align*}
& -2\int p({x}) (\nabla _{{x}}\log p({x}))^{T}{s} _{\theta}({x}) d {x}\\ 
=& -2 \int p({x}) \sum\limits_{i=1}^{N}(\frac{\partial \log p({x})}{\partial {x}_{i}}{s}_{\theta_i}({x})) d {x}\\ 
=& -2 \sum\limits_{i=1}^{N} \int p({x}) \frac{1}{p({x})} \frac{\partial p({x})}{\partial {x}_{i}}{s}_{\theta_i}({x}) d {x}\\ 
=& -2 \sum\limits_{i=1}^{N} \int \frac{\partial p({x})}{\partial {x}_{i}}{s}_{\theta_i}({x}) d {x}\\ 
=& 2 \sum\limits_{i=1}^{N} - \int( \frac{\partial (p({x}){s}_{\theta_i}({x}))}{\partial {x}_{i}} d {x} + \int p({x}) \frac{\partial {s}_{\theta_i}({x})}{\partial {x}_{i}}) d {x}
\end{align*}
$$
ä¸Šé¢çš„æœ€åä¸€æ­¥æ˜¯åˆ†æ®µæ±‚ç§¯åˆ†å…¬å¼ï¼Œå› ä¸º $p(x)$ å–æé™æ˜¯0ï¼Œè¿™æ˜¯PDFçš„ç‰¹æ€§ã€‚å¯å¾—ä¸‹é¢å·¦è¾¹é‚£éƒ¨åˆ†ä¸º0ã€‚
$$
\begin{align*}
=& 2 - (p({x}){s}_{\theta_i}({x})\bigg\rvert^{\infty}_{-\infty}) + \sum\limits_{i=1}^{N}\int p({x}) \frac{\partial {s}_{\theta i}({x})}{\partial {x}_{i}} d {x}\\ 
=& 2 \sum\limits_{i=1}^{N} \int p({x}) \frac{\partial {s}_{\theta i}({x})}{\partial {x}_{i}} d {x}\\ 
=& 2\int p({x}) \sum\limits_{i=1}^{N} \frac{\partial {s}_{\theta i}({x})}{\partial {x}_{i}} d {x}\\ 
=& 2\int p({x}) \text{tr}(\nabla _{{x}}{s}_{\theta}({x})) d {x}
\end{align*}
$$
$tr(.)$ å‡½æ•°è¡¨ç¤ºçŸ©é˜µçš„è¿¹(trace)ï¼Œå³çŸ©é˜µä¸»å¯¹è§’çº¿å…ƒç´ çš„æ€»å’Œã€‚å› ä¸º $\nabla _{{x}}{s}_{\theta}({x})$ æ˜¯ä¸ªäºŒé˜¶æµ·æ£®çŸ©é˜µæ±‚å¯¼ï¼Œè¿™é‡Œåªç”¨ä¸»å¯¹è§’çº¿å°±è¡Œã€‚
æ‰€ä»¥æœ€åçš„lossæ˜¯ç¬¬äºŒå’Œç¬¬ä¸‰é¡¹çš„å’Œï¼Œå› ä¸ºæ–¹ä¾¿æ“ä½œï¼Œè®ºæ–‡ä¸­çš„Losså…¬å¼ä¹˜ä¸Šäº†1/2ï¼Œç»“æœä¸å½±å“ï¼š
$$\begin{align*} \frac{1}{2}\mathcal{L} &= \frac{1}{2}\int p({x}) ||{s} _{\theta}({x})||^{2} d {x} + \int p({x}) \text{tr}(\nabla _{{x}}{s}_{\theta}({x})) d {x}\\\\ &= \mathbb{E}_{p({x})}[||\frac{1}{2}{s} _{\theta}({x})||^{2} + \text{tr}(\nabla _{{x}}{s}_{\theta}({x}))] \tag{2.15} \end{align*}$$
å…¬å¼ä¼¼ä¹è¶Šæ¥è¶Šå¤æ‚ $tr(.)$ åˆ°åº•æ˜¯æ€ä¹ˆæ±‚ï¼Ÿä½œè€…åœ¨å™ªå£°æ¡ä»¶åˆ†æ•°ç½‘ç»œ NCSN è®ºæ–‡[3]ä¸­ç»™å‡ºäº†ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚å…·ä½“åšæ³•å°±æ˜¯å¯¹åŸå§‹æ•°æ®åŠ å™ªï¼Œä½¿å¾—å…¶ç»“æœæ»¡è¶³æˆ‘ä»¬é¢„å…ˆå®šä¹‰å¥½çš„åˆ†å¸ƒï¼Œæ¯”å¦‚é«˜æ–¯åˆ†å¸ƒã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±çŸ¥é“äº†ç°åœ¨çš„æ¦‚ç‡å¯†åº¦äº†ï¼Œäºæ˜¯å°±å¯ä»¥è¿›è¡Œè®­ç»ƒã€‚å…·ä½“æ“ä½œæˆ‘ä»¬æ¥ä¸‹æ¥ä»‹ç»ã€‚
### 2.2.2  å™ªå£°æ¡ä»¶åˆ†æ•°ç½‘ç»œï¼ˆNoise Conditional Score Networksï¼ŒNCSNï¼‰
å»å™ªåˆ†æ•°åŒ¹é…ï¼ˆDenoising Score Matchingï¼ŒDSMï¼‰æ–¹æ³•æ˜¯ä½œè€…åœ¨å™ªå£°æ¡ä»¶åˆ†æ•°ç½‘ç»œ NCSN ä¸­é»˜è®¤çš„è®¡ç®—æ–¹æ³•[3]ã€‚å½“å‰çš„é—®é¢˜æ˜¯ï¼šä¸çŸ¥é“**åŸå§‹æ•°æ®åˆ†å¸ƒçš„æ¢¯åº¦å‘é‡**ã€‚æœ‰ä¸€ç§è§£é¢˜æ–¹æ³•æ˜¯ä»æ ‡å‡†é«˜æ–¯å™ªå£°ä¸­æ„å»ºæ–°åˆ†å¸ƒã€‚æˆ‘ä»¬è€ƒè™‘ä»æ ‡å‡†é«˜æ–¯åˆ†å¸ƒ $\mathcal{N}(0,ğ¼)$ ä¸­é‡‡æ ·éšæœºå™ªå£°ğœ–ï¼Œç„¶åä¹˜ä¸Šæˆ‘ä»¬é¢„å®šä¹‰çš„ $ğœ$ ï¼Œæ¥ç€åŠ åˆ°æ ·æœ¬ $ğ‘¥$ ä¸­ï¼Œä»è€Œå°±èƒ½å¾—åˆ°åŠ å™ªåçš„æ ·æœ¬ $\tilde{ğ‘¥}$ã€‚æˆ‘ä»¬æ„å»ºæ–°åˆ†å¸ƒä¸ºï¼š
$$\begin{align}
q_{\sigma}(\tilde{x}) &=\int q_Ïƒ(\tilde{x}|x) p_{data}(x) dx \tag{2.16} \\
& = \int \mathcal{N}(\tilde{x}|x,Ïƒ^2I)p_{data}(x) dx \tag{2.16+}\\
\text{and} ~ \tilde{x}&=x+\sigma\epsilon, ~ \epsilon\sim \mathcal{N}(0,I) \tag{2.17} \\
\end{align}$$å…¬å¼ï¼ˆ2.16ï¼‰çš„ç§¯åˆ†æ˜¯ä»£è¡¨é‡‡æ ·ï¼Œæœ‰äº›åœ°æ–¹ä¼šçœ‹åˆ°å…¬å¼ï¼ˆ2.16+ï¼‰çš„å½¢å¼ã€‚$p_{data}(x)$ ä»£è¡¨éœ€è¦æ‰°åŠ¨çš„æ•°æ®ã€‚$q_Ïƒ(\tilde{x}|x) \sim \mathcal{N}(\tilde{x}|x,Ïƒ^2I)$ è¡¨ç¤ºæ‰°åŠ¨å™ªå£°æ•°æ®åˆ†å¸ƒã€‚$q_{\sigma}(\tilde{x})$ å°±æ˜¯æˆ‘ä»¬æ„å»ºçš„æ–°åˆ†å¸ƒï¼Œ $\tilde{ğ‘¥}$å°±æ˜¯æˆ‘ä»¬åŠ å™ªçš„æ–°æ ·æœ¬ã€‚
NCSNçš„ç›®æ ‡æ˜¯è®­ç»ƒä¸€ä¸ªæ¡ä»¶åˆ†æ•°ç½‘ç»œÂ $s_{\theta}( \tilde{x},\sigma )$Â æ¥ä¼°è®¡æ‰°åŠ¨æ•°æ®çš„åˆ†å¸ƒï¼Œå³Â 
$$
\frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x})}
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x})\Vert_2^2\Big] \tag{2.18}
$$
åœ¨DSMè®ºæ–‡[4]ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°ç›¸åº”çš„æ¨å¯¼å…¬å¼
$$
\begin{align}
& ~~~~ \frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x})}
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x})\Vert_2^2\Big] \tag{2.19} \\
&=\frac{1}{2}\int {q_Ïƒ(\tilde{x})}
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \frac{1}{q_Ïƒ(\tilde{x})}\frac{\partial q_Ïƒ(\tilde{x})}{\partial \tilde{x}} \Vert_2^2\Big] d\tilde{x}\\
&=\frac{1}{2}\int 
\Big[\Vert {q_Ïƒ(\tilde{x})}s_{\theta}( \tilde{x},\sigma ) - \frac{\partial q_Ïƒ(\tilde{x})}{\partial \tilde{x}} \Vert_2^2\Big] d\tilde{x}\\
&=\frac{1}{2}\int 
\Big[\Vert {q_Ïƒ(\tilde{x})}s_{\theta}( \tilde{x},\sigma ) - \frac{\partial \int q_Ïƒ(\tilde{x}|x) p_{data}(x) dx}{\partial \tilde{x}} \Vert_2^2\Big] d\tilde{x} \\
&=\frac{1}{2}\int 
\Big[\Vert {q_Ïƒ(\tilde{x})}s_{\theta}( \tilde{x},\sigma ) - \int \frac{\partial q_Ïƒ(\tilde{x}|x)}{\partial \tilde{x}} p_{data}(x) dx \Vert_2^2\Big] d\tilde{x} \\
&=\frac{1}{2}\int 
\Big[\Vert {\int q_Ïƒ(\tilde{x}|x) p_{data}(x) dx} \cdot s_{\theta}( \tilde{x},\sigma ) - \int q_Ïƒ(\tilde{x}|x) p_{data}(x)\frac{\partial \log q_Ïƒ(\tilde{x}|x)}{\partial \tilde{x}} dx \Vert_2^2\Big] d\tilde{x} \\
&=\frac{1}{2}\int_{\tilde{x}} \int_x q_Ïƒ(\tilde{x}|x) p_{data}(x) 
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \frac{\partial \log q_Ïƒ(\tilde{x}|x)}{\partial \tilde{x}}\Vert_2^2\Big] dx d\tilde{x} \\
&= \frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x}|x) p_{data}(x) }
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x}|x)\Vert_2^2\Big] \tag{2.20}
\end{align}
$$
***
æ³¨æ„ï¼šå®‹é£åšå£«åœ¨è®ºæ–‡ä¸blogæœ‰ä¸åŒçš„æ ‡è®°æ–¹æ³•ã€‚è®ºæ–‡æ›´å‡†ç¡®ç”¨çš„æ˜¯ $q_{\sigma}(x)$ ï¼Œä»£è¡¨ä¸ $p(x)$ ä¸åŒï¼›blogä¸Šç”¨çš„æ˜¯ $p_{\sigma}(x)$ ï¼Œä¸ºäº†ä»å…¬å¼ä¸Šç›´æ¥æ›¿æ¢ $p(x)$ ã€‚
***
è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªæ½œåœ¨æ¨ç†ã€‚å½“ $x$ æ˜¯ $D$ ç»´ï¼Œå³ ${x}\in \mathbb{R} ^D$ æ—¶ï¼Œç”±å¤šç»´é«˜æ–¯åˆ†å¸ƒ $f( \mathbf{x} ) = \frac{1}{(2\pi)^{\frac{D}{2}} | Î£ |^{\frac{1}{2}}} e^{- \frac{1}{2}( x - Î¼ )^T Î£^{-1}(x - Î¼)}$  å¯å¾—:
$$
\begin{align}
\nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x}|x) &= \nabla _{\tilde{x}}(C - \frac{1}{2}(\tilde{x} - x )^T Î£^{-1}(\tilde{x} - x)) \\
&= -Î£^{-1}(\tilde{x} - x) \\
&= -\begin{bmatrix} ğœ_{1}^2 & & & \\ & ğœ_{2}^2 & & \\ & & \ddots &\\ & & &ğœ_{d}^2 \end{bmatrix} (\tilde{x} - x) \tag{2.21}\\
&= - \frac{\tilde{x} - x}{ğœ^2} \tag{2.22} \\
&= - \frac{\epsilon}{ğœ} \tag{2.23}
\end{align}
$$
å°†ï¼ˆ2.22ï¼‰å¸¦å…¥å…¬å¼ï¼ˆ2.20ï¼‰å¯ä»¥å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼š
$$
\begin{align}
& ~~~~ \frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x}|x) p_{data}(x) }
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x}|x)\Vert_2^2\Big] \\
&= \frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x}|x)}\mathbb{E}_{p_{data}(x)}
\Big[\Big\Vert s_{\theta}( \tilde{x},\sigma ) + \frac{\tilde{x}-x}{Ïƒ^2}\Big\Vert_2^2\Big] \\ 
&= \frac{1}{2}\mathbb{E}_{p_{data}(x)}\mathbb{E}_{\tilde{x} \sim \mathcal{N}(\tilde{x}|x,Ïƒ^2I)}
\Big[\Big\Vert s_{\theta}( \tilde{x},\sigma ) + \frac{\tilde{x}-x}{Ïƒ^2}\Big\Vert_2^2\Big] \tag{2.24} \\
& =\mathcal{l}(\theta;\sigma) \tag{2.25}
\end{align}
$$
æˆ‘ä»¬æŠŠæœ€åå…¬å¼ï¼ˆ2.24ï¼‰çš„å†™æˆå…¬å¼ï¼ˆ2.25ï¼‰æ–¹ä¾¿åé¢ä½¿ç”¨ã€‚åœ¨å…¬å¼ï¼ˆ2.24ï¼‰ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¸»è¦çš„é—®é¢˜åœ¨äºå™ªå£°åŠ›åº¦ $\sigma$ ã€‚å™ªå£°åŠ çš„å¤§ï¼ˆæç«¯æƒ…å†µå˜æˆçº¯å™ªå£°ï¼‰ä¼šå¯¼è‡´åŠ å™ªä¹‹åçš„æ•°æ®åˆ†å¸ƒä¸¥é‡åç¦»åŸå§‹æ•°æ®åˆ†å¸ƒï¼›åä¹‹ï¼Œå™ªå£°åŠ çš„å°ï¼ˆæç«¯æƒ…å†µå˜æˆ0å™ªå£°ï¼‰ä¸èƒ½å¾ˆå¥½çš„è§£å†³å‰è¿°å­˜åœ¨çš„é—®é¢˜ã€‚ä¸ºäº†æƒè¡¡è¿™ä¸¤ä¸ªæ–¹é¢ï¼Œä½œè€…æå‡ºåŒæ—¶ä½¿ç”¨å¤šä¸ªä¸åŒå¤§å°å™ªå£°åŠ›åº¦çš„é€€ç«æ–¹æ¡ˆã€‚
### 2.2.6 é€€ç«æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·ï¼ˆannealed Langevin dynamicsï¼‰

æœ‰ $L$ ä¸ªé€’å¢çš„ $ğœ_1<ğœ_2<â‹¯<ğœ_L$ ï¼Œåˆ†å¸ƒ $q(X)$ ä¸æ¯ä¸ªé«˜æ–¯å™ªå£° $\sigma\epsilon \sim \mathcal{N}(0,ğœ_i^2I),i=1,2,â‹¯,L$ ç»“åˆæˆå—æ‰°åŠ¨çš„åˆ†å¸ƒã€‚æˆ‘ä»¬æŠŠå…¬å¼ï¼ˆ

æˆ‘ä»¬å‘ç° $\sigma$ æœ€å¤Ÿå°æ—¶ï¼Œ $\tilde{x} \approx x$  ï¼Œã€‚

ï¼Œå…¶ä¸­å½“Â ${x}\in \mathbb{R} ^D$Â æ—¶Â $s_{\theta}\left( {x},\sigma \right) \in \mathbb{R} ^D$Â ã€‚ä¸€èˆ¬æŠŠÂ $s_{\theta}\left( {x};t \right)$Â ç§°ä¸ºå™ªå£°æ¡ä»¶åˆ†æ•°ç½‘ç»œã€‚


![](åˆ†æ•°åœ¨é«˜ä½åŒºåŸŸçš„ä½œç”¨.png)
æˆ‘ä»¬å†å›åˆ°å‘é‡åœºçš„å›¾ï¼Œè¿™ä¸ªå›¾ä»…ä»…æ¼”ç¤ºç”¨ã€‚çœŸå®æƒ…å†µæ˜¯å›¾åƒå¤§éƒ¨ä½æ˜¯çš„åŒºåŸŸæ˜¯ä½æ¦‚ç‡å¯†åº¦åŒºåŸŸï¼Œè€ŒæŸå¤±å‡½æ•°ç®€å•çš„äºŒé˜¶è®¡ç®—ä¼šå‡ºç°å¤§å¯†åº¦åŒºé—´â€œå¦¨ç¢â€å°å¯†åº¦åŒºé—´çš„é—®é¢˜ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬ä¼šåŠ å¤§å™ªå£°ï¼Œå¡«å……æ•´ä¸ªåŒºåŸŸã€‚è¾ƒå¤§çš„å™ªå£°æ˜¾ç„¶å¯ä»¥è¦†ç›–ä½å¯†åº¦åŒºåŸŸï¼Œåœ¨æ›´å¤šåŒºåŸŸè·å¾—æ›´å¥½çš„è¯„åˆ†ä¼°è®¡ï¼Œä½†æ˜¯è¿‡åº¦ç ´åäº†æ•°æ®ã€‚å¦‚å›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¾¹ç•Œæ¨¡ç³Šï¼Œè¿™å°±æ˜¯å¼ºåº¦è¿‡å¤§çš„å™ªå£°åä¹‹ä¼šå¹²æ‰°åˆ°åŸå§‹æ•°æ®çš„åˆ†å¸ƒçš„è¡¨ç°ã€‚è¿™ç§æƒ…å†µè¿˜ä¼šé€ æˆä¼°è®¡åˆ†æ•°çš„è¯¯å·®å¢å¤§ï¼Œä»è€ŒåŸºäºåŠ å™ªåçš„åˆ†æ•°ä½¿ç”¨æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·ç”Ÿæˆçš„ç»“æœä¹Ÿå°±ä¸å¤ªç¬¦åˆåŸæ•°æ®åˆ†å¸ƒã€‚ç›¸ååœ°ï¼Œå™ªå£°å¼ºåº¦å°èƒ½å¤Ÿè·å¾—ä¸åŸæ•°æ®åˆ†å¸ƒè¾ƒä¸ºè¿‘ä¼¼çš„æ•ˆæœï¼Œä½†æ˜¯å´ä¸èƒ½å¤Ÿå¾ˆå¥½åœ°â€œå¡«å……â€ä½æ¦‚ç‡å¯†åº¦åŒºåŸŸã€‚ä¸ºäº†è¾¾åˆ°ä¸¤è€…æœ€ä½³ã€‚æˆ‘ä»¬ä½¿ç”¨äº†å¤šå°ºåº¦å™ªå£°æ‰°åŠ¨ã€‚






[1] Jonathan Ho, Ajay Jain, Pieter Abbeel. Denoising Diffusion Probabilistic Models. arXiv preprint  arXiv:2006.11239v2.
[2] Yang Song, Jascha Sohl-Dickstein, Diederik P. Kingma, Abhishek Kumar, Stefano Ermon, Ben Poole. Score-Based Generative Modeling through Stochastic Differential Equations. arXiv:2011.13456
[3] Yang Song, and Stefano Ermon. Generative Modeling by Estimating Gradients of the Data Distribution. arXiv:1907.05600
[4] Pascal Vincent. A Connection Between Score Matching and Denoising Autoencoders