## 1.1 ç”Ÿæˆæ¨¡å‹
ç”Ÿæˆæ¨¡å‹åœ¨æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½é¢†åŸŸæ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå®ƒä»¬è‡´åŠ›äºå­¦ä¹ å’Œæ¨¡æ‹Ÿæ•°æ®çš„ç”Ÿæˆè¿‡ç¨‹ã€‚è¿™äº›æ¨¡å‹åœ¨å¤šç§åº”ç”¨åœºæ™¯ä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼ŒåŒ…æ‹¬å›¾åƒç”Ÿæˆã€è¯­éŸ³åˆæˆã€è¯ç‰©åˆ†å­è®¾è®¡ç­‰ã€‚ä»¥ä¸‹æ˜¯å‡ ç§ä¸»æµçš„ç”Ÿæˆæ¨¡å‹åŠå…¶ç‰¹ç‚¹ï¼š
1. **ç”Ÿæˆå¯¹æŠ—æ€§ç½‘ç»œï¼ˆGANsï¼‰**ï¼šGANsç”±ä¸¤ä¸ªå…³é”®ç»„ä»¶æ„æˆâ€”â€”ç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨ã€‚ç”Ÿæˆå™¨çš„èŒè´£æ˜¯åˆ›é€ æ•°æ®ï¼Œè€Œåˆ¤åˆ«å™¨çš„ä»»åŠ¡æ˜¯åŒºåˆ†è¿™äº›æ•°æ®æ˜¯æ¥è‡ªçœŸå®ä¸–ç•Œè¿˜æ˜¯ç”Ÿæˆå™¨çš„äº§ç‰©ã€‚é€šè¿‡è¿™ç§ç«äº‰æ€§çš„å­¦ä¹ è¿‡ç¨‹ï¼Œç”Ÿæˆå™¨é€æ­¥æå‡å…¶ç”Ÿæˆæ•°æ®çš„çœŸå®æ€§ã€‚ ![éšå¼ç”Ÿæˆæ¨¡å‹ä¸¾ä¾‹.png](images/éšå¼ç”Ÿæˆæ¨¡å‹ä¸¾ä¾‹.png)
2. **åŸºäºä¼¼ç„¶çš„ç”Ÿæˆæ¨¡å‹**ï¼šè¿™ç±»æ¨¡å‹çš„ä¸­å¿ƒç›®æ ‡æ˜¯æœ€å¤§åŒ–è§‚æµ‹æ•°æ®çš„ä¼¼ç„¶åº¦ã€‚è‡ªå›å½’æ¨¡å‹ï¼Œå¦‚PixelRNNå’ŒPixelCNNï¼Œé€šè¿‡å­¦ä¹ æ•°æ®çš„è”åˆæ¦‚ç‡åˆ†å¸ƒæ¥å®ç°æ•°æ®ç”Ÿæˆï¼›å˜åˆ†è‡ªåŠ¨ç¼–ç å™¨ï¼ˆVAEsï¼‰é‡‡ç”¨ä¼˜åŒ–å˜åˆ†ä¸‹ç•Œï¼ˆELBOï¼‰çš„æ–¹æ³•æ¥è¿‘ä¼¼å¤æ‚çš„æ•°æ®åˆ†å¸ƒï¼›è§„èŒƒåŒ–æµï¼ˆNormalizing Flowsï¼‰åˆ™é€šè¿‡ä¸€ç³»åˆ—å¯é€†å˜æ¢ï¼Œå°†ç®€å•çš„åˆ†å¸ƒé€æ­¥è½¬æ¢æˆå¤æ‚çš„ç›®æ ‡åˆ†å¸ƒã€‚ ![ä¼¼ç„¶æ¨¡å‹ä¸¾ä¾‹.png](images/ä¼¼ç„¶æ¨¡å‹ä¸¾ä¾‹.png)
3. **åŸºäºèƒ½é‡çš„å»ºæ¨¡**ï¼šåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ•°æ®çš„åˆ†å¸ƒé€šè¿‡ä¸€ä¸ªèƒ½é‡å‡½æ•°æ¥å®šä¹‰ï¼Œæ•°æ®ç‚¹çš„æ¦‚ç‡ä¸å…¶å¯¹åº”çš„èƒ½é‡æˆåæ¯”ã€‚åŸºäºåˆ†æ•°çš„ç”Ÿæˆæ¨¡å‹ï¼Œå¦‚Score-based GANsï¼Œä¸ç›´æ¥å­¦ä¹ èƒ½é‡å‡½æ•°ï¼Œè€Œæ˜¯å­¦ä¹ ä¸€ä¸ªåˆ†æ•°å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„æ¢¯åº¦ä¸æ•°æ®åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°çš„æ¢¯åº¦æˆæ­£æ¯”ï¼Œä»è€Œå®ç°å¯¹æ•°æ®ç”Ÿæˆè¿‡ç¨‹çš„å»ºæ¨¡ã€‚
**æ‰©æ•£æ¨¡å‹**æ˜¯è¿‘å¹´æ¥å¼•èµ·å¹¿æ³›å…³æ³¨çš„ä¸€ç±»ç”Ÿæˆæ¨¡å‹ï¼Œå®ƒé€šè¿‡æ¨¡æ‹Ÿä¸€ä¸ªæ¸è¿›çš„éšæœºè¿‡ç¨‹æ¥ç”Ÿæˆæ•°æ®ã€‚å®ƒæ¥è‡ªäºç‰©ç†å­¦ï¼Œæ˜¯ä¸€ç§å—åˆ°çƒ­åŠ›å­¦ä¸­éå¹³è¡¡çƒ­åŠ›å­¦åˆ†æ”¯å¯å‘çš„ç®—æ³•ï¼Œå…¶æ€æƒ³æ¥æºå°±æ˜¯ç‰©ç†å­¦çš„æ‰©æ•£è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹é€æ­¥å°†æ•°æ®ä»ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒï¼ˆå¦‚é«˜æ–¯åˆ†å¸ƒï¼‰è½¬æ¢æˆç›®æ ‡æ•°æ®åˆ†å¸ƒã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»æ•°å­¦åŸºç¡€å…¬å¼å‡ºå‘ï¼Œä½¿ç”¨å¤§å­¦äºŒå¹´çº§å·¦å³çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ¨ç†ã€‚ï¼ˆéƒ¨åˆ†çœä¼šçš„å­¦ç”Ÿå¯èƒ½é«˜ä¸­å°±å­¦å®Œäº†ğŸ˜ï¼‰è®©å¤§å®¶äº†è§£æ‰©æ•£æ¨¡å‹æ•´ä½“æµç¨‹æ¨ç†ã€‚å› ä¸ºæ‰©æ•£æ¨¡å‹çš„å…¬å¼è¾ƒå¤æ‚ï¼Œå¦‚è¯»è€…æ˜¯å·¥ç¨‹å‹è§’è‰²ï¼Œå¯¹å·¥ç¨‹éœ€æ±‚å¤§äºç†è®ºç ”ç©¶ï¼Œæˆ‘å»ºè®®ä¸è¦çº ç»“äºå…·ä½“çš„æ¨ç†ç»†èŠ‚ï¼Œä»…éœ€çŸ¥é“â€œåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œå…¬å¼è¾“å…¥æ˜¯ä»€ä¹ˆï¼Œå…¬å¼è¾“å‡ºæ˜¯ä»€ä¹ˆå³å¯â€ã€‚
## 1.2 ä»VAEæ¨¡å‹å‡ºå‘
### 1.2.1 æ½œåœ¨å˜é‡
åœ¨æ¢è®¨æ•°æ®ç”Ÿæˆçš„æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸å‡è®¾æ‰€è§‚æµ‹åˆ°çš„æ•°æ®å®é™…ä¸Šæ˜¯ç”±ä¸€ä¸ªä¸å¯è§ä½†ç›¸äº’å…³è”çš„æ½œåœ¨å˜é‡æ‰€è¡¨ç¤ºæˆ–ç”Ÿæˆçš„ï¼Œæˆ‘ä»¬ç”¨éšæœºå˜é‡ $z$  æ¥è¡¨ç¤ºè¿™ä¸ªæ½œåœ¨å˜é‡ã€‚
æ¥è‡ªè°·æ­Œå¤§è„‘å›¢é˜Ÿçš„Calvin Luoå…ˆç”Ÿç”¨æŸæ‹‰å›¾çš„â€œ**æ´ç©´å¯“è¨€**â€æ¥é˜é‡Šè¿™ç§â€œæ½œåœ¨å˜é‡â€ã€‚[1] å¦‚ä¸‹å›¾1ï¼Œåœ¨è¿™ä¸ªå¯“è¨€ä¸­ï¼Œä¸€ç¾¤äººä»å‡ºç”Ÿèµ·å°±è¢«æŸç¼šåœ¨ä¸€ä¸ªæ´ç©´å†…ï¼Œä»–ä»¬åªèƒ½çœ‹åˆ°å‰æ–¹å¢™å£ä¸Šçš„äºŒç»´é˜´å½±ã€‚ï¼ˆå¦‚å›¾1.1å·¦ä¾§ï¼‰è¿™äº›é˜´å½±æ˜¯ç”±ä¸‰ç»´ç‰©ä½“åœ¨ç«æŠŠçš„ç…§è€€ä¸‹æŠ•å°„è€Œæˆçš„ã€‚ä½†æ˜¯â€œç«æŠŠâ€å’Œâ€œä¸‰ç»´ç‰©ä½“â€å¯¹äºæ´ç©´ä¸­çš„äººæ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚å¯¹äºè¿™äº›å›šå¾’è€Œè¨€ï¼Œä»–ä»¬æ‰€ç»å†çš„ä¸€åˆ‡å®é™…ä¸Šéƒ½æ˜¯ç”±ä»–ä»¬æ°¸è¿œæ— æ³•ç›´æ¥è§‚å¯Ÿåˆ°çš„æ¦‚å¿µæ‰€å†³å®šçš„ã€‚
æŸæ‹‰å›¾æœ¬æ„æ˜¯æƒ³åŠâ€œå›šå¾’â€ä¸ºä»£è¡¨çš„â€œæ— çŸ¥äººç±»â€èµ°å‡ºæ´ç©´ï¼Œé€šè¿‡æ•™è‚²è€Œè·å¾—çœŸç†ã€‚ï¼ˆç±»ä¼¼ä¸­å›½çš„â€œäº•åº•ä¹‹è›™â€é¢„è¨€ï¼‰ä½†å´å®å®åœ¨åœ¨é˜è¿°äº†ä¸€ä¸ªç°è±¡ï¼šé€šè¿‡è§‚å¯Ÿæ•°æ®æ¥å¯¹æ½œåœ¨å˜é‡ï¼ˆâ€œç«æŠŠâ€å’Œâ€œä¸‰ç»´ç‰©ä½“â€ï¼‰ï¼Œæ˜¯å¯ä»¥å¯¹è§‚å¯Ÿåˆ°çš„äº‹ç‰©ï¼ˆâ€œäºŒç»´é˜´å½±â€ï¼‰è¿›è¡Œå»ºæ¨¡çš„ã€‚


![æ´ç©´å¯“è¨€](images/æ´ç©´å¯“è¨€.jpeg)
	*å›¾1.1 æœ‰å…³å¤å¸Œè…ŠæŸæ‹‰å›¾çš„â€œæ´ç©´å¯“è¨€â€æ’å›¾ï¼ˆå›¾ç‰‡æ¥æºï¼šç»´åŸºç™¾ç§‘ï¼‰*

åœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬æ‰€é‡åˆ°çš„å¯¹è±¡å¯ä»¥è¢«è§†ä¸ºç”±æŸäº›é«˜çº§è¡¨ç¤ºç”Ÿæˆçš„å‡½æ•°ï¼›è¿™äº›é«˜çº§è¡¨ç¤ºå¯èƒ½åŒ…å«äº†è¯¸å¦‚é¢œè‰²ã€å¤§å°ã€å½¢çŠ¶ç­‰æŠ½è±¡å±æ€§ã€‚æˆ‘ä»¬æ‰€è§‚å¯Ÿåˆ°çš„ç°è±¡ï¼Œå¯ä»¥è¢«ç†è§£ä¸ºè¿™äº›æŠ½è±¡æ¦‚å¿µçš„ä¸‰ç»´â€œæŠ•å½±â€æˆ–å…·ä½“åŒ–ï¼Œæ­£å¦‚æ´ç©´ä¸­çš„äººæ‰€è§‚å¯Ÿåˆ°çš„å®é™…ä¸Šæ˜¯ä¸‰ç»´ç‰©ä½“çš„äºŒç»´æŠ•å½±ä¸€æ ·ã€‚å°½ç®¡æ´ç©´ä¸­çš„äººæ°¸è¿œæ— æ³•çœ‹åˆ°ï¼ˆç”šè‡³å®Œå…¨ç†è§£ï¼‰é‚£äº›éšè—çš„ç‰©ä½“ï¼Œä½†ä»–ä»¬ä»ç„¶èƒ½å¤Ÿå¯¹è¿™äº›ç‰©ä½“è¿›è¡Œæ¨ç†å’Œæ¨æ–­ã€‚
å¯æ‚²çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸æ´ç©´äººå¯èƒ½æ— æ³•å®Œå…¨ç†è§£è¿™äº›æŠ½æ ·å±æ€§çš„å…·ä½“å«ä¹‰è¿™æºäºä¿¡æ¯ç†µå¢åŸç†ï¼šåœ¨æ²¡æœ‰é¢å¤–ä¿¡æ¯è¾“å…¥çš„æƒ…å†µä¸‹ï¼Œæ•°æ®ä»ç®€å•ä½ç»´åˆ°å¤æ‚é«˜ç»´çš„è½¬å˜æ˜¯ä¸å¯è¡Œçš„ã€‚åœ¨æ·±åº¦å­¦ä¹ æ—¶ä»£ï¼Œè¿™äº›æŠ½æ ·å±æ€§å°±æ˜¯ç»ç¥ç»ç½‘ç»œè®­ç»ƒå‡ºæ¥çš„å¤æ‚é«˜ç»´çš„å˜é‡ã€‚è€Œå›¾åƒç”Ÿæˆå°±æ˜¯æœ‰â€œç†µå‡â€ï¼ŒæŒ‰è¦æ±‚æ’åˆ—ç‰¹å¾ç­‰ç‰¹ç‚¹ã€‚è¿™è¿«ä½¿æˆ‘ä»¬åªæœ‰ç ´åç†µå¢åŸç†çš„å‰ææ¡ä»¶ï¼Œå³â€œæ²¡æœ‰é¢å¤–ä¿¡æ¯è¾“å…¥â€ã€‚æˆ‘ä»¬å¿…é¡»ç”¨å¤§é‡çš„çœŸå®å›¾ç‰‡ç»„æˆçœŸå®é«˜ç»´å‘é‡æ¥è®­ç»ƒä¸€ä¸ªè§†è§‰ç”Ÿæˆæ¨¡å‹ï¼Œç„¶åå†è®©è¿™ä¸ªç”Ÿæˆæ¨¡å‹æ¥ç”Ÿæˆå›¾ç‰‡ã€‚è®­ç»ƒå›¾ç‰‡çš„ä¸°å¯Œåº¦å†³å®šäº†ç”Ÿæˆæ¨¡å‹çš„èƒ½åŠ›ï¼Œç”Ÿæˆæ¨¡å‹çš„èƒ½åŠ›å†³å®šäº†ç”Ÿæˆå›¾åƒçš„ç»“æœã€‚è¿™ä¹Ÿåº”å’Œäº†æŸæ‹‰å›¾çš„å»ºè®®ï¼šæ´ç©´äººåªæœ‰èµ°å‡ºæ´ç©´ï¼Œæ‰èƒ½çœŸå®äº†è§£å‘¨å›´çš„ç°è±¡ã€‚

### 1.2.2 è¯æ®ä¸‹ç•ŒELBO

åœ¨æ•°å­¦ä¸Šï¼Œæ›´å¸¸ç”¨çš„â€œéšå˜é‡â€ä¸€è¯æ¥æ›¿ä»£â€œæ½œåœ¨å˜é‡â€çš„ä½¿ç”¨ã€‚
æˆ‘ä»¬å°†è§‚å¯Ÿæ•°æ® $x$ ä¸éšå˜é‡ $z$ ç»„æˆä¸€ä¸ªè”åˆåˆ†å¸ƒ$p(x,z)$ ï¼Œå¹¶å®šä¹‰è§‚æµ‹æ•°æ® $x$ çš„è¾“å‡ºæ¦‚ç‡ä¸º $p(x)$ ã€‚åŸºäºâ€œä¼¼ç„¶â€çš„ç”Ÿæˆå»ºæ¨¡è¿‡ç¨‹ï¼Œå°±æ˜¯æœ€å¤§åŒ–æ‰€æœ‰è§‚æµ‹ $x$ çš„æ¦‚ç‡ $p(x)$ çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•æ“ä½œï¼š
æˆ‘ä»¬å¯ä»¥å¯¹éšå˜é‡ $z$ æ±‚è¾¹ç¼˜ç§¯åˆ†ï¼š
$$p(x)= \int p(x,z)dz \tag{1.1}$$

æˆ–è€…ï¼Œæˆ‘ä»¬æ±‚åŠ©äºæ¦‚ç‡çš„é“¾å¼æ³•åˆ™ï¼š
$$p(x)=\frac {p(x,z)}{p(z|x)} \tag{1.2}$$
å…¬å¼ï¼ˆ1.1ï¼‰çš„æ–¹æ¡ˆç›´æ¥é€šè¿‡è®¡ç®— $p(x)$ æ˜¯éå¸¸å›°éš¾çš„ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°æ‰€æœ‰éšå˜é‡ $z$ çš„è®¡ç®—ï¼Œå¦‚æœæ¨¡å‹æ˜¯ä»¥ç¥ç»ç½‘ç»œä¸ºä»£è¡¨çš„å¤æ‚æ¨¡å‹ä¼šéå¸¸æ£˜æ‰‹ã€‚å…¬å¼ï¼ˆ1.2ï¼‰ä¸­ï¼Œ$p(x,z)$ å¯ä»¥è®¤ä¸ºåœ¨éšå˜é‡ $z$ å­˜åœ¨çš„åŒæ—¶å…·æœ‰æ¡ä»¶ $x$ çš„è¾“å‡ºï¼›$p(z|x)$ æ˜¯è·å–éšå˜é‡çš„è§£ç å™¨ï¼Œç”¨äºä»è§‚æµ‹ $x$ ä¸­é¢„æµ‹éšå˜é‡ $z$ ã€‚åˆ©ç”¨å…¬å¼ï¼ˆ1.2ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¨å¯¼å‡º $p(x)$ çš„è¯æ®ä¸‹ç•Œï¼ˆEvidence Lower Boundï¼ŒELBOï¼‰ã€‚ä¸ªäººè®¤ä¸ºâ€œè¯æ®ä¸‹ç•Œâ€ä¸ç®—åŸç†ï¼Œå®ƒä»…ä»…æ˜¯ä¸€ç§ä¼˜åŒ–æ€è·¯ã€‚â€œæœ€å¤§åŒ–ELBOâ€å³ä¸ºä¼˜åŒ–ç›®æ ‡å‡½æ•°çš„ä¸‹ç•Œï¼Œè®°ä¸ºâ€œELBOä»£ç†ç›®æ ‡å‡½æ•°â€ã€‚å½“ç„¶ï¼Œæœ€å®Œç¾çš„æƒ…å†µå°±æ˜¯ELBOå®Œå…¨ç­‰ä»·äºç›®æ ‡å‡½æ•°ã€‚

è®©æˆ‘ä»¬è¯•ç€æ·±å…¥æ¨ç†ä¸€ä¸‹ $p(x)$ çš„ELBOã€‚
$$
 \begin{align} 
\log p(x)& = \log \int p(x,z)dz \tag{1.3}\\ 
&= \log \int \frac {p(x,z)q_\phi(z|x)}{q_\phi(z|x)}dz \tag{1.4}\\
&= \log \mathbb{E}_{q_\phi(z|x)}[\frac{p(x,z)}{q_\phi(z|x)}]  \tag{1.5}\\
&\geq \mathbb{E}_{q_\phi(z|x)}[\log{\frac{p(x,z)}{q_\phi(z|x)}}] \tag{1.6}
 \end{align}
$$
å…¬å¼ï¼ˆ1.4ï¼‰ä¸­ï¼Œå¼•å…¥ä¸€ä¸ªé’ˆå¯¹å‚æ•° $\phi$ ä¼˜åŒ–çš„åˆ†å¸ƒ $q_\phi (z|x)$ ã€‚ç›´è§‚åœ°è¯´ï¼Œå®ƒå¯è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªç”¨ $\phi$ å‚æ•°æ¨¡å‹æ¥ä¼°è®¡ç»™å®šè§‚æµ‹ $x$ çš„éšå˜é‡ $z$ çš„çœŸå®åˆ†å¸ƒã€‚å®ƒå¯»æ±‚è¿‘ä¼¼çœŸå®çš„åéªŒ $p(z|x)$ ã€‚æˆ‘ä»¬é€šè¿‡è°ƒèŠ‚å‚æ•° $\phi$ æ¥æ¢ç´¢â€œå˜åˆ†è‡ªç¼–ç å™¨â€æ—¶ï¼Œå¯ä»¥æ§åˆ¶å¢åŠ ä¸‹ç•Œä»¥æœ€å¤§åŒ–ELBOã€‚

å…¬å¼ï¼ˆ1.5ï¼‰ä½¿ç”¨æœŸæœ›çš„é‡è¦å®šç†ã€‚è‹¥éšæœºå˜é‡ $Y$ ç¬¦åˆå‡½æ•° $Y=g(x)$ ï¼Œä¸” $\int_{-\infty}^{+\infty} g(x)f(x)dx$ ç»å¯¹æ”¶æ•›ï¼Œåˆ™æœ‰
$$E(Y)=E(g(X)) = \int_{-\infty}^{+\infty} g(x)f(x)dx \tag{1.7}$$æˆ‘ä»¬çš„å¤§å­¦æ¦‚ç‡è®ºä¹¦ç±å¯¹æ­¤è¯æ˜ä¸€ç¬”å¸¦è¿‡ï¼Œå› ä¸ºè¯æ˜è¿‡ç¨‹ç‰¹åˆ«å¤æ‚ã€‚è¯·è®°ä½è¿™ä¸ªå®šç†ï¼Œåé¢è¿˜ä¼šä½¿ç”¨ã€‚è¯·æ³¨æ„ï¼Œå…¶ä¸­ $f(x)$ è¦æ±‚æ˜¯æ¦‚ç‡å¯†åº¦ï¼Œ$g(x)$ å¯ä»¥ä¸æ˜¯ã€‚

å…¬å¼ï¼ˆ1.6ï¼‰ä½¿ç”¨äº†Jensenä¸ç­‰å¼ã€‚Jensonä¸ç­‰å¼å®šä¹‰ï¼šåœ¨ä¸ç­‰å¼ä¸­ï¼Œè‹¥ $f(x)$ ä¸ºåŒºé—´Â  $I$ Â ä¸Šçš„ä¸‹å‡¸å‡½æ•°ï¼Œåˆ™å¯¹äºä»»æ„Â $x_iâˆˆI$Â ï¼Œåœ¨æ»¡è¶³$\sum_{i=1}^{n} \lambda_i =1$Â çš„Â $\lambda_i>0(i=1,2,â‹¯,n)$ æ—¶ï¼Œä¸‹å…¬å¼æˆç«‹ï¼š
$$ f(\sum_{i=1}^n \lambda_i x_i) \leqslant \sum_{i=1}^n \lambda_i f(x_i) \tag{1.8} $$

æˆ‘ä»¬å·²æˆåŠŸåœ°åº”ç”¨äº†Jensenä¸ç­‰å¼æ¥ç›´æ¥æ¨å¯¼å‡ºæˆ‘ä»¬çš„ä¸‹ç•Œã€‚ç„¶è€Œï¼Œè¿™ä¸€æ¨å¯¼è¿‡ç¨‹æœ¬èº«å¹¶æœªæ·±å…¥æ­ç¤ºé—®é¢˜çš„æœ¬è´¨ã€‚å…·ä½“æ¥è¯´ï¼Œé€šè¿‡Jensenä¸ç­‰å¼æ‰€è·å¾—çš„ç»“è®ºä¼¼ä¹å¹¶æ²¡æœ‰å……åˆ†è§£é‡Šä¸ºä½•ELBOï¼ˆè¯æ®ä¸‹ç•Œï¼‰ç¡®å®èƒ½å¤Ÿä½œä¸ºçœŸå®åˆ†å¸ƒçš„ä¸‹ç•Œã€‚æ­¤å¤–ï¼Œå³ä¾¿æˆ‘ä»¬ç¡®è®¤äº†ELBOç¡®å®æ˜¯ä¸€ä¸ªä¸‹ç•Œï¼Œè¿™æœ¬èº«ä¹Ÿå¹¶æœªé˜æ˜ä¸ºä½•æˆ‘ä»¬åº”å½“ä»¥æœ€å¤§åŒ–ELBOä¸ºç›®æ ‡ã€‚ä¸ºäº†æ·±å…¥ç†è§£è¯æ®ï¼ˆçœŸå®åˆ†å¸ƒï¼‰ä¸ELBOä¹‹é—´çš„å†…åœ¨è”ç³»ï¼Œè®©æˆ‘ä»¬é‡æ–°å®¡è§†å¹¶è¿›è¡Œä¸€æ¬¡æ›´ç»†è‡´çš„æ¨å¯¼ï¼š
$$
\begin{align} 
\log p(x)& = \log p(x) \int q_\phi(z|x)dz \tag{1.9}\\ 
&= \int q_\phi(z|x)(\log p(x))dz \tag{1.10}\\
&= \mathbb{E}_{q_\phi(z|x)}[\log{p(x)}]  \tag{1.11}\\
&= \mathbb{E}_{q_\phi(z|x)}[\log{\frac{p(x,z)}{p(z|x)}}] \tag{1.12}\\
&= \mathbb{E}_{q_\phi(z|x)}[\log{\frac{p(x,z)q_\phi(z|x)}{p(z|x)q_\phi(z|x)}}] \tag{1.13} \\
&= \mathbb{E}_{q_\phi(z|x)}[\log{\frac{p(x,z)}{q_\phi(z|x)}}]  + \mathbb{E}_{q_\phi(z|x)}[\log{\frac{q_\phi(z|x)}{p(z|x)}}] \tag{1.14}\\
&= \mathbb{E}_{q_\phi(z|x)}[\log{\frac{p(x,z)}{q_\phi(z|x)}}]  + D_{KL}(q_\phi(z|x)||p(z|x)) \tag{1.15}\\
&\geq \mathbb{E}_{q_\phi(z|x)}[\log{\frac{p(x,z)}{q_\phi(z|x)}}]  \tag{1.16}\\
\end{align}
$$
ä»å…¬å¼ï¼ˆ1.10-1.11ï¼‰ä½¿ç”¨å…¬å¼ï¼ˆ1.7ï¼‰ï¼Œå…¶ä¸­ $q_\phi(z|x)$ æ˜¯æ¦‚ç‡å¯†åº¦å‡½æ•°ï¼Œå¯¹ $z$ ç§¯åˆ†ç­‰äº1ã€‚
å…¬å¼ï¼ˆ1.14ï¼‰åˆ°å…¬å¼ï¼ˆ1.15ï¼‰ä½¿ç”¨KLæ•£åº¦å…¬å¼ï¼Œä¹Ÿç§°ä¸ºKullback-Leibleræ•£åº¦ã€‚å®ƒæ˜¯ä¸€ç§è¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒå·®å¼‚çš„åº¦é‡æ–¹æ³•ã€‚å®ƒæ˜¯ä¿¡æ¯è®ºä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œç”¨äºé‡åŒ–ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒPå’ŒQä¹‹é—´çš„ä¸ç›¸ä¼¼æ€§ã€‚å…¶å®šä¹‰ä¸ºï¼š
$$KL(P||Q)=\int p(x) \log\frac{P(x)}{Q(x)} dx \tag{1.17}$$
è¿™ä¸ªå…¬å¼åœ¨åé¢ä¹Ÿä¼šç”¨ä¸Šã€‚KLæ•£åº¦æ˜¯éå¯¹ç§°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ$D_{KL}(Pâˆ£âˆ£Q)$ ä¸ $D_{KL}(Qâˆ£âˆ£P)$ é€šå¸¸æ˜¯ä¸ç›¸ç­‰çš„ï¼ŒåŒæ—¶KLæ•£åº¦å¿…ä¸å°äº0ã€‚

æˆ‘ä»¬ä»å…¬å¼ï¼ˆ1.15ï¼‰æ¸…æ¥šåœ°è§‚å¯Ÿåˆ°ï¼ŒçœŸå®åˆ†å¸ƒç­‰äºELBOåŠ ä¸Šè¿‘ä¼¼åéªŒ $q_\phi(z|x)$ å’ŒçœŸæ­£åéªŒ $p(z|x)$ ä¹‹é—´çš„KLæ•£åº¦ã€‚æ­£æ˜¯è¿™ä¸ªKLæ•£åº¦é¡¹åœ¨ç¬¬ä¸€æ¬¡æ¨å¯¼çš„å…¬å¼ï¼ˆ1.8ï¼‰ä¸­è¢«Jensenä¸ç­‰å¼ç¥å¥‡åœ°æ¶ˆé™¤äº†ã€‚å½“è¿‘ä¼¼åéªŒ $q_\phi(z|x)$ å’ŒçœŸæ­£åéªŒ $p(z|x)$ ç›¸ç­‰æ—¶Jensenä¸ç­‰å¼çš„ç­‰å·æˆç«‹ã€‚ç†è§£è¿™ä¸€æƒ…å½¢ä¸ä»…æ˜¯ç†è§£ELBOçš„å…³é”®ï¼Œä¹Ÿæ˜¯ç†è§£ä¸ºä»€ä¹ˆä¼˜åŒ–ELBOå°±æ˜¯çš„ä¼˜åŒ–ç›®æ ‡å‡½æ•°çš„åŸå› ã€‚
æˆ‘ä»¬å·²ç»æ·±å…¥æ¢ç©¶äº†ä¸ºä½•æˆ‘ä»¬è‡´åŠ›äºæœ€å¤§åŒ–ELBOçš„åŸå› ã€‚åœ¨å¼•å…¥æˆ‘ä»¬å¸Œæœ›å»ºæ¨¡çš„éšå˜é‡ $z$ ä¹‹åï¼Œæˆ‘ä»¬çš„æ ¸å¿ƒç›®æ ‡æ˜¯æŒæ¡å¹¶å­¦ä¹ é‚£äº›èƒ½å¤Ÿç²¾å‡†æè¿°æˆ‘ä»¬è§‚å¯Ÿåˆ°çš„æ•°æ®çš„æ½œåœ¨ç»“æ„ã€‚æ¢è¨€ä¹‹ï¼Œæˆ‘ä»¬è‡´åŠ›äºä¼˜åŒ–æˆ‘ä»¬çš„å˜åˆ†è¿‘ä¼¼åéªŒåˆ†å¸ƒ $q_\phi(z|x)$ï¼Œä»¥ä¾¿å®ƒèƒ½å¤Ÿå°½å¯èƒ½åœ°è´´è¿‘çœŸå®åéªŒåˆ†å¸ƒ  $p(z|x)$ã€‚è¿™ç§åŒ¹é…é€šå¸¸æ˜¯é€šè¿‡æœ€å°åŒ–ä¸¤è€…ä¹‹é—´çš„KLæ•£åº¦æ¥å®ç°çš„ï¼Œç†æƒ³æƒ…å†µä¸‹ï¼Œè¯¥æ•£åº¦åº”è¶‹è¿‘äºé›¶ã€‚
ç„¶è€Œï¼Œç›´æ¥æœ€å°åŒ–KLæ•£åº¦å­˜åœ¨ä¸€å®šçš„æŒ‘æˆ˜ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ç›´æ¥è·å¾—çœŸå®åéªŒåˆ†å¸ƒ $p(z|x)$ çš„ç¡®åˆ‡å½¢å¼ã€‚åœ¨å…¬å¼ï¼ˆ1.15ï¼‰ä¸­ï¼Œ$\log p(x)$ é¡¹æ˜¯ELBOä¸KLæ•£åº¦ä¹‹å’Œï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹äºå‚æ•° $\phi$ æ— å…³çš„å¸¸æ•°ï¼Œé’ˆå¯¹å‚æ•° $\phi$ å¯¹ELBOé¡¹çš„ä»»ä½•æå‡éƒ½å°†ä¸å¯é¿å…åœ°å¯¼è‡´KLæ•£åº¦é¡¹çš„ç­‰é‡å‡å°‘ã€‚å› æ­¤ï¼Œâ€œæœ€å¤§åŒ–ELBOâ€å¯ä»¥è§†ä¸ºä¸€ç§ä»£ç†æ‰‹æ®µï¼Œç”¨ä»¥å®Œç¾åœ°æ¨¡æ‹ŸçœŸå®çš„éšåéªŒåˆ†å¸ƒï¼›æˆ‘ä»¬å¯¹ELBOçš„ä¼˜åŒ–è¶Šå……åˆ†ï¼Œæˆ‘ä»¬çš„è¿‘ä¼¼åéªŒåˆ†å¸ƒå°±è¶Šæ¥è¿‘äºçœŸå®çš„åéªŒåˆ†å¸ƒã€‚

### 1.2.3 å˜åˆ†è‡ªç¼–ç ï¼ˆVariational Autoencodersï¼Œ VAEï¼‰
å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆVariational Autoencoderï¼Œç®€ç§°VAEï¼‰æ˜¯ä¸€ç§ç”Ÿæˆæ¨¡å‹ï¼Œç»“åˆäº†æ·±åº¦å­¦ä¹ å’Œæ¦‚ç‡æ¨¡å‹ç­‰ç†è®ºã€‚æˆ‘ä»¬ä»ä¸€ç³»åˆ—ç”± $\phi$ å‚æ•°ç»„æˆçš„æ½œåœ¨åˆ†å¸ƒä¸­ä¼˜åŒ–æœ€ä½³çš„ $q_\phi(z|x)$ï¼Œè¿™ç§æ–¹æ¡ˆå«â€œ**å˜åˆ†**ï¼ˆvariationalï¼‰â€ï¼›è¾“å…¥æ•°æ®ä¼šç»è¿‡ä¸€ä¸ªç“¶é¢ˆè¡¨ç¤ºåå†è®­ç»ƒé¢„æµ‹è‡ªå·±ï¼Œè¿™ç§ç»“æ„è¢«ç§°ä¸ºâ€œ**è‡ªç¼–ç å™¨**ï¼ˆautoencodersï¼‰â€ã€‚VAEä¸ä»…èƒ½å¤Ÿå­¦ä¹ æ•°æ®çš„æœ‰æ•ˆè¡¨ç¤ºï¼Œè¿˜èƒ½ç”Ÿæˆæ–°çš„æ•°æ®æ ·æœ¬ã€‚VAEçš„å…³é”®åˆ›æ–°åœ¨äºå®ƒä½¿ç”¨å˜åˆ†æ¨æ–­æ¥è¿‘ä¼¼å¤æ‚çš„åéªŒåˆ†å¸ƒï¼Œå¹¶é€šè¿‡æœ€å°åŒ–KLæ•£åº¦æ¥é¼“åŠ±æ½œåœ¨ç©ºé—´çš„ç»“æ„åŒ–ã€‚å¦‚æœ $p(x)$ æ˜¯VAEï¼Œå…¬å¼ï¼ˆ1.9-1.16ï¼‰çš„å†…å®¹å¯ä»¥å¤ç”¨ï¼ŒåŒæ—¶è®©æˆ‘ä»¬å†è¿›ä¸€æ­¥åˆ†æVAEçš„Â ELBOï¼š
$$
\begin{align} 
\mathbb{E}_{q_\phi(z|x)}[\log\frac{p(x,z)}{q_\phi(z|x)}] &= \mathbb{E}_{q_\phi(z|x)}[\log\frac{p_\theta(x|z)p(z)}{q_\phi(z|x)}] \tag{1.18} \\
&= \mathbb{E}_{q_\phi(z|x)}[\log p_\theta(x|z)] + \mathbb{E}_{q_\phi(z|x)}[\log\frac{p(z)}{q_\phi(z|x)}] \tag{1.19} \\
&= \underbrace{\mathbb{E}_{q_\phi(z|x)}[\log p_\theta(x|z)]}_{é‡å»ºé¡¹} - \underbrace{D_{KL}(q_\phi(z|x)||p(z))}_{å…ˆéªŒåŒ¹é…é¡¹} \tag{1.20}
\end{align} 
$$
å°†å…¬å¼ï¼ˆ1.20ï¼‰ä¸å…¬å¼ï¼ˆ1.15ï¼‰ä½œæ¯”è¾ƒï¼Œæˆ‘ä»¬å‘ç°å½“ $p(x)$ æ˜¯æŸä¸ªç¡®å®šçš„VAEæ—¶ï¼Œ $p_\theta(x|z)$ å°±å·²ç»ç¡®å®šäº†ã€‚æˆ‘ä»¬å­¦ä¹ äº†ä¸€ä¸ªå¯ä»¥è¢«è§†ä¸º**ç¼–ç å™¨**çš„ä¸­é—´ç“¶é¢ˆåˆ†å¸ƒ $q_\phi(z|x)$ ï¼Œå®ƒå°†è¾“å…¥è½¬æ¢ä¸ºå«éšå˜é‡çš„åˆ†å¸ƒã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä¸€ä¸ªåå‘å‡½æ•° $p_\theta(x|z)$ ä½œä¸º**è§£ç å™¨**ï¼Œå°†ç»™å®šçš„éšå˜é‡ $z$ è½¬æ¢ä¸ºè§‚æµ‹å€¼ $x$ ã€‚
å…¬å¼ï¼ˆ1.20ï¼‰ä¸­çš„ä¸¤é¡¹éƒ½æœ‰æ˜ç¡®çš„å«ä¹‰ï¼šç¬¬ä¸€é¡¹å†³å®šæˆ‘ä»¬åœ¨å˜åˆ†åˆ†å¸ƒä¸­ä½¿ç”¨â€œç¼–ç å™¨-è§£ç å™¨ç»“æ„â€é‡æ„åˆ†å¸ƒçš„å¯èƒ½æ€§ï¼Œè¿™ä¿è¯äº†å­¦ä¹ åˆ°çš„åˆ†å¸ƒæ˜¯åˆ©ç”¨æœ‰æ•ˆéšå˜é‡ $z$ å†ç”Ÿçš„åŸå§‹æ•°æ®ï¼›ç¬¬äºŒé¡¹è®°å½•äº†å­¦ä¹ åˆ°çš„å˜åˆ†åˆ†å¸ƒä¸æŒæœ‰å…ˆéªŒä¿¡æ¯çš„éšå˜é‡ç›¸ä¼¼ç¨‹åº¦ã€‚
ä»VAEå®šä¹‰å‡ºå‘ï¼Œæˆ‘ä»¬äº†è§£å¦‚ä½•ä½¿ç”¨ç¼–ç å™¨å‚æ•° $\phi$ ã€è§£ç å™¨å‚æ•° $\theta$ è”åˆä¼˜åŒ–ELBOã€‚VAEçš„**ç¼–ç å™¨**é€šå¸¸é€‰æ‹©ç”¨å…·æœ‰å¯¹è§’åæ–¹å·®çš„å¤šå…ƒé«˜æ–¯åˆ†å¸ƒæ¥å»ºæ¨¡ï¼Œå…ˆéªŒé€šå¸¸è¢«é€‰æ‹©ä¸ºæ ‡å‡†çš„å¤šå…ƒé«˜æ–¯ï¼Œå¦‚ä¸‹
$$
\begin{align} 
q_\phi(z|x)&=\mathcal{N}(z; \mu_\phi(x),\sigma^{2}_{\phi}(x)I ) \tag{1.21} \\
p(z)&= \mathcal{N}(z;0,I) \tag{1.22}
\end{align} 
$$

æˆ‘ä»¬åˆ©ç”¨ä¸¤ä¸ªé«˜æ–¯åˆ†å¸ƒçš„KLæ•£åº¦å…¬å¼ (23)
$$
D_{KL}(\mathcal{N}(Î¼_1â€‹,Ïƒ_1^2â€‹)||\mathcal{N}(Î¼_2â€‹,Ïƒ_2^2â€‹))
=\log \frac{Ïƒ_2}{â€‹Ïƒ_1}â€‹â€‹âˆ’\frac{1}{2}â€‹+\frac{Ïƒ_1^2+(Î¼_1â€‹-Î¼_2)^2}{2Ïƒ_2^2} \tag{1.23}â€‹
$$
å¯ä»¥ç›´æ¥è®¡ç®—ELBOçš„KLæ•£åº¦é¡¹ï¼ˆå…¬å¼ï¼ˆ1.20ï¼‰ä¸­å…ˆéªŒåŒ¹é…é¡¹ï¼Œprior matching termï¼‰ï¼Œè¿˜å¯ä»¥ç”¨**è’™ç‰¹å¡æ´›ä¼°è®¡**æ¥è¿‘ä¼¼çš„é‡å»ºé¡¹ï¼ˆreconstruction termï¼Œå…¬å¼ï¼ˆ1.20ï¼‰ä¸­é‡å»ºé¡¹ï¼‰ã€‚æˆ‘ä»¬çš„ç›®æ ‡å¯ä»¥é‡å†™ä¸º
$$
\arg\max_{\phi,\theta} \mathbb{E}_{q_\phi(z|xï¼‰}[\log p_\theta(x|z)]âˆ’D_{KL}(q_\phi(z|x)||p(z)) \approx \arg \max_{\phi,\theta} \frac{1}{L}\sum_{l=1}^{L} \log p_\theta(x|z^{(l)})âˆ’D_{KL}(q_\phi(z|x)||p(z)) \tag{1.24}
$$
>**è’™ç‰¹å¡æ´›ä¼°è®¡**æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨éšæœºæŠ½æ ·æ¥ä¼°è®¡ä¸€ä¸ªä¸ç¡®å®šçš„é‡,è¿™ç§ä¼°è®¡æœ¬è´¨ä¸Šæºè‡ªå¤§æ•°å®šç†ã€‚åœ¨æœŸæœ›ä¸Šæˆ‘ä»¬å…ˆè€ƒè™‘å…¬å¼ï¼ˆ1.7ï¼‰ï¼š
$$
\mathbb{E}_{p(x)}[f(x)]=\int_{-\infty}^{+\infty} f(x)p(x)dx
$$
> å¦‚è¦ä½¿ç”¨è’™ç‰¹å¡æ´›æ–¹æ³•æ¥ä¼°è®¡ï¼Œæˆ‘ä»¬å¯ä»¥éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š
1. ç”Ÿæˆéšæœºæ ·æœ¬ï¼šé¦–å…ˆï¼Œ æ ¹æ® $p(x)$ åˆ†å¸ƒçš„æƒ…å†µé‡‡æ ·ä¸€ç³»åˆ—éšæœºç‚¹ $X_1,â€¦,X_n$ ã€‚
2. è®¡ç®—æ ·æœ¬çš„å‡½æ•°å€¼ï¼šæ¥ä¸‹æ¥ï¼Œå¯¹äºæ¯ä¸€ä¸ªéšæœºé‡‡æ · $X_i$â€‹ ï¼Œè®¡ç®— $f(X_i)$ çš„å€¼ã€‚
3. æœŸæœ›ä¼°è®¡ï¼šè®¡ç®— $Q_n=\frac{1}{n}\sum_{i=1}^nf(X_i)$ çš„å€¼å³ä¸ºæœŸæœ› $\mathbb{E}_{p(x)}[f(x)]$ çš„è¿‘ä¼¼å€¼ã€‚

å…¬å¼ï¼ˆ1.24ï¼‰æ˜¯VAEå¸¸è§çš„æ¨ç†è¿‡ç¨‹ã€‚ä½†ä»…åšåˆ°è¿™äº›è¿˜ä¸å¤Ÿï¼Œä¸ºäº†èƒ½å¤Ÿé€‚é…æ·±åº¦å­¦ä¹ çš„åå‘ä¼ æ’­ç®—æ³•è¿›è¡Œæ¢¯åº¦ä¸‹é™ï¼ŒVAEé‡‡ç”¨**é‡å‚æ•°åŒ–**æŠ€å·§ã€‚**é‡å‚æ•°åŒ–**æŠ€å·§å°†ä¸€ä¸ªéšæœºå˜é‡é‡å†™ä¸ºä¸€ä¸ªå™ªå£°å˜é‡çš„ç¡®å®šæ€§å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œæ¥è‡ªæ­£æ€åˆ†å¸ƒ $x\in \mathcal{N}(x;\mu,\sigma^2)$ï¼ˆå…¶ä¸­å‡å€¼å’Œæ–¹å·®åˆ†åˆ«ä¸º $\mu$ å’Œ $\sigma^2$ ï¼‰å¯é‡å†™ä¸ºï¼š
$$
x=\mu + \sigma \epsilon, \epsilon \sim \mathcal{N}(\epsilon;0,I)
$$
è¿™ä¸ªå…¬å¼å°±æ˜¯é«˜ä¸­å­¦åˆ°çš„æ­£æ€åˆ†å¸ƒæ ‡å‡†åŒ– $y=\frac{x-\mu}{\sigma}$ã€‚åœ¨VAEä¸­ï¼Œä¸ºäº†è§£å†³æ¢¯åº¦å›ä¼ çš„é—®é¢˜ï¼Œå­˜åœ¨è¿ç»­æ¢¯åº¦ã€‚æˆ‘ä»¬å°†æ¯ä¸ªéšå˜é‡ $z$ ç»ç”±â€œè¾“å…¥$x$ â€å’Œâ€œè¾…åŠ©å™ªå£°å˜é‡ $\epsilon$ â€åŒ…è£…åè®¡ç®—å¾—åˆ°çš„ï¼Œå¦‚ä¸‹ï¼š
$$
z = \mu_\phi(x) + \sigma_\phi(x) \odot \epsilon, \epsilon \sim \mathcal{N}(\epsilon;0,I) \tag{1.25}
$$
è¿™é‡ŒâŠ™è¡¨ç¤ºé€å…ƒç´ ä¹˜æ³•ã€‚ä½¿ç”¨è¿™ç§ $z$ çš„é‡å‚æ•°åŒ–æ–¹æ³•æ ¹æ® $\phi$ è®¡ç®—å‡ºæ¢¯åº¦ä»¥ä¼˜åŒ– $\mu_\phi$ å’Œ $\sigma_\phi$ ï¼Œå¯ä¿è¯æ•´ä½“æµç¨‹å¯å¯¼ï¼Œå…·ä½“è¯·çœ‹å›¾1.2ã€‚
![](images/VAEç½‘ç»œç»“æ„.png)
	*å›¾1.2 VAEæ¨¡å‹ç»“æ„å›¾*
## 1.3 åˆ†å±‚å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆHVAEï¼‰
### 1.3.1 åˆè¯†HVAE
åˆ†å±‚å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆHierarchical Variational Autoencoder, HVAEï¼‰æ˜¯å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆVariational Autoencoder, VAEï¼‰çš„ä¸€ç§æ‰©å±•ï¼Œå®ƒå°†VAEå•å±‚éšå˜é‡æ¨¡å‹æ¨å¹¿åˆ°å¤šä¸ªéšå˜é‡å±‚çº§ã€‚åœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œè¾ƒä½å±‚çš„éšå˜é‡å¯ä»¥è¢«çœ‹ä½œæ˜¯ç”±æ›´é«˜å±‚ã€æ›´æŠ½è±¡çš„éšå˜é‡ç”Ÿæˆçš„ã€‚å¦‚å›¾1.3æ‰€ç¤ºã€‚åˆ†å±‚å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆHVAEï¼‰ç›¸æ¯”äºä¼ ç»Ÿçš„å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆVAEï¼‰å…·æœ‰ä¸€äº›æ˜¾è‘—çš„ä¼˜ç‚¹ï¼Œä¸»è¦æºäºå…¶**æ›´ä¸°å¯Œçš„è¡¨ç¤ºèƒ½åŠ›**ï¼šå¯¹äºæŸäº›å¤æ‚çš„æ•°æ®åˆ†å¸ƒï¼Œå•å±‚çš„VAEå¯èƒ½éš¾ä»¥æ•æ‰å…¶å…¨éƒ¨ç‰¹æ€§ï¼Œè€ŒHVAEé€šè¿‡å¤šçº§éšå˜é‡å¯ä»¥æ›´å¥½åœ°æ¨¡æ‹Ÿè¿™äº›å¤æ‚æ€§ã€‚HVAEé€šè¿‡å¢åŠ éšå˜é‡çš„å±‚çº§ï¼Œèƒ½å¤Ÿæ•æ‰åˆ°æ›´å¤æ‚çš„æ•°æ®ç»“æ„å’Œæ¨¡å¼ã€‚æ¯ä¸€å±‚å¯ä»¥æ•æ‰åˆ°ä¸åŒçº§åˆ«çš„æŠ½è±¡ç‰¹å¾ï¼Œä»è€Œæä¾›æ›´ä¸°å¯Œçš„æ•°æ®è¡¨ç¤ºã€‚

![](images/1.2.3-1.png)
	*å›¾1.3. ä¸€ä¸ªå…·æœ‰Tå±‚éšç©ºé—´çš„é©¬å°”å¯å¤«å±‚æ¬¡å˜åˆ†è‡ªç¼–ç å™¨ã€‚ç”Ÿæˆè¿‡ç¨‹ä¸ºä¸€ä¸ªé©¬å°”å¯å¤«é“¾ï¼Œå…¶ä¸­æ¯ä¸ªéšå˜é‡ $z_t$ åªä»å‰ä¸€ä¸ªéšå˜é‡ $z_{t+1}$ ä¸­ç”Ÿæˆ.*
### 1.3.2 é©¬å°”å¯å¤«åˆ†å±‚å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆMHVAEï¼‰
åœ¨HVAE ä¸­ï¼Œé€šå¸¸å…·æœ‰ T ä¸ªå±‚çº§çš„æ¨¡å‹ï¼Œæ¯å±‚çš„éšå˜é‡éƒ½ä¾èµ–äºå‰é¢é‚£å±‚æ‰€æœ‰çš„éšå˜é‡ã€‚ä½†æ˜¯åœ¨è¿™é¡¹å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¸“æ³¨äºä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œç§°ä¸ºé©¬å°”å¯å¤«åˆ†å±‚å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆMarkovian Hierarchical Variational Autoencoderï¼ŒMHVAEï¼‰ã€‚åœ¨ MHVAE ä¸­ï¼Œç”Ÿæˆè¿‡ç¨‹æ˜¯ä¸€ä¸ªé©¬å°”å¯å¤«é“¾ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»ä¸Šå±‚åˆ°ä¸‹å±‚çš„æ¯ä¸ªè½¬æ¢éƒ½æ˜¯é©¬å°”å¯å¤«è¿‡ç¨‹çš„ï¼Œå³æ¯ä¸ªéšå˜é‡Â $z_t$ çš„è§£ç åªä¼šä¾èµ–äºå‰ä¸€å±‚éšå˜é‡Â $z_{t+1}$ ã€‚ç›´è§‚åœ°ç†è§£ï¼Œè¿™å°±æ˜¯å°†å¤šä¸ª VAE å±‚çº§å †å åœ¨ä¸€èµ·ï¼Œå¦‚å›¾1.3æ‰€ç¤ºï¼›å¦ä¸€ä¸ªé€‚å½“çš„æœ¯è¯­æ¥æè¿°å®ƒï¼Œå°±æ˜¯é€’å½’ VAEã€‚æ•°å­¦ä¸Šï¼Œæˆ‘ä»¬å°† MHVAE çš„è”åˆåˆ†å¸ƒå’ŒåéªŒè¡¨ç¤ºä¸ºï¼š
$$
\begin{align}
p(x, z_{1:T}) &= p (z_T )p_Î¸(x|z_1) \prod_{t=2}^T p_Î¸(z_{tâˆ’1}|z_t) \tag{1.26} \\
q_\phi(z_{1:T}|x) &= q_\phi(z_1|x) \prod^T_{t=2} q_\phi(z_t|z_{tâˆ’1}) \tag{1.27}
\end{align}
$$
å…¬å¼ï¼ˆ1.26ï¼Œ1.27ï¼‰ä¸å…¬å¼ï¼ˆ1.21ï¼Œ1.22ï¼‰å¯ä»¥æ¯”è¾ƒç€çœ‹ã€‚åŒæ ·å¸¦å…¥ELBOå…¬å¼å…¬å¼ï¼ˆ1.å¼ï¼ˆ3-6ï¼‰æ”¹å†™ä¸ºï¼š
$$
 \begin{align} 
\log p(x)& = \log \int p(x,z_{1:T})dz_{1:T} \tag{1.28}\\ 
&= \log \int \frac {p(x,z_{1:T})q_\phi(z_{1:T}|x)}{q_\phi(z_{1:T}|x)}dz \tag{1.29}\\
&= \log \mathbb{E}_{q_\phi(z_{1:T}|x)}[\frac{p(x,z_{1:T})}{q_\phi(z_{1:T}|x)}]  \tag{1.30}\\
&\geq \mathbb{E}_{q_\phi(z_{1:T}|x)}[\log{\frac{p(x,z_{1:T})}{q_\phi(z_{1:T}|x)}}] \tag{1.31} \\
&=\mathbb{E}_{q_\phi(z_{1:T}|x)}[\log{\frac{p (z_T )p_Î¸(x|z_1) \prod_{t=2}^T p_Î¸(z_{tâˆ’1}|z_t)}{q_\phi(z_1|x) \prod^T_{t=2} q_\phi(z_t|z_{tâˆ’1})}}] \tag{1.32}
 \end{align}
$$
å½“ç ”ç©¶MHVAEæ—¶ï¼Œè¿™ä¸ªç›®æ ‡å¯ä»¥è¿›ä¸€æ­¥åˆ†è§£ä¸ºå¤šä¸ªå¯è§£é‡Šçš„ç»„ä»¶ã€‚ä½†å•çº¯ä»å…¬å¼ï¼ˆ1.32ï¼‰æ¥çœ‹ï¼Œåœ¨æ²¡æœ‰é¢å¤–çº¦æŸæ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— æ³•å¤„ç†å¤æ‚çš„è¿ä¹˜ã€‚æˆ‘ä»¬å°†é¢å¤–è®¾ç½®ä¸‰ä¸ªçº¦æŸæ¡ä»¶ï¼Œæ¥åšä¸‹ä¸€è½®å…¬å¼æ¨å¯¼ã€‚
### 1.3.3 å˜åˆ†æ‰©æ•£æ¨¡å‹ï¼ˆVDMï¼‰ï¼šå…·æœ‰ä¸‰çº¦æŸçš„MHVAE
æˆ‘ä»¬å°†MHVAEèµ‹äºˆä¸‰ä¸ªçº¦æŸæ¡ä»¶ï¼š
1. æ¯å±‚éšå˜é‡ç»´åº¦ä¸æ•°æ®ç»´åº¦å®Œå…¨ç›¸ç­‰ã€‚
2. æ¯å±‚éšç¼–ç å™¨çš„ç»“æ„ä¸æ˜¯å­¦ä¹ å¾—æ¥çš„ï¼Œè€Œæ˜¯é¢„å®šä¹‰çš„çº¿æ€§é«˜æ–¯æ¨¡å‹ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä»¥å‰ä¸€å±‚è¾“å‡ºä¸ºä¸­å¿ƒçš„é«˜æ–¯åˆ†å¸ƒã€‚
3. éšç¼–ç å™¨çš„é«˜æ–¯å‚æ•°éšæ—¶é—´å˜åŒ–ï¼Œä½¿å¾—æœ€ç»ˆæ—¶åˆ»Â $T$Â çš„æ½œåœ¨åˆ†å¸ƒæ˜¯æ ‡å‡†é«˜æ–¯åˆ†å¸ƒã€‚
å…·æœ‰è¿™ä¸‰ç‚¹çº¦æŸçš„é©¬å°”å¯å¤«å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆMHVAEï¼‰å¯ä»¥è¢«è§†ä¸ºå˜åˆ†æ‰©æ•£æ¨¡å‹ï¼ˆVariational Diffusion Modelï¼ŒVDMï¼‰ã€‚è®©æˆ‘ä»¬è¯¦ç»†è¯´æ˜è¿™äº›å‡è®¾çš„å«ä¹‰ï¼š

æ ¹æ®ç¬¬ä¸€æ¡è§„åˆ™çº¦æŸï¼Œæˆ‘ä»¬å¯ä»¥å°†çœŸå®æ•°æ®æ ·æœ¬å’Œéšå˜é‡éƒ½è¡¨ç¤ºä¸º $x_t$ï¼Œå…¶ä¸­ $t=0$ æ—¶è¡¨ç¤ºçœŸå®æ•°æ®æ ·æœ¬ï¼Œ$tâˆˆ[1,T]$ è¡¨ç¤ºç¬¬ $t$ å±‚çº§çš„éšå˜é‡ã€‚VDMçš„åéªŒä¸MHVAEçš„åéªŒç›¸ä¼¼ï¼ˆå¦‚å…¬å¼ï¼ˆ1.27ï¼‰ï¼‰ï¼Œä½†ç°åœ¨åº”è¯¥é‡å†™ä¸ºï¼š
$$
q(x_{1:T}|x_0) = \prod^T_{t=1}q(x_t|x_{tâˆ’1}) \tag{1.33}
$$
æ ¹æ®ç¬¬äºŒæ¡è§„åˆ™çº¦æŸï¼Œç¼–ç å™¨ä¸­æ¯å±‚éšå˜é‡çš„åˆ†å¸ƒéƒ½æ˜¯å›´ç»•å…¶å‰ä¸€ä¸ªå±‚çº§éšå˜é‡çš„é«˜æ–¯åˆ†å¸ƒã€‚ä¸MHVAEä¸åŒï¼Œæ¯ä¸ªæ—¶é—´æ­¥é•¿ $t$ å¤„çš„ç¼–ç å™¨ç»“æ„è®¾ç½®æˆé«˜æ–¯æ¨¡å‹ä¸ä¼šè¢«å­¦ä¹ ï¼Œä½†å®ƒçš„å‡å€¼å’Œæ ‡å‡†å·®è¢«äº‹å…ˆè®¾ç½®ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†é«˜æ–¯ç¼–ç å™¨è®¾ç½®ä¸ºå‡å€¼$Î¼_t(x_t)=\sqrt{Î±_t}x_{t-1}$å’Œæ–¹å·®$Î£_t(x_t)=(1âˆ’Î±_t)I$ã€‚å…³äºè¿™ä¸ªå‚æ•°çš„æ¨ç†ï¼Œè¯·æš‚æ—¶ä¸è¦ç†ä¼šï¼Œåé¢ä¼šè¯æ˜ä¸ºä»€ä¹ˆé€‰è¿™ä¸ªå‚æ•°ï¼Œç°åœ¨ä½ åªéœ€çŸ¥é“ $\alpha$ æ˜¯ä¸€ä¸ªåªä¸ $t$ æœ‰å…³å¹¶è®¾ç½®åœ¨0åˆ°1ä¹‹é—´çš„å€¼å³å¯ã€‚åœ¨æ•°å­¦ä¸Šï¼Œç¼–ç å™¨çš„è½¬æ¢è¡¨ç¤ºä¸ºï¼š
$$
q(x_{1:T}|x_0)=\mathcal{N}(x_t;\sqrt{\alpha_t}x_{t-1},(1-\alpha_t)I) \tag{1.34}
$$
æ ¹æ®ç¬¬ä¸‰æ¡è§„åˆ™çº¦æŸï¼Œ$\alpha_t$ éšæ—¶é—´å˜åŒ–æœ€ç»ˆä½¿ $p(x_T)$ çš„åˆ†å¸ƒæ˜¯ä¸€ä¸ªæ ‡å‡†é«˜æ–¯åˆ†å¸ƒã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–°MHVAEçš„è”åˆåˆ†å¸ƒï¼ˆå…¬å¼26ï¼‰ä¸ºï¼š
$$
\begin{align}
p(x_{0:T})&=p(x_T)\prod_{t=1}^T p_\theta (x_{t-1}|x_t) \tag{1.35} \\
\text{where,}& \\
p(x_T)&=\mathcal{N}(x_T;0,I)
\end{align}
$$
ç»¼åˆè€ƒè™‘ï¼Œè¿™ä¸‰æ¡çº¦æŸå…±åŒå®šä¹‰äº†ä¸€ä¸ªè¿‡ç¨‹ï¼šéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå›¾åƒè¾“å…¥é€æ¸è¢«æ·»åŠ é«˜æ–¯å™ªå£°ï¼Œç›´è‡³æœ€ç»ˆå®Œå…¨è½¬å˜ä¸ºçº¯é«˜æ–¯å™ªå£°ã€‚è¿™ä¸€è¿‡ç¨‹çš„å¯è§†åŒ–ç»“æœåœ¨å›¾1.4ä¸­å¾—åˆ°äº†å±•ç¤ºã€‚

![](images/1.2.4-1.png)
	*å›¾1.4  VDMçš„ç›´è§‚è¡¨è¾¾ã€‚$x_0$ ä»£è¡¨çœŸå®è§‚å¯Ÿåˆ°çš„æ•°æ®ï¼Œä¾‹å¦‚çœŸå®å›¾ç‰‡ï¼Œ$x_T$ä»£è¡¨çº¯é«˜æ–¯å™ªéŸ³ï¼Œ$x_t$ æ˜¯ $x_0$ è®¡ç®—çš„ä¸­é—´å™ªå£°ç‰ˆæœ¬ ã€‚æ¯ä¸ª $q(x_t|x_{t-1})$ è¢«å®šä¹‰ä¸ºä½¿ç”¨å‰ä¸€è½®è¾“å‡ºçŠ¶æ€ä½œä¸ºå‡å€¼çš„é«˜æ–¯åˆ†å¸ƒã€‚

åœ¨å›¾1.4ä¸­ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç¼–ç å™¨åˆ†å¸ƒ $q(x_t|x_{t-1})$ ä¸å†ç”±å‚æ•° $\phi$ å‚æ•°åŒ–ï¼Œæ ¹æ®çº¦æŸç¬¬äºŒæ¡è§„åˆ™ï¼Œåœ¨æ¯ä¸ªæ—¶é—´æ­¥ä¸Šéƒ½è¢«å»ºæ¨¡ä¸ºå…·æœ‰æ˜ç¡®å®šä¹‰çš„é«˜æ–¯åˆ†å¸ƒï¼Œå…¶å‡å€¼å’Œæ–¹å·®éƒ½æ˜¯é¢„å…ˆè®¾å®šçš„ã€‚å› æ­¤ï¼Œåœ¨VDMä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨çš„æ˜¯å­¦ä¹ æ¡ä»¶æ¦‚ç‡ $p_\theta(x_{t-1}|x_t)$ ï¼Œè¿™ä¸»è¦ç”¨äºæ•°æ®æ¨¡æ‹Ÿã€‚è¿™æ ·çš„è®¾è®¡ç®€åŒ–äº†VDMçš„ä¼˜åŒ–æŠ½æ ·è¿‡ç¨‹ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬ä»çº¯é«˜æ–¯å™ªå£° $p(x_T)$ å¼€å§‹æŠ½æ ·ï¼Œç„¶åé€šè¿‡å»å™ªè½¬æ¢ $p_\theta(x_{t-1}|x_t)$ è¿­ä»£åœ°åº”ç”¨ $T$ æ­¥ï¼Œä»¥ç”Ÿæˆæ–°çš„æ•°æ® $x_0$ã€‚
ä¸å…¶ä»–åˆ†å±‚å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆHierarchical Variational Autoencoder, HVAEï¼‰æ¨¡å‹ç›¸ä¼¼ï¼ŒVDMä¹Ÿå¯ä»¥é€šè¿‡æœ€å¤§åŒ–è¯æ®ä¸‹ç•Œï¼ˆEvidence Lower Bound, ELBOï¼‰æ¥è¿›è¡Œä¼˜åŒ–ã€‚å…¶æ¨å¯¼è¿‡ç¨‹å¯ä»¥é‡æ–°æ•´ç†å¦‚ä¸‹ï¼š
$$
\begin{align}
\log p(x)& = \log \int p(x_{0:T})dx_{1:T}  \tag{1.36} \\ 
&= \log \int \frac{p(x_{0:T})q(x_{1:T}|x_0)}{q(x_{1:T}|x_0)}dx_{1:T} \tag{1.37}  \\
&= \log \mathbb{E}_{q(x_{1:T}|x_0)} \Big[\frac{p(x_{0:T})}{q_(x_{1:T}|x_0)} \Big]  \tag{1.38} \\
&\geq \mathbb{E}_{q(x_{1:T}|x_0)} \Big[\log{\frac{p(x_{0:T})}{q(x_{1:T}|x_0)}} \Big] \tag{1.39} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T) \prod_{t=1}^T p_\theta(x_{t-1} | x_t) }{\prod_{t=1}^T q(x_t | x_{t-1})} \Big] \tag{1.40} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) \prod_{t=2}^T p_\theta(x_{t-1} | x_t) }{q(x_T | x_{T-1})\prod_{t=1}^{T-1} q(x_t | x_{t-1})} \Big] \tag{1.41} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) \prod_{t=1}^{T-1} p_\theta(x_t | x_{t+1})}{q(x_T | x_{T-1})\prod_{t=1}^{T-1} q(x_t | x_{t-1})} \Big] \tag{1.42} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1)}{q(x_T | x_{T-1})} \Big] + \mathbb{E}_{q(x_{1:T}|x_0)} \Big[\log \prod_{t=1}^{T-1} \frac{p_\theta(x_t | x_{t+1})}{q(x_t | x_{t-1})} \Big] \tag{1.43} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} [\log p_\theta(x_0 | x_1)] + \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)}{q(x_T | x_{T-1})} \Big] + \mathbb{E}_{q(x_{1:T}|x_0)} \Big[\sum_{t=1}^{T-1} \log \frac{p_\theta(x_t | x_{t+1})}{q(x_t | x_{t-1})} \Big] \tag{1.44} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} [\log p_\theta(x_0 | x_1)] + \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)}{q(x_T | x_{T-1})} \Big] + \sum_{t=1}^{T-1} \mathbb{E}_{q(x_{1:T}|x_0)} \Big[\log \frac{p_\theta(x_t | x_{t+1})}{q(x_t | x_{t-1})} \Big] \tag{1.45} \\
&= \mathbb{E}_{q(x_1|x_0)} [\log p_\theta(x_0 | x_1)] + \mathbb{E}_{q(x_{T-1}ï¼Œx_T|x_0)} \Big[ \log \frac{ p(x_T)}{q(x_T | x_{T-1})} \Big] + \sum_{t=1}^{T-1} \mathbb{E}_{q(x_{t-1},x_t,x_{t+1}|x_0)} \Big[ \log \frac{p_\theta(x_t | x_{t+1})}{q(x_t | x_{t-1})} \Big] \tag{1.46} \\
&= \underbrace{\mathbb{E}_{q(x_1|x_0)} [\log p_\theta(x_0 | x_1)]}_{é‡å»ºé¡¹} - \underbrace{\mathbb{E}_{q(x_{T-1}|x_0)} [ D_{KL}(q(x_T|x_{T-1})||p(x_T))]}_{å…ˆéªŒåŒ¹é…é¡¹}
- \underbrace{\sum_{t=1}^{T-1} \mathbb{E}_{q(x_{t-1},x_{t+1}|x_0)}[D_{KL}(q(x_t|x_{t-1})||p(x_t|x_{t+1}))]}_{ä¸€è‡´æ€§é¡¹} \tag{1.47} \\
\end{align}
$$
å…¬å¼ï¼ˆ1.45-1.46ï¼‰çš„æ¨ç†æ¯”è¾ƒå¤æ‚ï¼Œé¦–å…ˆç»è¿‡å…¬å¼ï¼ˆ1.7ï¼‰å°†æœŸæœ›å±•å¼€ï¼Œè¿™é‡Œ $q(x_{1:T}|x_0)$ ä»£è¡¨ä» $x_0$ å¼€å§‹ï¼ŒåŒæ—¶ç”Ÿæˆ $x_1, x_2,...,x_T$ ã€‚å› ä¸ºè¿™é‡Œçš„ç›®æ ‡ç§¯åˆ†å‡½æ•°æ˜¯è¿ä¹˜ï¼Œä¸”å¯ä»¥æŒ‰ç…§å˜é‡åˆ‡åˆ†å¼€ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‹†å¼€ç§¯åˆ†ã€‚
$$
\begin{align}
\mathbb{E}_{q(x_{1:T}|x_0)} [f(x_j)] &= \mathop{\int}_{x_{1:T}} \big[\prod_{t=1}^T q(x_t|x_0) \big]f(x_j)dx_{1:T} \\
&= \big[\prod_{t=1,tâ‰ j}^T \mathop{\int}_{x_t} q(x_t|x_0)dx_t \big] \cdot \mathop{\int}_{x_j}q(x_j|x_0)f(x_j)dx_j \\
&=\big[ \prod_{t=1,tâ‰ j}^T 1 \big] \cdot \mathop{\int}_{x_j}q(x_j|x_0)f(x_j)dx_j \\
&=\mathbb{E}_{q(x_j|x_0)} [f(x_j)] \tag{1.48}
\end{align}
$$
å…¬å¼ï¼ˆ1.48ï¼‰æ¨ç†çš„æœ¬è´¨æ˜¯ï¼šéè‡ªå˜é‡å¹¶ä¸ä¼šå½±å“å‡½æ•°çš„æœŸæœ›ã€‚å®ƒè§£é‡Šäº†å…¬å¼ï¼ˆ1.47ï¼‰çš„é‡å»ºé¡¹æ¨ç†æµç¨‹ã€‚å…¬å¼ï¼ˆ1.46-1.47ï¼‰çš„ç¬¬äºŒé¡¹æ¨ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š
$$
\begin{align}
\mathbb{E}_{q(x_{T-1}ï¼Œx_T|x_0)} \Big[ \log \frac{ p(x_T)}{q(x_T | x_{T-1})} \Big]&= \iint q(x_{T-1},x_T|x_0) \Big[ \log \frac{p(x_T)}{q(x_T|x_{T-1})}\Big]dx_Tdx_{T-1} \\
&=\iint q(x_{T-1}|x_0)q(x_T|x_{T-1}) \Big[ \log \frac{p(x_T)}{q(x_T|x_{T-1})}\Big]dx_Tdx_{T-1} \\
&=\int q(x_{T-1}|x_0) \Big[\int q(x_T|x_{T-1})\log \frac{p(x_T)}{q(x_T|x_{T-1})}dx_T\Big]dx_{T-1} \\
&= \int q(x_{T-1}|x_0)[-D_{KL}(q(x_T|x_{T-1})||p(x_T))]dx_{T-1}\\
&=-\mathbb{E}_{q(x_{T-1}|x_0)} [ D_{KL}(q(x_T|x_{T-1})||p(x_T))] \tag{1.49}
\end{align}
$$
ç¬¬ä¸‰é¡¹ä¸€è‡´é¡¹çš„æ¨ç†è¿‡ç¨‹ä¸å…¬å¼ï¼ˆ1.49ï¼‰ç±»ä¼¼ã€‚

æ¨å¯¼å‡ºçš„VDMçš„ELBOå¯ä»¥ä»å…¶ä¸‰ä¸ªç»„æˆéƒ¨åˆ†è¿›è¡Œä¸€è½®è§£é‡Šï¼š
1. ç¬¬ä¸€é¡¹ $\mathbb{E}_{q(x_1|x_0)} [\log p_\theta(x_0 | x_1)]$ è¢«ç§°ä½œé‡å»ºé¡¹ï¼ˆreconstruction termï¼‰ã€‚å®ƒè¡¡é‡äº†åœ¨ç»™å®šä¸€æ­¥éšå˜é‡çš„æƒ…å†µä¸‹ï¼ŒåŸå§‹æ•°æ®æ ·æœ¬çš„å¯¹æ•°æ¦‚ç‡ã€‚â€œé‡å»ºé¡¹â€ä¸€æœ¯è¯­åœ¨ä¼ ç»Ÿçš„å˜åˆ†è‡ªç¼–ç å™¨ï¼ˆVAEï¼‰ä¸­ä¹Ÿå­˜åœ¨ï¼Œå¹¶å¯ä»¥é€šè¿‡ç±»ä¼¼çš„è®­ç»ƒæ–¹æ³•è¿›è¡Œä¼˜åŒ–ã€‚
2. ç¬¬äºŒé¡¹ $\mathbb{E}_{q(x_{T-1}|x_0)} [ D_{KL}(q(x_T|x_{T-1})||p(x_T))]$ è¢«ç§°ä¸ºå…ˆéªŒåŒ¹é…é¡¹ï¼ˆprior matching termï¼‰ã€‚å½“æœ€ç»ˆçš„éšå˜é‡ $x_T$ åˆ†å¸ƒä¸é«˜æ–¯å…ˆéªŒç›¸åŒ¹é…æ—¶ï¼Œå³éšå˜é‡æ¥è¿‘çº¯é«˜æ–¯å™ªå£°ï¼Œè¿™ä¸€é¡¹è¾¾åˆ°æœ€å°åŒ–ã€‚**è¿™ä¸€é¡¹ä¸éœ€è¦è¿›è¡Œä¼˜åŒ–ï¼Œå› ä¸ºå®ƒä¸åŒ…å«å¯è®­ç»ƒçš„å‚æ•°ã€‚**Â æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œéšç€æ—¶é—´æ­¥Â TÂ çš„å¢åŠ ï¼Œæœ€ç»ˆçš„åˆ†å¸ƒä¼šè¶‹è¿‘äºé«˜æ–¯åˆ†å¸ƒï¼Œä»è€Œä½¿å¾—è¿™ä¸€é¡¹çš„å½±å“é€æ¸å‡å°ã€‚
3. ç¬¬ä¸‰é¡¹ $\mathbb{E}_{q(x_{t-1},x_{t+1}|x_0)}[D_{KL}(q(x_t|x_{t-1})||p(x_t|x_{t+1}))]$ è¢«ç§°ä¸ºä¸€è‡´æ€§é¡¹ï¼ˆconsistency termï¼‰ã€‚åœ¨æ¯ä¸ªä¸­é—´æ—¶é—´æ­¥éª¤ä¸Šï¼Œå®ƒè¦æ±‚ä»æ›´å™ªå£°çš„å›¾åƒè¿›è¡Œå»å™ªå¤„ç†çš„ç»“æœåº”è¯¥ä¸ä»æ›´æ¸…æ™°çš„å›¾åƒè¿›è¡ŒåŠ å™ªå¤„ç†çš„ç»“æœç›¸åŒ¹é…ï¼Œå³ä»å‰å‘å’Œåå‘è¿‡ç¨‹éƒ½è¦ä¿æŒä¸€è‡´ã€‚åœ¨æ•°å­¦ä¸Šï¼Œè¿™é€šè¿‡KLæ•£åº¦æ¥ä½“ç°ã€‚å½“è®­ç»ƒ $p_Î¸(x_t|x_{t+1})$ ä½¿å…¶ä¸å®šä¹‰åœ¨å…¬å¼ï¼ˆ1.33ï¼‰ä¸­çš„é«˜æ–¯åˆ†å¸ƒ $q(x_t|x_{tâˆ’1})$ ç›¸åŒ¹é…æ—¶ï¼Œè¿™ä¸€é¡¹è¢«æœ€å°åŒ–ã€‚
![](images/1.2.4-2.png)
	*å›¾1.5 å¯¹äºæ¯ä¸ªä¸­é—´éšå˜é‡ $x_t$ï¼ŒåŒ¹é…ä¸Šé¢çš„åéªŒ $p_Î¸(x_t|x_{t+1})$ ä¸ä¹‹å‰çš„ $q(x_t|x_{tâˆ’1})$ æ¨ç†ã€‚VDMå¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•è¿›è¡Œä¼˜åŒ– ã€‚åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œå¯¹äºæ¯ä¸ªä¸­é—´çš„ $x_t$ï¼Œæˆ‘ä»¬æœ€å°åŒ–ç”±ç²‰è‰²å’Œç»¿è‰²ç®­å¤´è¡¨ç¤ºçš„ä¸¤åˆ†å¸ƒä¹‹é—´çš„å·®å¼‚ã€‚*

æ ¹æ®è¿™ä¸ªå…¬å¼ï¼ˆ1.47ï¼‰æ¨å¯¼ï¼ŒVDMçš„ELBOæ‰€æœ‰é¡¹éƒ½å¯ä»¥é€šè¿‡æœŸæœ›å€¼è¿›è¡Œè®¡ç®—ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨è’™ç‰¹å¡æ´›ä¼°è®¡æ¥è¿‘ä¼¼è®¡ç®—ã€‚ç„¶è€Œï¼Œå®é™…ä¸Šä½¿ç”¨æˆ‘ä»¬åˆšåˆšæ¨å¯¼å‡ºæ¥çš„é¡¹æ¥ä¼˜åŒ–ELBOå¯èƒ½ä¸æ˜¯æœ€ä¼˜çš„ï¼›å› ä¸ºä¸€è‡´æ€§é¡¹æ˜¯å¯¹æ¯ä¸ªæ—¶é—´æ­¥éª¤è®¡ç®—ä¸¤ä¸ªéšæœºå˜é‡ $\{x_{tâˆ’1},x_{t+1}\}$ çš„æœŸæœ›ï¼Œå…¶è’™ç‰¹å¡æ´›ä¼°è®¡çš„æ–¹å·®å¯èƒ½é«˜äºä»…ä½¿ç”¨ä¸€ä¸ªéšæœºå˜é‡çš„é¡¹çš„æ–¹å·®ã€‚å› ä¸ºæŒ‰ç…§é©¬å°”å¯å¤«åŸç†ï¼Œéšæœºå˜é‡ $\{x_{tâˆ’1},x_{t+1}\}$ æ²¡æœ‰ç›¸è¿ï¼Œæ˜¯ç‹¬ç«‹åˆ†å¸ƒçš„ã€‚æˆ‘ä»¬åº”è¯¥æ¨å¯¼ELBOçš„ä¸€ä¸ªå˜å½¢ï¼Œå…¶ä¸­æ¯ä¸ªé¡¹åº”è¯¥æ˜¯åªè®¡ç®—ä¸€æ¬¡çš„éšæœºå˜é‡çš„æœŸæœ›ã€‚
VDMæ¨ç†æ–¹æ¡ˆæ˜¯å°†ç¼–ç å™¨çš„è½¬æ¢é‡å†™ä¸º $q(x_t|x_{tâˆ’1})=q(x_t|x_{tâˆ’1},x_0)$ ï¼Œç”±äºé©¬å°”å¯å¤«æ€§è´¨ $x_0$ å¯¹ $x_{tâˆ’1},x_t$ æ˜¯ç‹¬ç«‹åŒåˆ†å¸ƒï¼Œè¿™ç§ä¿®æ”¹è½¬æ¢çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•å®é™…å˜åŠ¨ï¼Œä½†æ˜¯å´å¯¹åç»­æ¨ç†å…¬å¼å¼€åˆ›äº†æ–°æ€è·¯ã€‚æ ¹æ®è´å¶æ–¯è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªè½¬æ¢é‡å†™ä¸ºï¼š
$$
q(x_t|x_{tâˆ’1})=q(x_t|x_{tâˆ’1},x_0)=\frac{q(x_{t-1}|x_t,x_0)q(x_t|x_0)}{q(x_{t-1}|x_0)} \tag{1.50}
$$
æœ‰äº†è¿™ä¸ªæ–°çš„å…¬å¼ï¼Œæˆ‘ä»¬é‡æ–°å¼€å§‹å…¬å¼ï¼ˆ1.41ï¼‰ä¸­çš„ELBOæ¨å¯¼å¯å¾—ï¼š
$$
\begin{align}
\log p(x)&\geq \mathbb{E}_{q(x_{1:T}|x_0)} \Big[\log{\frac{p(x_{0:T})}{q(x_{1:T}|x_0)}} \Big] \tag{1.51} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T) \prod_{t=1}^T p_\theta(x_{t-1} | x_t) }{\prod_{t=1}^T q(x_t | x_{t-1})} \Big] \tag{1.52} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) \prod_{t=2}^T p_\theta(x_{t-1} | x_t) }{q(x_1 | x_0) \prod_{t=2}^{T} q(x_t | x_{t-1})} \Big] \tag{1.53} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) \prod_{t=2}^T p_\theta(x_{t-1} | x_t) }{q(x_1 | x_0)\prod_{t=2}^{T} q(x_t | x_{t-1},x_0)} \Big] \tag{1.54} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) }{q(x_1 | x_0)} + \log \prod_{t=2}^{T} \frac{p_\theta(x_{t-1} | x_t)}{ q(x_t | x_{t-1},x_0)} \Big] \tag{1.55} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) }{q(x_1 | x_0)} + \log \prod_{t=2}^{T} \frac{p_\theta(x_{t-1} | x_t)}{\frac{q(x_{t-1}|x_t,x_0)q(x_t|x_0)}{q(x_{t-1}|x_0)}} \Big] \tag{1.56} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) }{q(x_1 | x_0)} + \log \prod_{t=2}^{T} \frac{p_\theta(x_{t-1} | x_t)}{\frac{q(x_{t-1}|x_t,x_0) \cancel{q(x_t|x_0)}}{\cancel{q(x_{t-1}|x_0)}}} \Big] \tag{1.57} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) }{\cancel{q(x_1 | x_0)}} + \log\frac{\cancel{q(x_1|x_0)}}{q(x_T|x_0)} +\log \prod_{t=2}^{T} \frac{p_\theta(x_{t-1} | x_t)}{q(x_{t-1}|x_t,x_0)} \Big] \tag{1.58} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{ p(x_T)p_\theta(x_0 | x_1) }{q(x_T | x_0)}  + \sum_{t=2}^{T}  \log  \frac{p_\theta(x_{t-1} | x_t)}{q(x_{t-1}|x_t,x_0)} \Big] \tag{1.59} \\
&= \mathbb{E}_{q(x_{1:T}|x_0)} [ \log p_\theta(x_0 | x_1)] + \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{p(x_T)}{q(x_T | x_0)}\Big]  + \sum_{t=2}^{T} \mathbb{E}_{q(x_{1:T}|x_0)} \Big[ \log \frac{p_\theta(x_{t-1} | x_t)}{q(x_{t-1}|x_t,x_0)} \Big] \tag{1.60} \\
&= \mathbb{E}_{q(x_{1}|x_0)} [ \log p_\theta(x_0 | x_1)] + \mathbb{E}_{q(x_{T}|x_0)} \Big[ \log \frac{p(x_T)}{q(x_T | x_0)}\Big]  + \sum_{t=2}^{T} \mathbb{E}_{q(x_t,x_{t-1}|x_0)} \Big[ \log \frac{p_\theta(x_{t-1} | x_t)}{q(x_{t-1}|x_t,x_0)} \Big] \tag{1.61} \\
&= \underbrace{\mathbb{E}_{q(x_{1}|x_0)} [ \log p_\theta(x_0 | x_1)]}_{é‡å»ºé¡¹} -   \underbrace{D_{KL}(q(x_T|x_0)||p(x_T))}_{å…ˆéªŒåŒ¹é…é¡¹} - \underbrace{\sum_{t=2}^{T} \mathbb{E}_{q(x_t|x_0)} [D_{KL}(q(x_{t-1}|x_t,x_0)||p_\theta(x_{t-1}|x_t))]}_{å»å™ªåŒ¹é…é¡¹} \tag{1.62}
\end{align}
$$

æˆ‘ä»¬é‡æ–°åœ°å¯¹ELBOè¿›è¡Œäº†è§£é‡Šï¼Œå¹¶å¯ä»¥é€šè¿‡ä¸€æ¬¡åªè®¡ç®—ä¸€ä¸ªéšæœºå˜é‡çš„æœŸæœ›æ¥è¿›è¡Œä¼°è®¡ã€‚è¿™ç§å½¢å¼ä¹Ÿæœ‰ä¸€ä¸ªä¼˜é›…çš„è§£é‡Šï¼Œå½“æˆ‘ä»¬ä»”ç»†æ£€æŸ¥æ¯ä¸ªå•ç‹¬çš„é¡¹æ—¶ï¼Œå°±ä¼šæ­ç¤ºå‡ºï¼š
1. $\mathbb{E}_{q(x_{1}|x_0)} [ \log p_\theta(x_0 | x_1)]$ æ˜¯é‡å»ºé¡¹ï¼ˆreconstruction termï¼‰ï¼Œä¸ä¼ ç»ŸVAEä¸­çš„ELBOç±»ä¼¼ï¼Œè¿™ä¸ªé¡¹å¯ä»¥ä½¿ç”¨è’™ç‰¹å¡æ´›ä¼°è®¡è¿›è¡Œè¿‘ä¼¼å’Œä¼˜åŒ–ã€‚
2. $D_{KL}(q(x_T|x_0)||p(x_T))$ ä»£è¡¨æœ€ç»ˆåŠ å…¥å™ªå£°çš„åˆ†å¸ƒä¸æ ‡å‡†é«˜æ–¯å…ˆéªŒï¼ˆ$p(x_T)$ å·²ç»å˜æˆæ ‡å‡†é«˜æ–¯å™ªå£°äº†ï¼‰ä¹‹é—´çš„æ¥è¿‘ç¨‹åº¦ã€‚
3. $\mathbb{E}_{q(x_t|x_0)} [D_{KL}(q(x_{t-1}|x_t,x_0)||p_\theta(x_{t-1}|x_t))]$ æ˜¯å»å™ªåŒ¹é…é¡¹ï¼ˆdenoising matching termï¼‰ã€‚æˆ‘ä»¬å¸Œæœ›å­¦ä¹ å»å™ªæ­¥éª¤$p_Î¸(x_{tâˆ’1}|x_t,x_0)$ å»è¿‘ä¼¼ground-truthçœŸå®å»å™ªè½¬æ¢æ­¥éª¤ $q(x_{tâˆ’1}|x_t,x_0)$ ã€‚ç”±äº $q(x_{tâˆ’1}|x_t,x_0)$ å¯ä»¥ä½œä¸ºä¸€ä¸ªground-truthä¿¡å·ã€‚å®ƒå®šä¹‰äº†å¦‚ä½•å°†å¸¦å™ªå£°çš„å›¾åƒ $x_t$ å»å™ªæˆå®Œå…¨å›¾åƒ $x_0$ã€‚å½“ä¸¤ç§å»å™ªåˆ†å¸ƒå°½å¯èƒ½åœ°åŒ¹é…æ—¶ï¼Œè¿™ä¸ªKLæ•£åº¦é¡¹å°±ä¼šè¢«æœ€å°åŒ–ã€‚

æˆ‘ä»¬å‘ç°ï¼Œ $\mathbb{E}_{q(x_t|x_0)} [D_{KL}(q(x_{t-1}|x_t,x_0)||p_\theta(x_{t-1}|x_t))]$ å»å™ªåŒ¹é…é¡¹çš„è®¡ç®—ç¨‹åº¦ç›´æ¥å†³å®šäº†ELBOçš„è®¡ç®—ç¨‹åº¦ã€‚è¿™ä¹Ÿå’Œæˆ‘ä»¬æœ´ç´ æ€æƒ³ä¸€è‡´ï¼šå°½å¯èƒ½åœ°å°†**è¿‘ä¼¼å»å™ªåˆ†å¸ƒ** $p_Î¸(x_{tâˆ’1}|x_t)$ ä¸**çœŸå€¼å»å™ªåˆ†å¸ƒ** $q(x_{tâˆ’1}|x_t,x_0)$ ç›¸åŒ¹é…ï¼Œæ‰èƒ½åšå¥½ç”Ÿæˆæ¨¡å‹çš„é¢„æµ‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†è·å–å»å™ªåŒ¹é…é¡¹çš„å„ä¸ªæ¡ä»¶æ¥è¿›è¡Œè¯¥é¡¹çš„è®¡ç®—ã€‚
### 1.3.4 ä»VDMä¸‰çº¦æŸå¾—åˆ°çš„æ–°åŠ å™ªæ¡ä»¶
VDMçš„ç¬¬ä¸€æ¡è§„åˆ™çº¦æŸä¸­ï¼Œæˆ‘ä»¬è®¾ç½®æ¯ä¸ªæ—¶é—´æ­¥é•¿ $t$ å¤„çš„ç¼–ç å™¨ç»“æ„è®¾ç½®æˆå‡å€¼$Î¼_t(x_t)=\sqrt{Î±_t}x_{t-1}$å’Œæ–¹å·®$Î£_t(x_t)=(1âˆ’Î±_t)I$ã€‚è¿™ä¸ªæ¡ä»¶å…¶å®æ˜¯è®¾è®¡å‡ºæ¥çš„ï¼Œå…¶çµæ„Ÿæ¥æºäºå›¾ç‰‡é€æ¸åŠ å™ªçš„é€»è¾‘ã€‚æˆ‘ä»¬è®¤ä¸º $t$ å±‚éšå˜é‡çš„æ—¢æ¥æºäº $t-1$ å±‚çš„ $x_{t-1}$ åˆæ¥æºäºå™ªå£° $\epsilon$ ã€‚æˆ‘ä»¬å°†å…¶ç›¸åŠ ï¼Œæ ·æœ¬ $x_tâˆ¼q(x_t|x_{tâˆ’1})$ å¯ä»¥æ”¹å†™ä¸ºï¼š
$$
\begin{align}
x_t = \sqrt{\alpha_t}x_{t-1} + \sqrt{1-\alpha_t}\epsilon \tag{1.63} \\
\text{with}: \epsilon \sim \mathcal{N}(\epsilon;0,I) 
\end{align}
$$
 åœ¨$x_{t-1}$ ä¸å™ªå£° $\epsilon$ å‰é¢çš„æ˜¯å…³äº $\alpha$ å‚æ•°ï¼Œæ­¤è®¾è®¡çš„ç›®çš„æœ‰äºŒï¼šå…¶ä¸€ä½¿å„æ—¶é—´æ­¥éšå˜é‡ $x_t$ é‡å‚æ•°åŒ–ï¼Œæ–¹ä¾¿ä½¿ç”¨ç¥ç»ç½‘ç»œçš„æ±‚å¯¼è¿‡ç¨‹ï¼›å…¶äºŒæ˜¯æ–¹ä¾¿åç»­æ¨ç†è®¡ç®—ã€‚æˆ‘ä»¬æ¨ç†åˆ°ï¼š
$$
\begin{align}
x_t&=\sqrt{\alpha_t}x_{t-1}+\sqrt{1-\alpha_t}\epsilon_{t-1}^* \tag{1.64} \\
&=\sqrt{\alpha_t}(\sqrt{\alpha_{t-1}}x_{t-2}+\sqrt{1-\alpha_{t-1}}\epsilon_{t-2}^*)+\sqrt{1-\alpha_t}\epsilon_{t-1}^* \tag{1.65} \\
&=\sqrt{\alpha_t\alpha_{t-1}}x_{t-2}+\sqrt{\alpha_t-\alpha_t\alpha_{t-1}}\epsilon_{t-2}^*+\sqrt{1-\alpha_t}\epsilon_{t-1}^* \tag{1.66} \\
&=\sqrt{\alpha_t\alpha_{t-1}}x_{t-2}+ \sqrt{\sqrt{\alpha_t-\alpha_t\alpha_{t-1}}^2+\sqrt{1-\alpha_t}^2}\epsilon_{t-2}\tag{1.67} \\
&=\sqrt{\alpha_t\alpha_{t-1}}x_{t-2}+ \sqrt{\alpha_t-\alpha_t\alpha_{t-1}+1-\alpha_t}\epsilon_{t-2}\tag{1.68} \\
&=\sqrt{\alpha_t\alpha_{t-1}}x_{t-2}+ \sqrt{1-\alpha_t\alpha_{t-1}}\epsilon_{t-2}\tag{1.69} \\
&=... \tag{1.70} \\
&=\sqrt{\prod_{i=1}^t \alpha_i}x_0 + \sqrt{1-\prod_{i=1}^t \alpha_i}\epsilon_0 \tag{1.71} \\
&=\sqrt{\overline{\alpha}_t}x_0 + \sqrt{1-\overline{\alpha}_t}\epsilon_0 \tag{1.72} \\
&\sim \mathcal{N}(x_t;\sqrt{\bar{\alpha}_t}x_0,(1-\bar{\alpha}_t)I) \tag{1.73}
\end{align}
$$
è¿™é‡Œçš„ $\bar\alpha_t = \prod_{i=1}^t \alpha_i$ ï¼Œä»£æŒ‡è¿ä¹˜ï¼Œè€Œä¸æ˜¯å¹³å‡å€¼çš„æ„æ€ã€‚**è¿™äº› $\alpha$ ç³»æ•°åœ¨æ¯ä¸ªæ—¶é—´æ­¥é•¿ä¸Šæ˜¯å·²çŸ¥ä¸”å›ºå®šçš„ï¼›å®ƒä»¬è¦ä¹ˆè¢«å›ºå®šä¸ºè¶…å‚æ•°ï¼Œè¦ä¹ˆè¢«è§†ä¸ºæŸç§ç½‘ç»œæ¨ç†çš„ç»“æœã€‚**
ä»å…¬å¼ï¼ˆ1.73ï¼‰ä¸­å¾—å‡ºï¼Œ$x_t$ å¯ä»¥ç›´æ¥ä»çœŸå®å›¾åƒä¸­ç®—å‡ºæ¥ã€‚åœ¨å…¬å¼ï¼ˆ1.67ï¼‰ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨äº†ä¸¤ä¸ªç‹¬ç«‹é«˜æ–¯éšæœºå˜é‡ç›¸åŠ çš„é«˜æ–¯åˆ†å¸ƒè®¡ç®—æ–¹æ³•ã€‚å…¶ç»“æœä»ç„¶æ˜¯ä¸€ä¸ªå‡å€¼ä¸ºå‡å€¼ä¹‹å’Œï¼ˆè¿™é‡Œä¸º0ï¼‰ã€æ–¹å·®ä¸ºæ–¹å·®ä¹‹å’Œçš„é«˜æ–¯åˆ†å¸ƒã€‚ $\sqrt{1âˆ’Î±_t}\epsilon_{t-1}^*$ å¯è§£é‡Šä¸ºä»é«˜æ–¯åˆ†å¸ƒ $\mathcal{N}(0,(1âˆ’\alpha_t)I)$ ä¸­å–æ ·ï¼Œ $\sqrt{\alpha_t-\alpha_t\alpha_{t-1}}\epsilon_{t-2}^*$ å¯è§£é‡Šä¸ºä»é«˜æ–¯åˆ†å¸ƒ $\mathcal{N}(0,(Î±_tâˆ’Î±_tÎ±_{tâˆ’1})I)$ ä¸­å–æ ·ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬çš„å’Œè§†ä¸ºä»é«˜æ–¯åˆ†å¸ƒ $\mathcal{N}(0,(1âˆ’Î±_t+Î±_tâˆ’Î±_tÎ±_{tâˆ’1})I)=\mathcal{N}(0,(1âˆ’Î±_tÎ±_{tâˆ’1})I)$ ä¸­å–æ ·å¾—åˆ°çš„éšæœºå˜é‡ã€‚å³ä¸ºå…¬å¼ï¼ˆ1.69ï¼‰çš„ $\sqrt{1âˆ’Î±_tÎ±_{tâˆ’1}}\epsilon_{tâˆ’2}$ é¡¹ã€‚
ç°åœ¨å›åˆ°å…¬å¼ï¼ˆ1.50ï¼‰ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº† $q(x_t|x_0)$ å’Œ $q(x_{tâˆ’1}|x_0)$ çš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶ä»£å…¥è´å¶æ–¯è§„åˆ™å±•å¼€æ¥ç»§ç»­è®¡ç®— $q(x_{tâˆ’1}|x_t,x_0)$ ï¼š
$$
\begin{align}
q(x_{tâˆ’1}|x_t,x_0) &= \frac{q(x_t|x_{tâˆ’1}, x_0)q(x_{tâˆ’1}|x_0)}{q(x_t|x_0)} \tag{1.74}\\
&=\frac{\mathcal{N}({{x}}_t;\sqrt{{\alpha}_t}{{x}}_{t-1},(1-{\alpha}_t){{I}})\mathcal{N}({{x}}_{t-1};\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0},(1-\bar{{\alpha}}_{t-1}){{I}})}{\mathcal{N}({{x}}_{t};\sqrt{\bar{{\alpha}}_{t}}{{x}}_{0},(1-\bar{{\alpha}}_{t}){{I}})} \tag{1.75} \\
&\propto \exp\left\{ -\left[\frac{({{x}}_t-\sqrt{{\alpha}_t}{{x}}_{t-1})^2}{2(1-{\alpha}_t)}+\frac{({{x}}_{t-1}-\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0})^2}{2(1-\bar{{\alpha}}_{t-1})}-\frac{({{x}}_{t}-\sqrt{\bar{{\alpha}}_{t}}{{x}}_{0})^2}{2(1-\bar{{\alpha}}_{t})}\right]\right\} \tag{1.76}\\
&= \exp\left\{ -\frac{1}{2}\left[\frac{({{x}}_t-\sqrt{{\alpha}_t}{{x}}_{t-1})^2}{1-{\alpha}_t}+\frac{({{x}}_{t-1}-\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0})^2}{1-\bar{{\alpha}}_{t-1}}-\frac{({{x}}_{t}-\sqrt{\bar{{\alpha}}_{t}}{{x}}_{0})^2}{1-\bar{{\alpha}}_{t}}\right]\right\} \tag{1.77}\\
&= \exp\left\{ -\frac{1}{2}\left[\frac{-2\sqrt{{\alpha}_t}{{x}}_t {{x}}_{t-1}+{\alpha}_t {{x}}_{t-1}^2}{1-{\alpha}_t}+\frac{{{x}}_{t-1}^2 2\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{t-1}{{x}}_{0}}{1-\bar{{\alpha}}_{t-1}} +C({{x}}_t,{{x}}_0)\right]\right\} \tag{1.78}\\
& \propto \exp\left\{ -\frac{1}{2}\left[-\frac{2\sqrt{{\alpha}_t}{{x}}_t {{x}}_{t-1}}{1-{\alpha}_t} + \frac{{\alpha}_t {{x}}_{t-1}^2}{1-{\alpha}_t} + \frac{{{x}}_{t-1}^2}{1-\bar{{\alpha}}_{t-1}} - \frac{2\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{t-1}{{x}}_{0}}{1-\bar{{\alpha}}_{t-1}}\right]\right\} \tag{1.79}\\
&=\exp\left\{ -\frac{1}{2}\left[\left(\frac{{\alpha}_t }{1-{\alpha}_t} + \frac{1}{1-\bar{{\alpha}}_{t-1}}\right){{x}}_{t-1}^2 - 2\left(\frac{\sqrt{{\alpha}_t}{{x}}_t}{1-{\alpha}_t} + \frac{\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0}}{1-\bar{{\alpha}}_{t-1}}\right) {{x}}_{t-1}\right]\right\} \tag{1.80}\\
&=\exp\left\{ -\frac{1}{2}\left[\frac{{\alpha}_t(1-\bar{{\alpha}}_{t-1})+1-{\alpha}_t}{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})}{{x}}_{t-1}^2 -  2\left(\frac{\sqrt{{\alpha}_t}{{x}}_t}{1-{\alpha}_t} + \frac{\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0}}{1-\bar{{\alpha}}_{t-1}}\right) {{x}}_{t-1}\right]\right\} \tag{1.81}\\
&=\exp\left\{ -\frac{1}{2}\left[\frac{{\alpha}_t-\bar{{\alpha}}_{t}+1-{\alpha}_t}{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})}{{x}}_{t-1}^2 - 2\left(\frac{\sqrt{{\alpha}_t}{{x}}_t}{1-{\alpha}_t} + \frac{\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0}}{1-\bar{{\alpha}}_{t-1}}\right) {{x}}_{t-1}\right]\right\} \tag{1.82}\\
&=\exp\left\{ -\frac{1}{2}\left[\frac{1-\bar{{\alpha}}_{t}}{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})}{{x}}_{t-1}^2 - 2\left(\frac{\sqrt{{\alpha}_t}{{x}}_t}{1-{\alpha}_t} + \frac{\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0}}{1-\bar{{\alpha}}_{t-1}}\right) {{x}}_{t-1}\right]\right\} \tag{1.83}\\
&={\exp\left\{ -\frac{1}{2} \left(\frac{1-\bar{{\alpha}}_{t}}{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})} \right) {\left[x_{t-1}^2 - 2\frac{\left(\frac{\sqrt{{\alpha}_t}{{x}}_t}{1-{\alpha}_t} + \frac{\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0}}{1-\bar{{\alpha}}_{t-1}}\right)}{\frac{1-\bar{\alpha}_t}{(1-\alpha)(1-\bar{\alpha}_{t-1})}} x_{t-1}\right]}\right\}} \tag{1.84}\\
&={\exp\left\{ -\frac{1}{2} \left(\frac{1-\bar{{\alpha}}_{t}}{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})} \right) {\left[x_{t-1}^2 - 2\frac{\left(\frac{\sqrt{{\alpha}_t}{{x}}_t}{1-{\alpha}_t} + \frac{\sqrt{\bar{{\alpha}}_{t-1}}{{x}}_{0}}{1-\bar{{\alpha}}_{t-1}}\right)(1-\alpha)(1-\bar{\alpha}_{t-1}) }{1-\bar{\alpha}_t} x_{t-1}\right]}\right\}} \tag{1.85}\\
&=\exp\left\{ -\frac{1}{2} \left(\frac{1}{\frac{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})}{1-\bar{{\alpha}}_{t}}} \right)\\ \quad \left[ {{x}}_{t-1}^2-2\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}} {{x}}_{t-1}\right]\right\} \tag{1.86}\\
&\propto \mathcal{N}({{x}}_{t-1};\underbrace{\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}}}_{{{\mu}}_q({{x}}_t,{{x}}_0)},\underbrace{\frac{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})}{1-\bar{{\alpha}}_{t}} {{I}}}_{{{\Sigma}}_{q}(t)}) \tag{1.87}
\end{align} 
$$

åœ¨å…¬å¼ï¼ˆ1.78ï¼‰ä¸­ï¼Œ$C(x_t,x_0)$ä»…ç”± $x_t$ ã€$x_0$å’Œ $\alpha$ å€¼çš„ç»„åˆè®¡ç®—å¾—å‡ºï¼Œæ˜¯å…³äº $x_{tâˆ’1}$ çš„å¸¸æ•°é¡¹ã€‚å› æ­¤åœ¨å…¬å¼ï¼ˆ1.79ï¼‰ä¸­ç”¨æ­£æ¯”ç¬¦å·ï¼Œéç­‰å·ã€‚
è¿™æ ·æˆ‘ä»¬çŸ¥é“äº† $q(x_{tâˆ’1}|x_t,x_0)$ æœä»æ­£æ€åˆ†å¸ƒï¼Œå…¶ä¸­å‡å€¼æ–¹å·®å¦‚ä¸‹ï¼š
$$
\begin{align}
\mu_q(x_t,x_0)&=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}} \tag{1.88} \\
Ïƒ_q^2(t)&=\frac{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})}{1-\bar{{\alpha}}_{t}} \tag{1.89}
\end{align}
$$
æˆ‘ä»¬å·²ç»å¾—åˆ°äº† $q(x_{tâˆ’1}|x_t,x_0)$ çš„è¡¨ç¤ºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦è®©**è¿‘ä¼¼å»å™ªåˆ†å¸ƒ** $p_Î¸(x_{tâˆ’1}|x_t)$ è¿‘ä¼¼ **çœŸå€¼å»å™ªåˆ†å¸ƒ** $q(x_{tâˆ’1}|x_t,x_0)$ äº†ã€‚è¿™ä¹Ÿç¬¦åˆäº†å…¬å¼ï¼ˆ1.62ï¼‰ç¬¬ä¸‰é¡¹ï¼Œæˆ‘ä»¬è¦æœ€å°åŒ–ä¸¤è€…çš„KLæ•£åº¦ã€‚
### 1.3.5 VDMçš„ä¼˜åŒ–æ–¹æ¡ˆ
å¦‚å…¬å¼ï¼ˆ1.62ï¼‰æ‰€ç¤ºï¼ŒVDMçš„ä¼˜åŒ–æ–¹æ¡ˆä¸»è¦åœ¨å»å™ªåŒ¹é…é¡¹ $\mathbb{E}_{q(x_t|x_0)} [D_{KL}(q(x_{t-1}|x_t,x_0)||p_\theta(x_{t-1}|x_t))]$ ä¸Šã€‚è®¡ç®—è¿™ä¸ªå…¬å¼ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆè·å–ä¸¤ä¸ªé«˜æ–¯åˆ†å¸ƒçš„KLæ•£åº¦å…¬å¼ã€‚å› ä¸ºç°åœ¨éšå˜é‡ç¼–è§£ç çš„æ ¼å¼ä¸ºçŸ©é˜µï¼Œä¸”æ¯å±‚éšå˜é‡ç»´åº¦ä¸æ•°æ®ç»´åº¦å®Œå…¨ç›¸ç­‰ã€‚æ‰€ä»¥å…¬å¼ï¼ˆ1.23ï¼‰åœ¨VDMä¸Šçš„å¤šç»´æ”¹é€ å¦‚ä¸‹ï¼š
$$
D_{KL}(\mathcal{N}(x;\mu_x,\Sigma_x)||\mathcal{N}(y;\mu_y,\Sigma_y))=\frac{1}{2}\Big[\log \frac{\Sigma_y}{\Sigma_x} -d+ tr(\Sigma_y^{-1}\Sigma_x) + (\mu_y-\mu_x)^T\Sigma_y^{-1}(\mu_y-\mu_x)\Big]
$$
ä¸Šé¢å…¬å¼ä¸­çš„ $d$ ä»£è¡¨çŸ©é˜µç»´åº¦ï¼Œå› ä¸ºåé¢æ¨ç†ä¼šæ¶ˆå»ï¼Œæ‰€ä»¥ä¸å»å¼•ç”³ã€‚
åœ¨ä¼˜åŒ–KLæ•£åº¦çš„ä¾‹å­ä¸­ï¼Œæ ¹æ®ä¸Šé¢çš„å…¬å¼ï¼Œä¼˜åŒ–KLæ•£åº¦é¡¹å¯ä»¥å½’ç»“ä¸ºæœ€å°åŒ–ä¸¤ä¸ªåˆ†å¸ƒçš„å‡å€¼ä¹‹å·®ï¼Œè¯·çœ‹æ¨ç†è¿‡ç¨‹ï¼š
$$
\begin{align}
&~~~~~\arg\min_{{{\theta}}} D_{\text{KL}}(q({{x}}_{t-1}|{{x}}_t,{{x}}_0)\Vert p_{{\theta}}({{x}}_{t-1}|{{x}}_t)) \\
&=\arg\min_{{{\theta}}} D_{\text{KL}}(\mathcal{N} ({{x}}_{t-1}; {\mu}_q, Î£_q(t)) \Vert \mathcal{N} ({{x}}_{t-1}; {\mu}_{{\theta}}, Î£_q(t))) \tag{1.90} \\
&={\arg\min_{{{\theta}}} \frac{1} {2} \left[ \log \frac{|Î£_q(t)|} {|Î£_q(t)|} âˆ’ d +\\ tr(Î£_q^{âˆ’1}(t) Î£_q(t)) + ({\mu}_{{\theta}} âˆ’ {\mu}_q)^\top Î£^{âˆ’1}_q ({\mu}_{{\theta}} âˆ’ {\mu}_q) \right] }\tag{1.91}\\
&=\arg\min_{{{\theta}}} \frac{1} {2} \left[ \log 1âˆ’ d + d + ({\mu}_{{\theta}} âˆ’ {\mu}_q)^\top Î£^{âˆ’1}_q ({\mu}_{{\theta}} âˆ’ {\mu}_q) \right] \tag{1.92}\\
&=\arg\min_{{{\theta}}} \frac{1} {2} \left[ ({\mu}_{{\theta}} âˆ’ {\mu}_q)^\top Î£^{âˆ’1}_q ({\mu}_{{\theta}} âˆ’ {\mu}_q) \right] \tag{1.93}\\
&=\arg\min_{{{\theta}}} \frac{1} {2} \left[ ({\mu}_{{\theta}} âˆ’ {\mu}_q)^\top (Ïƒ_q^2 (t) {{I}})^{-1} ({\mu}_{{\theta}} âˆ’ {\mu}_q) \right] \tag{1.94}\\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Vert {\mu}_{{\theta}} âˆ’ {\mu}_q \Vert_2^2 \right] \tag{1.95}\\
\end{align}
$$

è¿™é‡Œ $\mu_\theta$ æ˜¯ $p_Î¸(x_{tâˆ’1}|x_t)$ çš„å‡å€¼ã€‚$\Vert \cdot \Vert_2^2$ ä»£è¡¨ç¬¬äºŒèŒƒå¼ï¼Œå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯å¹³æ–¹å’Œåå¼€æ–¹è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªå…ƒç´ é—´è·ç¦»æ—¶å¸¸å¸¸ä½¿ç”¨å®ƒã€‚æ­¤æ—¶éœ€è¦å†æ¬¡å¼ºè°ƒä¸€ä¸‹æˆ‘ä»¬çš„æ ¸å¿ƒç›®æ ‡ï¼š
**ç”¨æœªçŸ¥ $x_0$ å€¼çš„è¿‘ä¼¼å»å™ªåˆ†å¸ƒ $p_Î¸(x_{tâˆ’1}|x_t)$ æ¥è¿‘ä¼¼å·²çŸ¥åŸå§‹å›¾ç‰‡ $x_0$ çš„çœŸå€¼å»å™ªåˆ†å¸ƒ $q(x_{tâˆ’1}|x_t,x_0)$ ã€‚** 
æ•´ä½“è¿‡ç¨‹éœ€è¦ä»å‡å€¼åˆ°æ–¹å·®çš„â€œä»¿é€ â€ï¼Œé‚£ä¹ˆè¯¥ $Î¼_Î¸(x_t,t)$ ï¼Œæ ¹æ®å…¬å¼ï¼ˆ1.88ï¼‰æˆ‘ä»¬å¯ä»¥å†™ä½œï¼š
$$
\mu_\theta(x_t,t)=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t)\hat{x}_\theta(x_t,t)}{1-\bar{{\alpha}}_{t}} \tag{1.96}
$$
å…¶ä¸­ï¼Œ$\hat{x}_Î¸(x_t,t)$ å¯ä»¥è®¤ä¸ºæ˜¯ç”±ç¥ç»ç½‘ç»œå»ºæ¨¡ï¼Œè¯¥ç¥ç»ç½‘ç»œè¯•å›¾ä»å«å™ªå›¾åƒ $x_t$ å’Œæ—¶é—´ç´¢å¼• $t$ æ¥é¢„æµ‹ $x_0$ã€‚ç„¶åï¼Œå…¬å¼ï¼ˆ1.95ï¼‰å¯ä»¥ä¼˜åŒ–ä¸ºï¼š
$$
\begin{align}
&~~~~\arg\min_{{{\theta}}} D_{\text{KL}}(q({{x}}_{t-1}|{{x}}_t,{{x}}_0)\Vert p_{{\theta}}({{x}}_{t-1}|{{x}}_t))\\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Vert {\mu}_{{\theta}} âˆ’ {\mu}_q \Vert_2^2 \right] \\
&=\arg\min_{{{\theta}}} \frac{1} {2Ïƒ_q^2 (t)} \left[\left \Vert\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t)\hat{{{x}}}_{{{\theta}} }({{x}}_t,t)}{1-\bar{{\alpha}}_{t}}\\ -\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}} \right \Vert_2^2\right] \tag{1.97}\\
&=\arg\min_{{{\theta}}} \frac{1} {2Ïƒ_q^2 (t)} \left[\left \Vert\frac{\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t)\hat{{{x}}}_{{{\theta}} }({{x}}_t,t)}{1-\bar{{\alpha}}_{t}}-\frac{\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}} \right \Vert_2^2\right] \tag{1.98}\\
&=\arg\min_{{{\theta}}} \frac{1} {2Ïƒ_q^2 (t)} \left[\left \Vert\frac{\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t)}{1-\bar{{\alpha}}_{t}}(\hat{{{x}}}_{{{\theta}} }({{x}}_t,t)-{{x}}_{0}) \right \Vert_2^2\right] \tag{1.99}\\
&=\arg\min_{{{\theta}}} \frac{1} {2Ïƒ_q^2 (t)}\frac{\bar{{\alpha}}_{t-1}(1-{\alpha}_t)^2}{(1-\bar{{\alpha}}_{t})^2} \left[\left \Vert\hat{{{x}}}_{{{\theta}} }({{x}}_t,t)-{{x}}_{0} \right \Vert_2^2\right] \tag{1.100}\\
\end{align}
$$
ç”±æ­¤å¯çŸ¥ï¼Œä¼˜åŒ–VDMå°±æ˜¯è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œç›®çš„æ˜¯ä»ä¸€å¼ è¢«çº¯å™ªå£°å›¾ç‰‡ä¸­ï¼Œé€æ¸æ¢å¤å‡ºå®ƒåŸæœ¬æ¸…æ™°çš„æ ·å­ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå…¬å¼ï¼ˆ1.89ï¼‰æ–¹å·®å…¬å¼å¸¦å…¥å…¬å¼ï¼ˆ1.100ï¼‰æˆ‘ä»¬å¾—åˆ°
$$
\begin{align}
&~~~~\arg\min_{{{\theta}}} D_{\text{KL}}(q({{x}}_{t-1}|{{x}}_t,{{x}}_0)\Vert p_{{\theta}}({{x}}_{t-1}|{{x}}_t))\\
&=\arg\min_{{{\theta}}} \frac{1} {2Ïƒ_q^2 (t)}\frac{\bar{{\alpha}}_{t-1}(1-{\alpha}_t)^2}{(1-\bar{{\alpha}}_{t})^2} \left[\left \Vert\hat{{{x}}}_{{{\theta}} }({{x}}_t,t)-{{x}}_{0} \right \Vert_2^2\right] \tag{1.101}\\
&=\arg\min_{{{\theta}}} \frac{1} {2\frac{(1-{\alpha}_t)(1-\bar{{\alpha}}_{t-1})}{1-\bar{{\alpha}}_{t}} }\frac{\bar{{\alpha}}_{t-1}(1-{\alpha}_t)^2}{(1-\bar{{\alpha}}_{t})^2} \left[\left \Vert\hat{{x}}_{{\theta} }({x}_t,t)-{x}_{0} \right \Vert_2^2\right] \tag{1.102}\\
&=\arg\min_{{{\theta}}} \frac{1}{2}\frac{\bar{\alpha}_{t-1}(1-{\alpha}_t)}{(1-\bar{\alpha}_{t-1})(1-\bar{{\alpha}}_{t}) } \left[\left \Vert\hat{{x}}_{{\theta} }({x}_t,t)-{x}_{0} \right \Vert_2^2\right]  \tag{1.103}\\
&=\arg\min_{{{\theta}}} \frac{1}{2}\frac{\bar{\alpha}_{t-1}-\bar{\alpha}_t}{(1-\bar{\alpha}_{t-1})(1-\bar{{\alpha}}_{t}) } \left[\left \Vert\hat{{x}}_{{\theta} }({x}_t,t)-{x}_{0} \right \Vert_2^2\right] \tag{1.104}\\
\end{align}
$$

## 1.5 ä¸‰ç§ä¼˜åŒ–ç­–ç•¥çš„æ¯”è¾ƒ
æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ä¹‹å‰çš„æ¨ç†æµç¨‹ï¼ŒVDMçš„ä¼˜åŒ–æºäºå…¬å¼ï¼ˆ1.62ï¼‰çš„ä¸‰é¡¹ï¼š
$$
\underbrace{\mathbb{E}_{q(x_{1}|x_0)} [ \log p_\theta(x_0 | x_1)]}_{é‡å»ºé¡¹} -   \underbrace{D_{KL}(q(x_T|x_0)||p(x_T))}_{å…ˆéªŒåŒ¹é…é¡¹} - \underbrace{\sum_{t=2}^{T} \mathbb{E}_{q(x_t|x_0)} [D_{KL}(q(x_{t-1}|x_t,x_0)||p_\theta(x_{t-1}|x_t))]}_{å»å™ªåŒ¹é…é¡¹}
$$
å› ä¸ºå‰ä¸¤é¡¹ä¸æ—¶é—´tæ— å…³ï¼Œå…¬å¼ï¼ˆ1.62ï¼‰ä¸­æœ€é‡è¦çš„æ˜¯ç¬¬ä¸‰é¡¹
$$
\mathbb{E}_{q(x_t|x_0)} [D_{KL}(q(x_{t-1}|x_t,x_0)||p_\theta(x_{t-1}|x_t))]
$$
æˆä¸ºä¼˜åŒ–é‡ç‚¹ã€‚åœ¨å…¬å¼ï¼ˆ1.100ï¼‰ä¸­ï¼Œæå‡ºäº†åŸºäºå›¾åƒç”Ÿæˆçš„VDMä¼˜åŒ–æ¨¡å¼ã€‚å®ƒå¯ä»¥é€šè¿‡ç®€å•çš„ç¥ç»ç½‘ç»œæ¥è®­ç»ƒï¼Œä»æ‚ä¹±å™ªå£° $x_t$ å¼€å§‹ï¼Œç»è¿‡ $t$ æ­¥æ¥é¢„æµ‹åŸå§‹å›¾åƒ $x_0$ ã€‚è¿™ç§ä¼˜åŒ–ç­–ç•¥å¾ˆç›´æ¥ï¼Œä½†æˆ‘ä»¬è¿˜æœ‰å…¶ä»–ä¸¤ç§çš„ä¼˜åŒ–ç­–ç•¥ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| ä¼˜åŒ–ç­–ç•¥ | ä¼˜åŒ–å…¬å¼                                                                                                                                                                                                       | ç¥ç»ç½‘ç»œå»ºæ¨¡é¡¹                           | å«ä¹‰                  |
| :--- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------- | ------------------- |
| å›¾åƒç”Ÿæˆ | $\arg\min_{{{\theta}}} \frac{1} {2Ïƒ_q^2 (t)}\frac{\bar{{\alpha}}_{t-1}(1-{\alpha}_t)^2}{(1-\bar{{\alpha}}_{t})^2} \left[\left \Vert\hat{{{x}}}_{{{\theta}} }({{x}}_t,t)-{{x}}_{0} \right \Vert_2^2\right]$ | ${\hat{x}}_{{\theta}}({{x}}_t,t)$ | ã€ä¼¼ç„¶è§£é‡Šã€‘ç”Ÿæˆå…·æœ‰æœ€å¤§ä¼¼ç„¶çš„åŸå§‹å›¾åƒ |
| å™ªå£°é¢„æµ‹ | $\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \frac{(1-{\alpha}_t)^2}{(1-\bar{{\alpha}}_t)\alpha_t} \left[ \Big\Vert \epsilon_0 - \hat{\epsilon}_\theta(x_t,t) \Big\Vert_2^2 \right]$                        | $\hat{\epsilon}_\theta(x_t,t)$    | ã€ä¼¼ç„¶è§£é‡Šã€‘ç”Ÿæˆæœ€å¤§ä¼¼ç„¶çš„åˆå§‹å™ªå£°   |
| åˆ†æ•°å‡½æ•° | $\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \frac{(1-{\alpha}_t)^2}{\alpha_t} \left[\Vert s_\theta(x_t,t) - âˆ‡ \logâ¡ ğ‘(x_t)\Vert_2^2 \right]$                                                              | $s_\theta(x_t,t)$                 | ã€åˆ†æ•°è§£é‡Šã€‘å¦‚ä½•ç§»åŠ¨ä»¥æœ€å¤§åŒ–å¯¹æ•°æ¦‚ç‡  |
ä¸‹é¢æˆ‘ä»¬ä¼šåˆ†åˆ«æ¨ç†å„ç§ä¼˜åŒ–æ–¹æ¡ˆ
### 1.5.1 åŸºäºå™ªå£°é¢„æµ‹çš„ä¼˜åŒ–ç­–ç•¥
åœ¨ç­‰å¼ï¼ˆ72ï¼‰ä¸­ï¼Œå°† $x_0$ çš„æ¨å¯¼å˜æˆï¼š
$$
x_0 = \frac{x_t-\sqrt{1-\bar{\alpha}_t}\epsilon_0}{\sqrt{\bar{\alpha}_t}} \tag{1.105}
$$
ä»£å…¥å…¬å¼ï¼ˆ1.88ï¼‰æ¨å¯¼çš„çœŸå®å»å™ªè½¬ç§»å‡å€¼ $Î¼_ğ‘(ğ‘¥_ğ‘¡,ğ‘¥_0)$ ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°æ¨å¯¼ä¸ºï¼š
$$
\begin{align}
\mu_q(x_t,x_0)&=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}} \tag{1.106} \\
&=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t)\frac{x_t-\sqrt{1-\bar{\alpha}_t}\epsilon_0}{\sqrt{\bar{\alpha}_t}}}{1-\bar{{\alpha}}_{t}} \tag{1.107} \\
&=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+(1-{\alpha}_t)\frac{x_t-\sqrt{1-\bar{\alpha}_t}\epsilon_0}{\sqrt{\alpha_t}}}{1-\bar{{\alpha}}_{t}} \tag{1.108} \\
&=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t}{1-\bar{{\alpha}}_{t}} +
\frac{(1-{\alpha}_t)x_t}{(1-\bar{{\alpha}}_t)\sqrt{\alpha_t}} - \frac{(1-{\alpha}_t)\sqrt{1-\bar{\alpha}_t}\epsilon_0}{(1-\bar{{\alpha}}_t)\sqrt{\alpha_t}} \tag{1.109} \\
&=\Big(\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1})}{1-\bar{{\alpha}}_{t}} +
\frac{1-{\alpha}_t}{(1-\bar{{\alpha}}_t)\sqrt{\alpha_t}}\Big)x_t - \frac{(1-{\alpha}_t)\sqrt{1-\bar{\alpha}_t}}{(1-\bar{{\alpha}}_t)\sqrt{\alpha_t}}\epsilon_0 \tag{1.110} \\
&= \Big(\frac{{\alpha}_t(1-\bar{{\alpha}}_{t-1})}{(1-\bar{{\alpha}}_{t})\sqrt{\alpha}_t} +
\frac{1-{\alpha}_t}{(1-\bar{{\alpha}}_t)\sqrt{\alpha_t}}\Big)x_t - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\epsilon_0 \tag{1.111} \\
&= \frac{\alpha_t - \bar{\alpha}_t+1-{\alpha}_t}{(1-\bar{{\alpha}}_t)\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\epsilon_0 \tag{1.112} \\
&= \frac{1 - \bar{\alpha}_t}{(1-\bar{{\alpha}}_t)\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\epsilon_0 \tag{1.113} \\
&= \frac{1}{\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\epsilon_0 \tag{1.114} \\
\end{align}
$$
å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¬¡æ ¹æ®æ¨¡ä»¿åŸåˆ™ï¼Œç”¨æœªçŸ¥ $x_0$ å€¼çš„**è¿‘ä¼¼å»å™ªåˆ†å¸ƒ** $p_Î¸(x_{tâˆ’1}|x_t)$ æ¥è¿‘ä¼¼å·²çŸ¥åŸå§‹å›¾ç‰‡ $x_0$ çš„**çœŸå€¼å»å™ªåˆ†å¸ƒ** $q(x_{tâˆ’1}|x_t,x_0)$ ï¼Œè®¾ç½®è¿‘è§†å»å™ªå‡å€¼ $\mu_\theta(x_t,t)$ ä¸ºï¼š
$$
\mu_\theta(x_t,t) = \frac{1}{\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\hat{\epsilon}_\theta(x_t,t) \tag{1.115}
$$
å…¬å¼ï¼ˆ1.95ï¼‰çš„é€€ç†å¯ä»¥æ”¹ä¸ºå¦‚ä¸‹ä¼˜åŒ–é—®é¢˜ï¼š
$$
\begin{align}
&~~~~\arg\min_{{{\theta}}} D_{\text{KL}}(q({{x}}_{t-1}|{{x}}_t,{{x}}_0)\Vert p_{{\theta}}({{x}}_{t-1}|{{x}}_t))\\
&=\arg\min_{{{\theta}}} D_{\text{KL}}(\mathcal{N} ({{x}}_{t-1}; Î¼_q, Î£_q(t)) \Vert \mathcal{N} ({{x}}_{t-1}; Î¼_{{\theta}}, Î£_q(t))) \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Vert {\mu}_{{\theta}} âˆ’ {\mu}_q \Vert_2^2 \right] \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert \frac{1}{\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\hat{\epsilon}_\theta(x_t,t) âˆ’ \frac{1}{\sqrt{\alpha_t}}x_t + \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\epsilon_0 \Big\Vert_2^2 \right] \tag{1.116} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\epsilon_0 - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}\hat{\epsilon}_\theta(x_t,t) \Big\Vert_2^2 \right] \tag{1.117} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}(\epsilon_0 - \hat{\epsilon}_\theta(x_t,t)) \Big\Vert_2^2 \right] \tag{1.118} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \frac{(1-{\alpha}_t)^2}{(1-\bar{{\alpha}}_t)\alpha_t} \left[ \Big\Vert (\epsilon_0 - \hat{\epsilon}_\theta(x_t,t)) \Big\Vert_2^2 \right] \tag{1.119} \\
\end{align}
$$
è¿™é‡Œï¼Œ$\hat{\epsilon}_\theta(x_t,t)$ æ˜¯ä¸€ä¸ªç”¨æºå™ªå£° $\epsilon_0 \sim \mathcal{N}(\epsilon;0,I)$ æŒ‡å¯¼ $x_t$ åˆ° $x_0$ å»å™ªçš„ç¥ç»ç½‘ç»œã€‚å› æ­¤ï¼Œæˆ‘ä»¬å·²ç»è¯æ˜äº†ä¾é é€šè¿‡å­¦ä¹ åŸå§‹å›¾åƒÂ $ğ‘¥_0$Â è·å¾— VDM ç­‰åŒäºå­¦ä¹ é¢„æµ‹çš„å™ªå£°ã€‚ä¸€äº›ç ”ç©¶å®è¯ï¼Œä½¿ç”¨è¿™ç§é¢„æµ‹å™ªå£°çš„æ–¹æ¡ˆå¯ä»¥å¾—åˆ°æ›´å¥½çš„ç»“æœã€‚
### 1.5.2 åŸºäºåˆ†æ•°å‡½æ•°çš„ä¼˜åŒ–ç­–ç•¥

ä¸ºäº†å¾—å‡ºå˜åˆ†æ‰©æ•£æ¨¡å‹çš„åˆ†æ•°å‡½æ•°çš„ä¼˜åŒ–ç­–ç•¥ï¼Œæˆ‘ä»¬å¼•å…¥ Tweedie å…¬å¼ã€‚ï¼šTweedie å…¬å¼æ¥è‡ªè´å¶æ–¯ä¼°è®¡ã€‚è´å¶æ–¯ä¼°è®¡çš„é—®é¢˜å®šä¹‰ä¸ºæ ¹æ®ä¸€äº›è§‚æµ‹æ•°æ®Â $ğ‘¥$Â æ¥ä¼°è®¡æœªçŸ¥å‚æ•°Â $ğœƒ$ï¼Œå¦‚æœç”¨å‡æ–¹è¯¯å·®(MSE)æŸå¤±å‡½æ•°æ¥è¡¡é‡ä¼°è®¡çš„å‡†ç¡®æ€§çš„è¯ï¼Œæˆ‘ä»¬å°†é—®é¢˜å»ºæ¨¡ä¸ºï¼š
$$
L= \mathbb{E}[(\hat{\theta}(x)-\theta)^2]
$$
æ•´ä¸ªé—®é¢˜æœ¬è´¨å…¶å®å°±æ˜¯æ±‚è§£ï¼Œ $x$ çš„æ¡ä»¶ä¸‹ï¼Œ $\theta$ å€¼çš„æœŸæœ›ï¼š
$$
\hat{\theta}(x)=\mathbb{E}[\theta|x]=\int \theta p(\theta|x)d\theta \tag{1.120}
$$
è€ŒTweedieå…¬å¼ï¼Œå°±æ˜¯ä¸€ç§ä¼°è®¡ $\theta$ çš„æ–¹æ¡ˆã€‚å‡è®¾ $p(x|\theta)=\mathcal{N}(\theta,\sigma^2)$ï¼Œå¯ä»¥é€šè¿‡è§‚æµ‹æ•°æ®ä¼°è®¡å‡ºå‚æ•°ğœï¼Œåˆ™æœ‰ï¼š
$$
\begin{align}
\hat{\theta}(x)=\mathbb{E}[\theta|x] &=\int \theta p(\theta|x)d\theta \\
&= x+\sigma^2\frac{d}{dx} \log p(x) \tag{1.121}
\end{align}
$$
è¿™ä¸ªå…¬å¼çš„ä¼˜ç‚¹æ˜¯ä¸€ç›´ä¿æœ‰ç€ $ğ‘(ğœƒ)$Â çš„é›å½¢è€Œæ²¡æœ‰æ¢ç©¶å®ƒçš„å…·ä½“æ ·å­ã€‚æ­¤å…¬å¼ä¸“ä¾›å·²çŸ¥æ–¹å·®ï¼Œæ±‚ä¸å‡ºæ¥å‡å€¼æ—¶ä½¿ç”¨ã€‚ä»æ•°å­¦ä¸Šè®²ï¼Œå¯¹äºæ»¡è¶³é«˜æ–¯åˆ†å¸ƒçš„å˜é‡Â $ğ‘§ \sim \mathcal{ğ‘}(ğ‘§;Î¼_ğ‘§,Î£_ğ‘§)$ï¼ŒTweedie å…¬å¼å¦‚ä¸‹ï¼š
$$
\mathbb{E}[ğœ‡_z|z]=z+ğ›´_z âˆ‡_z \logâ¡ p(z) \tag{1.122}
$$
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”ç”¨å®ƒæ¥é¢„æµ‹ç»™å®šæ ·æœ¬çš„Â $ğ‘¥_ğ‘¡$Â çš„çœŸå®åéªŒå‡å€¼ã€‚ç”±å…¬å¼ï¼ˆ1.73ï¼‰å¯çŸ¥ï¼š
$$
q(x_t|x_0)=\mathcal{N}(x_t;\sqrt{\bar{\alpha}_t}x_0,(1-\bar{\alpha}_t)I)
$$
è¿™ååˆ†ç¬¦åˆæ–¹å·®å¾ˆå¥½æ±‚ï¼Œå‡å€¼æœ‰ $x_0$ å¤ªéš¾æ±‚çš„ä¾‹å­ã€‚åˆ©ç”¨Tweedieå…¬å¼ï¼Œæˆ‘ä»¬å¾—å‡ºï¼š
$$
\mathbb{ğ¸}[ğœ‡_{x_t}|x_t]=x_t+(1-\bar{\alpha}_t)âˆ‡_{x_t} \logâ¡ ğ‘(x_t) \tag{1.123}
$$
å…¶ä¸­ï¼Œä¸ºäº†ç¬¦å·çš„ç®€æ´æ€§ï¼Œæˆ‘ä»¬å°† $âˆ‡_{x_t}\log p(x_t)$ å†™ä¸º $âˆ‡ \log p(x_t)$Â ã€‚æ ¹æ® Tweedie å…¬å¼ï¼Œç”± $ğ‘¥_ğ‘¡$ ç”Ÿæˆçš„çœŸå®å‡å€¼ $Î¼_{ğ‘¥_ğ‘¡}=\sqrt{\bar{Î±}_t}ğ‘¥_0$ ï¼Œå¯å®šä¹‰ä¸ºï¼š
$$
\begin{align}
\sqrt{\bar{Î±}_t}ğ‘¥_0 &= x_t+(1-\bar{\alpha}_t)âˆ‡_{x_t} \logâ¡ ğ‘(x_t) \tag{1.124} \\
\therefore x_0 &= \frac{x_t+(1-\bar{\alpha}_t)âˆ‡_{x_t} \logâ¡ ğ‘(x_t)} {\sqrt{\bar{Î±}_t}} \tag{1.125}
\end{align}
$$
ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¬å¼ï¼ˆ1.125ï¼‰å†æ¬¡ä»£å…¥æˆ‘ä»¬çš„çœŸå®å»å™ªè½¬ç§»å‡å€¼ $Î¼_ğ‘(ğ‘¥_ğ‘¡,ğ‘¥_0)$å¹¶æ¨å¯¼å‡ºæ–°çš„å½¢å¼ï¼š
$$
\begin{align}
\mu_q(x_t,x_0) &=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}} 
\tag{1.126} \\
&= \frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t)\frac{x_t+(1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t)} {\sqrt{\bar{Î±}_t}} }{1-\bar{{\alpha}}_{t}} \tag{1.127} \\
&= \frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+(1-{\alpha}_t)\frac{x_t+(1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t)} {\sqrt{Î±_t}} }{1-\bar{\alpha}_{t}} \tag{1.128} \\
&= \frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t}{1-\bar{\alpha}_{t}} +
\frac{(1-{\alpha}_t)x_t}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}} + \frac{(1-\alpha_t)(1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t) }{(1-\bar{\alpha}_{t})\sqrt{Î±_t}} \tag{1.129} \\
&= \Big(\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1})}{1-\bar{\alpha}_{t}} +
\frac{1-{\alpha}_t}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}} \Big)x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.130} \\
&= \Big(\frac{{\alpha}_t(1-\bar{{\alpha}}_{t-1})}{(1-\bar{\alpha}_{t})\sqrt{{\alpha}_t}} +
\frac{1-{\alpha}_t}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}} \Big)x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.131} \\
&= \frac{{\alpha}_t -\bar{{\alpha}}_{t}+ 1-{\alpha}_t}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}}x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.132} \\
&= \frac{ 1-\bar{{\alpha}}_{t}}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}}x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.133} \\
&= \frac{ 1}{\sqrt{Î±_t}}x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.134} \\
\end{align}
$$
å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®è¿‘è§†å»å™ªå‡å€¼ $\mu_\theta(x_t,t)$ ä¸ºï¼š
$$
\mu_\theta(x_t,t) = \frac{1}{\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}s_\theta(x_t,t) \tag{1.135}
$$
ç›¸åº”çš„ä¼˜åŒ–é—®é¢˜å¯ä»¥å˜ä¸ºï¼š
$$
\begin{align}
&~~~~\arg\min_{{{\theta}}} D_{\text{KL}}(q({{x}}_{t-1}|{{x}}_t,{{x}}_0)\Vert p_{{\theta}}({{x}}_{t-1}|{{x}}_t))\\
&=\arg\min_{{{\theta}}} D_{\text{KL}}(\mathcal{N} ({{x}}_{t-1}; Î¼_q, Î£_q(t)) \Vert \mathcal{N} ({{x}}_{t-1}; Î¼_{{\theta}}, Î£_q(t))) \tag{1.136} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert \frac{1}{\sqrt{\alpha_t}}x_t + \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}s_\theta(x_t,t) âˆ’ \frac{1}{\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}âˆ‡ \logâ¡ ğ‘(x_t)\Big\Vert_2^2 \right] \tag{1.137} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert  \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}s_\theta(x_t,t) - \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}âˆ‡ \logâ¡ ğ‘(x_t)\Big\Vert_2^2 \right] \tag{1.138} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert  \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}(s_\theta(x_t,t) - âˆ‡ \logâ¡ ğ‘(x_t))\Big\Vert_2^2 \right] \tag{1.139} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \frac{(1-{\alpha}_t)^2}{\alpha_t} \left[\Vert s_\theta(x_t,t) - âˆ‡ \logâ¡ ğ‘(x_t)\Vert_2^2 \right] \tag{1.140} \\
\end{align}
$$
è¿™é‡Œï¼Œ$s_Î¸(x_t, t)$ å¯ä»¥æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œç”¨æ¥å­¦ä¹ é¢„æµ‹åˆ†æ•°å‡½æ•°ï¼ˆscore functionï¼‰ $âˆ‡_{x_t} \log  p(x_t)$ã€‚ $âˆ‡_{x_t} \log  p(x_t)$ å°±æ˜¯åˆ†æ•°å‡½æ•°ï¼Œ å…¶æ€§è´¨åé¢ä¼šè¯¦ç»†é˜è¿°ã€‚æ•é”çš„è¯»è€…ä¼šæ³¨æ„åˆ°ï¼Œåˆ†æ•°å‡½æ•° $âˆ‡ \logâ¡ p(x_t)$ åœ¨å½¢å¼ä¸Šä¸æºå™ªå£° $ğœ–_0$ éå¸¸ç›¸ä¼¼ã€‚å°†Tweedieå…¬å¼ï¼ˆ1.125ï¼‰ä¸é‡å‚æ•°åŒ–æŠ€å·§å…¬å¼ï¼ˆ1.105ï¼‰ç»“åˆèµ·æ¥ï¼Œå¯ä»¥æ˜ç¡®åœ°å±•ç¤ºè¿™ä¸€ç‚¹ï¼š
$$
\begin{align}
x_0 = \frac{x_t+(1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t)} {\sqrt{\bar{Î±}_t}} &= \frac{x_t-\sqrt{1-\bar{\alpha}_t}\epsilon_0}{\sqrt{\bar{\alpha}_t}} \tag{1.141} \\
\therefore (1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t) &= -\sqrt{1-\bar{\alpha}_t}\epsilon_0 \tag{1.142} \\
âˆ‡ \logâ¡ ğ‘(x_t) &= - \frac{1}{\sqrt{1-\bar{\alpha}_t}}\epsilon_0 \tag{1.143} \\
\end{align}
$$
ä¸¤è€…å­˜åœ¨ä¸€ä¸ªéšæ—¶é—´å˜åŒ–çš„å¸¸æ•°é¡¹ï¼åˆ†æ•°å‡½æ•°è¡¡é‡äº†åœ¨æ•°æ®ç©ºé—´ä¸­å¦‚ä½•ç§»åŠ¨ä»¥æœ€å¤§åŒ–å¯¹æ•°æ¦‚ç‡ã€‚ç›´è§‚åœ°è¯´ï¼Œç›¸å¯¹äºæ­£å‘çš„å™ªå£°è¢«æ·»åŠ åˆ°åŸå§‹å›¾åƒçš„æ“ä½œï¼Œåæ–¹å‘"å»å™ªå£°"å°†æ˜¯æé«˜åç»­å¯¹æ•°æ¦‚ç‡çš„æœ€ä½³æ›´æ–°ã€‚æˆ‘ä»¬ç”¨æ•°å­¦è¯æ˜è¯å®äº†è¿™ç§ç›´è§‰ï¼šå­¦ä¹ æ¨¡æ‹Ÿåˆ†æ•°å‡½æ•°ç­‰ä»·äºæ¨¡æ‹Ÿæºå™ªå£°çš„ç›¸åæ•°ï¼ˆå·®ä¸€ä¸ªç¼©æ”¾å› å­ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¾—å‡ºäº†ä¸‰ä¸ªç­‰æ•ˆçš„ä¼˜åŒ–VDMçš„ç›®æ ‡ï¼šå­¦ä¹ ç¥ç»ç½‘ç»œé¢„æµ‹åŸå§‹å›¾åƒ $ğ‘¥_0$ï¼›å­¦ä¹ ç¥ç»ç½‘ç»œé¢„æµ‹æºå™ªå£°Â $ğœ–_0$ï¼›å­¦ä¹ ä¸€å®šå™ªå£°æ°´å¹³ä¸‹çš„å›¾åƒåˆ†æ•°å‡½æ•° $âˆ‡ \logâ¡ p(x_t)$ã€‚é€šè¿‡éšæœºé‡‡æ ·æ—¶é—´æ­¥é•¿ $ğ‘¡$ å¹¶ä½¿é¢„æµ‹ç»“æœä¸åŸºå‡†çœŸå€¼ç›®æ ‡çš„èŒƒæ•°æœ€å°åŒ–ï¼Œå¯ä»¥å¯¹VDMè¿›è¡Œå¯æ‰©å±•çš„è®­ç»ƒã€‚
## 1.6 æœ¬èŠ‚å°ç»“
åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢ç´¢å’Œå›é¡¾æ‰©æ•£æ¨¡å‹ã€‚æ•´ä½“æ¨ç†å¦‚ä¸‹å›¾ã€‚æ‰©æ•£æ¨¡å‹é€šè¿‡æ¨¡æ‹Ÿä¸€ä¸ªé€æ­¥çš„éšæœºè¿‡ç¨‹æ¥ç”Ÿæˆæ•°æ®ï¼Œè¯¥è¿‡ç¨‹ä»ç®€å•çš„åˆ†å¸ƒï¼ˆå¦‚é«˜æ–¯åˆ†å¸ƒï¼‰å¼€å§‹ï¼Œé€æ­¥æ¼”åŒ–ä¸ºç›®æ ‡æ•°æ®åˆ†å¸ƒã€‚æ‰©æ•£æ¨¡å‹ä¸ä»…å…·æœ‰åŸºäºä¼¼ç„¶çš„è§£é‡Šï¼Œä¹Ÿæ‹¥æœ‰åŸºäºåˆ†æ•°çš„è§†è§’ï¼š
- **åŸºäºä¼¼ç„¶çš„è§£é‡Š**ï¼šåŒ…æ‹¬â€œåŸºäºå›¾åƒç”Ÿæˆâ€ä¸â€œåŸºäºå™ªå£°ç”Ÿæˆâ€çš„ä¸¤ç§ä¼˜åŒ–ç­–ç•¥ã€‚æ‰©æ•£æ¨¡å‹å¯è§†ä¸ºä¸€ä¸ªæ¡ä»¶æ¦‚ç‡æ¨¡å‹ï¼Œå…¶ä¸­çš„æ¡ä»¶æ˜¯æ‰©æ•£è¿‡ç¨‹çš„å‚æ•°ã€‚é€šè¿‡æœ€å¤§åŒ–æ¡ä»¶ä¼¼ç„¶ï¼Œå¯ä»¥è®­ç»ƒæ¨¡å‹ä»¥æ›´æœ‰æ•ˆåœ°ç”Ÿæˆæ•°æ®ã€‚
- **åŸºäºåˆ†æ•°çš„è§£é‡Š**ï¼šæ‰©æ•£æ¨¡å‹çš„æ ¸å¿ƒæ˜¯é¢„æµ‹åˆ†æ•°å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºè¯„ä¼°åœ¨ç‰¹å®šæ‰©æ•£æ­¥éª¤ä¸‹ï¼ŒçœŸå®æ•°æ®ä¸æ¨¡å‹ç”Ÿæˆæ•°æ®ä¹‹é—´çš„å·®å¼‚ã€‚é€šè¿‡ä¸æ–­ä¼˜åŒ–è¿™ä¸ªåˆ†æ•°å‡½æ•°ï¼Œå¯ä»¥æ˜¾è‘—æå‡ç”Ÿæˆæ•°æ®çš„è´¨é‡å’Œå¤šæ ·æ€§ã€‚ï¼ˆç¬¬äºŒèŠ‚è¯¦ç»†æè¿°ï¼‰
æ‰©æ•£æ¨¡å‹èƒŒåçš„æ•°å­¦åŸºç¡€æ¶µç›–äº†æ¦‚ç‡è®ºã€éšæœºè¿‡ç¨‹å’Œä¼˜åŒ–ç†è®ºç­‰å¤šä¸ªé¢†åŸŸã€‚æ·±å…¥ç†è§£è¿™äº›åŸç†å¯¹äºå…¨é¢æŒæ¡æ‰©æ•£æ¨¡å‹çš„å·¥ä½œåŸç†å’Œåº”ç”¨æ½œåŠ›è‡³å…³é‡è¦ã€‚é€šè¿‡ç»†è‡´çš„ç ”ç©¶ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°åˆ©ç”¨è¿™äº›å…ˆè¿›çš„å·¥å…·æ¥è§£å†³ç°å®ä¸–ç•Œä¸­çš„å¤æ‚é—®é¢˜ã€‚

[1] ã€ŠUnderstanding Diffusion Models: A Unified Perspectiveã€‹Calvin Luo, Google Research, Brain Team