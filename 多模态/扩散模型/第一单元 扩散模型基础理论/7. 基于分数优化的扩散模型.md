è¿™éƒ¨åˆ†ä¸»è¦æºäºNCSN ï¼ˆNoise Conditional Score Networksï¼‰è®ºæ–‡[2]ï¼Œè¿™æ˜¯å®‹é£å‘è¡¨åœ¨ NeurIPS2019 ä¸Šé¢çš„æ–‡ç« ï¼Œæ¯”DDPMé‚£ç¯‡æ–‡ç« è¿˜è¦æ—©ã€‚å®‹é£åšå£«è®¤ä¸ºç°æœ‰çš„ç”Ÿæˆæ¨¡å‹å¯ä»¥å¤§ä½“åˆ†ä¸ºä¸¤ç§[3]ï¼š**åŸºäºä¼¼ç„¶çš„æ¨¡å‹**ä¸**éšå¼ç”Ÿæˆæ¨¡å‹**ã€‚åŸºäºä¼¼ç„¶çš„æ¨¡å‹è¦ä¹ˆä¸ºä¼¼ç„¶çš„è®¡ç®—å¯¹æ¨¡å‹ç»“æ„åšå¾ˆå¼ºçš„é™åˆ¶ï¼Œè¦ä¹ˆä¾èµ–ç›®æ ‡å‡½æ•°æ¥åšâ€œè¿‘ä¼¼æå¤§ä¼¼ç„¶â€çš„è®­ç»ƒã€‚è€Œéšå¼ç”Ÿæˆæ¨¡å‹è¦æ±‚å¯¹æŠ—è®­ç»ƒï¼Œæ¨¡å‹ä¸ç¨³å®šå¾ˆå®¹æ˜“å´©æºƒã€‚ä¸ºäº†è§„é¿è¿™äº›é—®é¢˜ï¼Œå®‹é£åšå£«é€‰æ‹©ä»å¤§é‡è¢«å™ªå£°æ‰°åŠ¨çš„æ•°æ®åˆ†å¸ƒä¸­å­¦ä¹ åˆ†æ•°å‡½æ•°ï¼ˆscore functionï¼‰ï¼Œå³â€œ**æ–¯å¦å› åˆ†æ•°**ï¼ˆStein scoreï¼‰â€ã€‚å¹¶ä½¿ç”¨æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦ï¼ˆLangevin dynamicsï¼‰çš„æ–¹æ³•ä»ä¼°è®¡çš„æ•°æ®åˆ†å¸ƒä¸­è¿›è¡Œé‡‡æ ·æ¥ç”Ÿæˆæ–°çš„æ ·æœ¬ã€‚è¿™æ ·å¾—åˆ°çš„ç”Ÿæˆæ¨¡å‹é€šå¸¸ç§°ä¸ºâ€œ**åŸºäºåˆ†æ•°çš„ç”Ÿæˆæ¨¡å‹**â€ï¼ˆScore-based Generative Modelsï¼ŒSGMï¼‰ã€‚æœ¬éƒ¨åˆ†ä¸æ˜¯è¦è§£æ NCSN è®ºæ–‡ï¼Œè€Œæ˜¯è¦å€Ÿå®‹é£åšå£«çš„è§‚ç‚¹ä»‹ç»â€œåˆ†æ•°ç”Ÿæˆâ€ã€‚
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬éƒ¨åˆ†æœ‰ä¸¤ç§æ¨ç†æ–¹æ³•ï¼šåŸºäºåˆ†æ•°åŒ¹é…çš„éƒä¹‹ä¸‡åŠ¨æ€å…¬å¼ Score-Matching Langevin Dynamics (SMLD)ï¼ŒTweedie å…¬å¼ã€‚æˆ‘è®²ä»è¿™ä¸¤éƒ¨åˆ†ä»‹ç»æ•´ä½“çš„æ¨ç†è¿‡ç¨‹ã€‚
### 7.1 â€œåˆ†æ•°â€çš„èµ·æº
ä¼ ç»Ÿç”Ÿæˆæ¨¡å‹çš„ç›®æ ‡å°±æ˜¯è¦å¾—åˆ°æ•°æ®çš„åˆ†å¸ƒã€‚ä¾‹å¦‚ä¸€ä¸ªæ•°æ®é›† ${x_1, x_2, ..., x_N}$ çš„æ•°æ®çš„æ¦‚ç‡å¯†åº¦åˆ†å¸ƒï¼ˆæ³¨æ„ï¼Œè¿™é‡Œæ˜¯æ¦‚ç‡å¯†åº¦åˆ†å¸ƒï¼ŒPDFï¼‰ä¸º $p(x)$ ã€‚èµ·åˆæˆ‘ä»¬è®¤ä¸ºåˆå§‹çš„æ•°æ®æ˜¯æ‚ä¹±çš„ï¼Œéšæœºçš„ï¼Œæˆ‘ä»¬å¯ä»¥è®°ä¸ºï¼š
$$
p_{\theta}({x}) = \frac{e^{-f_{\theta}({x})}}{C_{\theta}},f_{\theta}({x})\in \mathbb{R} \tag{2.1}\\
$$
$\theta$ æ˜¯å‚æ•°ç”¨äºå»ºæ¨¡ï¼Œ $f_{\theta}$ è¢«ç§°ä¸ºæ ¸å¿ƒèƒ½é‡æ¨¡å‹ï¼ˆenergy-based modelï¼‰ã€‚è¿™ä¸ªå‡½æ•°å‹å°±å¾ˆåƒé«˜æ–¯å‡½æ•° $f(x)=\frac{1}{Ïƒ \sqrt{2Ï€}} \cdot e^{\frac{-(x - Î¼)^2} {2Ïƒ^2}}$ ã€‚æˆ‘ä»¬é¦–å…ˆè®¡ç®—åŸºäº $x$ çš„å¯¼æ•°ä¸ºï¼š
$$
\nabla _{{x}}\log(p_{\theta}({x})) = -\nabla _{{x}}f _{\theta}({x}) - \nabla _{{x}}\log C_{\theta} = -\nabla _{{x}}f _{\theta}({x}) \tag{2.2} \\
$$
è¿™é‡Œ $\nabla _{{x}}\log C_{\theta}=0$ ã€‚æ­¤æ—¶æˆ‘ä»¬çªç„¶å‘ç°ï¼Œå¦‚æœæ±‚è§£ $\nabla _{{x}}\log p_\theta({x})$ å°±ä¸éœ€æ±‚è§£å¯¹ $x$ çš„å¸¸æ•°$C_\theta$äº†ã€‚
å…¬å¼2.2çš„ $-\nabla _{{x}}f _{\theta}({x})$ åœ¨è¿™é‡Œç§°ä¸ºâ€œæ–¯å¦å› åˆ†æ•°â€ï¼ˆStein scoreï¼‰å†ç›¸å…³è®ºæ–‡ä¸­ï¼Œç®€ç§°ä¸ºâ€œåˆ†æ•°â€ï¼ˆscoreï¼‰ã€‚è¿™é‡Œè¦æ˜ç¡®ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¯¹ $x$ æ±‚å¯¼è€Œä¸æ˜¯ç±»ä¼¼äºâ€œæå¤§ä¼¼ç„¶è®¡ç®—å‚æ•°â€çš„å¯¹ $\theta$ æ±‚å¯¼ã€‚é‚£æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ›´è¿™é‡Œå…³æ³¨çš„æ˜¯æ•°æ® $x$ é‡‡æ ·ã€‚å…¶åŸå› è¦ä»â€œåˆ†æ•°â€å…·ä½“æ„ä¹‰è§£é‡Šã€‚ä»æ•°å­¦çš„è§’åº¦å‡ºå‘æ¥çœ‹ï¼Œâ€œåˆ†æ•°â€æ˜¯ä¸€ä¸ªâ€œçŸ¢(å‘)é‡åœºâ€(vector field) ã€‚å‘é‡çš„æ–¹å‘æ˜¯ï¼šå¯¹äºè¾“å…¥æ•°æ®(æ ·æœ¬)æ¥è¯´ï¼Œå…¶å¯¹æ•°æ¦‚ç‡å¯†åº¦å¢é•¿æœ€å¿«çš„æ–¹å‘ã€‚å¦‚æœåœ¨é‡‡æ ·è¿‡ç¨‹ä¸­æ²¿ç€åˆ†æ•°çš„æ–¹å‘èµ°ï¼Œå°±èƒ½å¤Ÿèµ°åˆ°æ•°æ®åˆ†å¸ƒçš„é«˜æ¦‚ç‡å¯†åº¦åŒºåŸŸï¼Œæœ€ç»ˆç”Ÿæˆçš„æ ·æœ¬å°±ä¼šç¬¦åˆåŸæ•°æ®åˆ†å¸ƒã€‚ç”±æ­¤å¯çŸ¥ï¼Œä¹‹æ‰€ä»¥æˆ‘ä»¬æ›´å…³æ³¨æ•°æ® $x$ é‡‡æ ·ï¼Œæ˜¯å› ä¸ºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡‡æ ·ï¼Œè®©æ ·æœ¬åˆ†å¸ƒæ›´è¶‹è¿‘äºâ€œçŸ¢(å‘)é‡åœºâ€åˆ†å¸ƒã€‚
ç°åœ¨æˆ‘ä»¬æƒ³è¦è®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œæ¥ä¼°è®¡å‡ºâ€œåˆ†æ•°â€çš„åˆ†å¸ƒã€‚å‡è®¾ç”¨ $s_\theta({x})$ è®­ç»ƒç¥ç»ç½‘ç»œçš„åˆ†æ•°ï¼ŒåŒç† $\theta$ æ˜¯ä»£è¡¨ç¥ç»ç½‘ç»œã€‚æˆ‘ä»¬å¯ä»¥è·ç¦»L2æŸå¤±å‡½æ•°æ¥æœ€å°åŒ–çœŸå®çš„score functionï¼Œå¦‚ä¸‹ï¼š
$$\mathcal{Loss} = \mathbb{E}_{p({x})}[||\nabla _{{x}}\log p({x}) - {s} _{\theta}({x})||^{2}] \tag{2.3}$$
è¿™ä¸ªæŸå¤±å¯ä»¥å«**æ˜¾å¼åˆ†æ•°åŒ¹é…æŸå¤±**ï¼ˆESMï¼‰ï¼ŒåŠ äº†â€æ˜¾å¼â€œäºŒå­—å°±æ˜¯ä¸ºäº†ä¸åé¢æ›´å¸¸ç”¨çš„â€œåˆ†æ•°åŒ¹é…æŸå¤±â€åŒºåˆ†ï¼Œè¿™é‡Œä¸åšè¿‡å¤šé˜è¿°ã€‚å…¶ä¸­ $p(x)$ æ²¡æœ‰ä¸‹æ ‡ $\theta$ ï¼Œä»£æŒ‡å¯ä»¥é€šè¿‡æ ·æœ¬é‡‡æ ·è®¡ç®—ã€‚
å®‹é£åšå£«åœ¨å™ªå£°æ¡ä»¶åˆ†æ•°ç½‘ç»œ NCSN è®ºæ–‡[3]ä¸­ç»™å‡ºäº†å¦ä¸€ç§åˆ†æ•°åŒ¹é…æŸå¤±è§£å†³æ–¹æ¡ˆï¼Œä½†æœ¬è´¨ä¸å…¶ç›¸åŒã€‚
### 7.2  åŸºäºåˆ†æ•°ä¼˜åŒ–çš„æ‰©æ•£æ¨¡å‹ï¼ˆSMLDï¼‰
#### 7.2.1  éƒä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·æ–¹æ³•
æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦ï¼ˆLangevin dynamicsï¼‰åŸæ˜¯æè¿°ç‰©ç†å­¦ä¸­å¸ƒæœ—è¿åŠ¨ï¼ˆæ‚¬æµ®åœ¨æ¶²ä½“æˆ–æ°”ä½“ä¸­çš„å¾®å°é¢—ç²’æ‰€åšçš„æ— è§„åˆ™è¿åŠ¨ï¼‰çš„å¾®åˆ†æ–¹ç¨‹ï¼Œå€Ÿé‰´åˆ°è¿™é‡Œä½œä¸ºä¸€ç§ç”Ÿæˆæ ·æœ¬çš„æ–¹æ³•ã€‚ä»ä¸€ä¸ªåˆ†å¸ƒä¸­é‡‡æ ·æ—¶ï¼Œç»å¸¸ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚æ¦‚æ‹¬åœ°æ¥è¯´ï¼Œè¯¥æ–¹æ³•é¦–å…ˆä»å…ˆéªŒåˆ†å¸ƒéšæœºé‡‡æ ·ä¸€ä¸ªåˆå§‹æ ·æœ¬ï¼Œç„¶ååˆ©ç”¨æ¨¡å‹ä¼°è®¡å‡ºæ¥çš„åˆ†æ•°é€æ¸å°†æ ·æœ¬å‘æ•°æ®åˆ†å¸ƒçš„é«˜æ¦‚ç‡å¯†åº¦åŒºåŸŸé è¿‘ã€‚ä¸ºä¿è¯ç”Ÿæˆç»“æœçš„å¤šæ ·æ€§ï¼Œæˆ‘ä»¬éœ€è¦é‡‡æ ·è¿‡ç¨‹å¸¦æœ‰éšæœºæ€§ã€‚å½“ç»è¿‡ä¸­æ‰€è¿°çš„åˆ†æ•°åŒ¹é…æ–¹æ³•è®­ç»ƒæ·±åº¦ç”Ÿæˆæ¨¡å‹åï¼Œå¯ä»¥ä½¿ç”¨å…·æœ‰è¿­ä»£è¿‡ç¨‹çš„æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦é‡‡æ ·æ–¹æ³•ä»åˆ†å¸ƒä¸­æ¥ç”Ÿæˆæ–°çš„æ ·æœ¬ã€‚
æœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦æ¨ç†è¿‡ç¨‹å¾ˆå¤æ‚ï¼Œä¸”å±äºç‰©ç†çš„çŸ¥è¯†ï¼Œè¿™é‡Œä¸å†è¿‡å¤šæè¿°ã€‚é‡‡æ ·è¿‡ç¨‹æè¿°ï¼šå‡è®¾åˆå§‹æ•°æ®æ»¡è¶³å…ˆéªŒåˆ†å¸ƒÂ $x_0 \sim \pi(x)$ ï¼Œç„¶åä½¿ç”¨è¿­ä»£è¿‡ç¨‹
$$
\begin{align*}
x_{t+1}&=x_t+\frac{\epsilon}{2}\nabla _{x}\log  p\left( x \right) +\sqrt{\epsilon}\boldsymbol{z}_t, t=0,1,2,\cdots ,T\\
&=x_t+{\tau}\nabla _{x}\log  p\left( x \right) +\sqrt{2\tau}\boldsymbol{z}_t, t=0,1,2,\cdots ,T \tag{2.4}\\
\end{align*}
$$
å½“ $\frac{\epsilon}{2}=\tau$ æ—¶ä¸Šé¢çš„å…¬å¼ç­‰ä»·ã€‚å…¶ä¸­ï¼Œ $z_i \sim \mathcal{N}(0,I)$ ä¸ºæ ‡å‡†é«˜æ–¯åˆ†å¸ƒï¼Œå¯ä»¥çœ‹æˆæ˜¯å™ªå£°çš„æ¦‚å¿µï¼Œ$\epsilon,\tau$ æ˜¯å¯ä»¥çœ‹æˆæ­¥é•¿ã€‚è™½ç„¶ç‰©ç†å®šä¹‰ä¸åŒï¼Œä½†â€œæœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦å…¬å¼â€æœ¬è´¨ä¸â€œéšæœºæ¢¯åº¦ä¸‹é™â€ï¼Œâ€œæ³°å‹’å…¬å¼å±•å¼€â€å®é™…ä¸Šæ˜¯åŒæºçš„ã€‚ä¾‹å¦‚æˆ‘ä»¬åœ¨é«˜ç­‰æ•°å­¦ä¸­å­¦åˆ°çš„æ³°å‹’å±•å¼€å…¬å¼å¦‚ä¸‹ï¼š
$$
\begin{align}
f(x+\epsilon)=f(x)+f^{'}(x)\epsilon+\frac{1}{2}f^{''}(x)\epsilon^2+o(\epsilon^3)
\end{align}
$$
å†çœ‹â€œæ¢¯åº¦ä¸‹é™â€çš„å…¬å¼ï¼š
$$
\begin{align}
f(k-\epsilon) =f(k) Â - \epsilon * f'(k) \\
x_{k+1} = x_k - \epsilon*f'(k)
\end{align}
$$
ä¸ºäº†é€‚é…â€œæ¢¯åº¦ä¸‹é™â€è´Ÿæ¢¯åº¦æ±‚æœ€å°å€¼çš„é€»è¾‘ï¼Œè¿™é‡Œçš„ $\epsilon$ æ˜¯ä¸ªè´Ÿå€¼ã€‚ä½†æ˜¯è¿™å¹¶ä¸å¦è®¤â€œæ³°å‹’å…¬å¼å±•å¼€â€åŒæºçš„æ¦‚å¿µã€‚ä¸ºä»€ä¹ˆæ€»æ˜¯â€œæ³°å‹’å…¬å¼å±•å¼€â€åœ¨èµ·å…³é”®ä½œç”¨ã€‚å…¶æœ¬è´¨åœ¨äºæ³°å‹’å…¬å¼æ˜¯åœ¨ä¸€æ­¥æ­¥é è¿‘æå€¼ï¼Œä¸”è¶Šé è¿‘æå€¼ï¼Œæ¢¯åº¦è¶Šç­‰äº0è¶Šä¸æ›´æ–°ã€‚æ‰€ä»¥ä»¥åæˆ‘ä»¬åœ¨æå€¼é™„è¿‘è€ƒè™‘é—®é¢˜æ—¶ï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘â€œæ³°å‹’å…¬å¼å±•å¼€â€æ–¹æ¡ˆã€‚å› ä¸ºæœ‰ $\sqrt{2\tau}z_t$ é¡¹çš„ä½œç”¨ï¼Œâ€œæœ—ä¹‹ä¸‡åŠ¨åŠ›å­¦å…¬å¼â€ä¸æ˜¯ç´§è´´æå€¼é‡‡æ ·ï¼Œè€Œæ˜¯åœ¨æå€¼é™„è¿‘é‡‡æ ·ï¼›è€Œä¸”ç”±äº $z_t$ çš„éšæœºä½œç”¨ï¼Œé‡‡æ ·ä¼šéšæœºçš„èšåˆåœ¨æå€¼é™„è¿‘ã€‚é‡‡æ ·çš„ç›®çš„è‡ªç„¶ä¹Ÿæ˜¯ä¸ºäº†æ›´å¥½çš„æè¿°æ•´ä½“åˆ†å¸ƒã€‚ç†è®ºä¸Šï¼Œåœ¨å…¬å¼ï¼ˆ2.4ï¼‰ä¸­ï¼Œå½“ $t \rightarrow \infty$ æ—¶ï¼Œ$\epsilon \rightarrow 0$ ï¼Œæœ€ç»ˆç”Ÿæˆçš„æ ·æœ¬Â $x_t$ å°†ä¼šæœä»åŸæ•°æ®åˆ†å¸ƒÂ $q_{data}(x)$ï¼Œè¶‹äºæŸä¸€ä¸ªç‰¹å®šå€¼ã€‚ï¼ˆå¦‚å›¾2.1ï¼‰
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥è¿­ä»£é‡‡æ ·è¿‡ç¨‹çš„ä¸¤ä¸ªæ€§è´¨ï¼š1. åœ¨è¿™ä¸ªåºåˆ—ä¸­ï¼Œç›¸é‚»ä¸¤ä¸ªå˜é‡å­˜åœ¨å…³ç³»ï¼Œä¸ç›¸é‚»çš„ä¸¤ä¸ªå˜é‡æ— å…³ã€‚2. æ•´ä½“ç»“æœè¶‹è¿‘äºç¨³æ€ã€‚è¿™ç§æ€§è´¨è‡ªç„¶å°±å’Œé©¬å°”å¯å¤«é“¾äº§ç”Ÿå…³ç³»ã€‚

![](images/2.2.2.jpg)
å›¾ 2.1 ä»å·¦åˆ°å³ï¼Œå›¾ç‰‡æ¨¡æ‹Ÿçš„æ˜¯ä½¿ç”¨â€œéƒä¹‹ä¸‡åŠ¨åŠ›å­¦â€åœ¨ä¸¤ä¸ªé«˜æ–¯åˆ†å¸ƒä¸­é‡‡æ ·ï¼Œæœ€åé‡‡æ ·çš„ç»“æœï¼ˆå³å›¾ï¼‰å¾ˆç¬¦åˆåŸå§‹ä¸¤ä¸ªå³°å€¼çš„é«˜æ–¯åˆ†å¸ƒ

#### 7.2.2 åŸºäºåˆ†æ•°ä¼˜åŒ–çš„ç”Ÿæˆæ¨¡å¼
æ€è·¯å…ˆä»â€œéƒä¹‹ä¸‡åŠ¨åŠ›å­¦å…¬å¼â€å›æ¥ï¼Œæˆ‘ä»¬çš„ç›®çš„æ˜¯è¿˜æ˜¯è¦åšå›¾åƒç”Ÿæˆã€‚å½“å‰çš„é—®é¢˜æ˜¯ï¼šä¸çŸ¥é“**åŸå§‹æ•°æ®åˆ†å¸ƒï¼Œæ›´ä¸çŸ¥é“çš„æ•°æ®æ¢¯åº¦å‘é‡**ã€‚æœ‰ä¸€ç§è§£é¢˜æ–¹æ³•æ˜¯ä»æ ‡å‡†é«˜æ–¯å™ªå£°ä¸­æ„å»ºæ–°åˆ†å¸ƒã€‚æˆ‘ä»¬è€ƒè™‘ä»æ ‡å‡†é«˜æ–¯åˆ†å¸ƒ $\mathcal{N}(0,ğ¼)$ ä¸­é‡‡æ ·éšæœºå™ªå£°ğœ–ï¼Œç„¶åä¹˜ä¸Šæˆ‘ä»¬é¢„å®šä¹‰çš„ $ğœ$ ï¼Œæ¥ç€åŠ åˆ°æ ·æœ¬ $ğ‘¥$ ä¸­ï¼Œä»è€Œå°±èƒ½å¾—åˆ°åŠ å™ªåçš„æ ·æœ¬ $\tilde{ğ‘¥}$ã€‚è¿™ç§æ€è·¯ä¸VAEçš„é‡å‚æ•°åŒ–æŠ€å·§ä¸€è‡´ã€‚æˆ‘ä»¬æ„å»ºæ–°åˆ†å¸ƒä¸ºï¼š
$$\begin{align}
q_{\sigma}(\tilde{x}) &=\int q_Ïƒ(\tilde{x}|x) q_{data}(x) dx \tag{2.5} \\
& = \int \mathcal{N}(\tilde{x}|x,Ïƒ^2I)q_{data}(x) dx \tag{2.6}\\
\text{and} ~ \tilde{x}&=x+\sigma\epsilon, ~ \epsilon\sim \mathcal{N}(0,I) \tag{2.7} \\
\end{align}$$å…¬å¼ï¼ˆ2.5ï¼‰çš„ç§¯åˆ†æ˜¯ä»£è¡¨é‡‡æ ·ï¼Œæœ‰äº›åœ°æ–¹ä¼šçœ‹åˆ°å…¬å¼ï¼ˆ2.6ï¼‰çš„å½¢å¼ï¼Œå› ä¸ºå·²ç»é‡å‚æ•°åŒ–æˆæ­£æ€åˆ†å¸ƒã€‚**ä»å…¬å¼æè¿°ä¸Šæˆ‘ä»¬ä¹ŸçŸ¥é“ $q_{data}$ å‡½æ•°å…¶å®å°±æ˜¯ $q_Ïƒ$ ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡åˆ†å¸ƒé‡‡æ ·å¾—åˆ°å‡½æ•°ã€‚** $q_{data}(x)$ ä»£è¡¨éœ€è¦æ‰°åŠ¨çš„æ•°æ®çš„é‡‡æ ·åˆ†å¸ƒã€‚$q_Ïƒ(\tilde{x}|x) \sim \mathcal{N}(\tilde{x}|x,Ïƒ^2I)$ è¡¨ç¤ºæ‰°åŠ¨å™ªå£°æ•°æ®åˆ†å¸ƒã€‚$q_{\sigma}(\tilde{x})$ å°±æ˜¯æˆ‘ä»¬æ„å»ºçš„æ–°åˆ†å¸ƒã€‚$\tilde{ğ‘¥}$å°±æ˜¯æˆ‘ä»¬åŠ å™ªçš„æ–°æ ·æœ¬ã€‚å™ªå£°æ¡ä»¶åˆ†æ•°ç½‘ç»œæ˜¯åˆ†æ•°æ¨¡å‹çš„ä¸€ä¸ªä½¿ç”¨ç‰¹ä¾‹ã€‚
***
è¯´æ˜ï¼šå®‹é£åšå£«åœ¨è®ºæ–‡ä¸blogæœ‰ä¸åŒçš„æ ‡è®°æ–¹æ³•ã€‚è®ºæ–‡æ›´å‡†ç¡®ç”¨çš„æ˜¯ $q_{\sigma}(x)$ ï¼Œä»£è¡¨ä¸ $p(x)$ ä¸åŒï¼›blogä¸Šç”¨çš„æ˜¯ $p_{\sigma}(x)$ ï¼Œä¸ºäº†åœ¨åé¢ä»å…¬å¼ä¸Šç›´æ¥æ›¿æ¢ $q_{data}(x)$ ã€‚ä¸¤è€…éƒ½æ²¡æœ‰é”™ï¼Œå°±æ˜¯è§£é‡Šä¸åŒã€‚
***
NCSNçš„ç›®æ ‡æ˜¯è®­ç»ƒä¸€ä¸ªæ¡ä»¶åˆ†æ•°ç½‘ç»œÂ $s_{\theta}( \tilde{x},\sigma )$Â æ¥ä¼°è®¡æ‰°åŠ¨æ•°æ®çš„åˆ†å¸ƒï¼Œå³Â 
$$
\frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x})}
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x})\Vert_2^2\Big] \tag{2.8}
$$
æˆ‘ä»¬ä¾æ®DSMè®ºæ–‡[4]ï¼Œå¾—åˆ°ä»¥ä¸‹çš„æ¨å¯¼å…¬å¼
$$
\begin{align}
& ~~~~ \frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x})}
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x})\Vert_2^2\Big] \tag{2.9} \\
&=\frac{1}{2}\int {q_Ïƒ(\tilde{x})}
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \frac{1}{q_Ïƒ(\tilde{x})}\frac{\partial q_Ïƒ(\tilde{x})}{\partial \tilde{x}} \Vert_2^2\Big] d\tilde{x}\\
&=\frac{1}{2}\int 
\Big[\Vert {q_Ïƒ(\tilde{x})}s_{\theta}( \tilde{x},\sigma ) - \frac{\partial q_Ïƒ(\tilde{x})}{\partial \tilde{x}} \Vert_2^2\Big] d\tilde{x}\\
&=\frac{1}{2}\int 
\Big[\Vert {q_Ïƒ(\tilde{x})}s_{\theta}( \tilde{x},\sigma ) - \frac{\partial \int q_Ïƒ(\tilde{x}|x) q_Ïƒ(x) dx}{\partial \tilde{x}} \Vert_2^2\Big] d\tilde{x} \\
&=\frac{1}{2}\int 
\Big[\Vert {q_Ïƒ(\tilde{x})}s_{\theta}( \tilde{x},\sigma ) - \int \frac{\partial q_Ïƒ(\tilde{x}|x)}{\partial \tilde{x}} q_Ïƒ(x) dx \Vert_2^2\Big] d\tilde{x} \\
&=\frac{1}{2}\int 
\Big[\Vert {\int q_Ïƒ(\tilde{x}|x) q_Ïƒ(x) dx} \cdot s_{\theta}( \tilde{x},\sigma ) - \int q_Ïƒ(\tilde{x}|x) q_Ïƒ(x)\frac{\partial \log q_Ïƒ(\tilde{x}|x)}{\partial \tilde{x}} dx \Vert_2^2\Big] d\tilde{x} \\
&=\frac{1}{2}\int_{\tilde{x}} \int_x q_Ïƒ(\tilde{x}|x) q_Ïƒ(x) 
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \frac{\partial \log q_Ïƒ(\tilde{x}|x)}{\partial \tilde{x}}\Vert_2^2\Big] dx d\tilde{x} \\
&= \frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x}|x) q_Ïƒ(x) }
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x}|x)\Vert_2^2\Big] \tag{2.10}
\end{align}
$$
å…¬å¼ï¼ˆ2.10ï¼‰å°±æ˜¯å»å™ªå£°åˆ†æ•°åŒ¹é…çš„æŸå¤±å‡½æ•°ã€‚å»å™ªåˆ†æ•°åŒ¹é…ï¼ˆDenoising Score Matchingï¼ŒDSMï¼‰æ–¹æ³•æ˜¯åœ¨è®¡ç®—å™ªå£°æ¡ä»¶åˆ†æ•°ç½‘ç»œï¼ˆNCSNï¼‰ ä¸­é»˜è®¤çš„è®¡ç®—æ–¹æ³•[3]ã€‚
è¿™é‡Œé¢è¿˜æœ‰ä¸€ä¸ªæ½œåœ¨æ¨ç†ã€‚å½“ $x$ æ˜¯ $D$ ç»´ï¼ˆå¦‚æœ $f(x)$ æ˜¯ä¸€ç»´é«˜æ–¯ï¼Œä¸‹é¢ç»“æœä¼šæ›´å®¹æ˜“å¾—å‡ºäº†ï¼Œè¿™é‡Œä¸åšè§£é‡Šã€‚ï¼‰ï¼Œå³ ${x}\in \mathbb{R} ^D$ æ—¶ï¼Œç”±å¤šç»´é«˜æ–¯åˆ†å¸ƒ $f( \mathbf{x} ) = \frac{1}{(2\pi)^{\frac{D}{2}} | Î£ |^{\frac{1}{2}}} e^{- \frac{1}{2}( x - Î¼ )^T Î£^{-1}(x - Î¼)}$  å¯å¾—:
$$
\begin{align}
\nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x}|x) &= \nabla _{\tilde{x}}(C - \frac{1}{2}(\tilde{x} - x )^T Î£^{-1}(\tilde{x} - x)) \\
&= -Î£^{-1}(\tilde{x} - x) \\
&= -\begin{bmatrix} ğœ_{1}^2 & & & \\ & ğœ_{2}^2 & & \\ & & \ddots &\\ & & &ğœ_{d}^2 \end{bmatrix}^{-1} (\tilde{x} - x) \tag{2.11}\\
&= - \frac{\tilde{x} - x}{ğœ^2} \tag{2.12} \\
&= - \frac{\epsilon}{ğœ} \tag{2.13}
\end{align}
$$
 ï¼Œå°†ï¼ˆ2.12ï¼‰å¸¦å…¥å…¬å¼ï¼ˆ2.10ï¼‰å¯ä»¥å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼š
$$
\begin{align}
& ~~~~ \frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x}|x) q_{data}(x) }
\Big[\Vert s_{\theta}( \tilde{x},\sigma ) - \nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x}|x)\Vert_2^2\Big] \\
&= \frac{1}{2}\mathbb{E}_{q_Ïƒ(\tilde{x}|x)}\mathbb{E}_{q_{data}(x)}
\Big[\Big\Vert s_{\theta}( \tilde{x},\sigma ) + \frac{\tilde{x}-x}{Ïƒ^2}\Big\Vert_2^2\Big] \\ 
&= \frac{1}{2}\mathbb{E}_{q_{data}(x)}\mathbb{E}_{\tilde{x} \sim \mathcal{N}(\tilde{x}|x,Ïƒ^2I)}
\Big[\Big\Vert s_{\theta}( \tilde{x},\sigma ) + \frac{\tilde{x}-x}{Ïƒ^2}\Big\Vert_2^2\Big] \tag{2.14} \\
&= \frac{1}{2}\mathbb{E}_{q_{data}(x)}\mathbb{E}_{\tilde{x} \sim \mathcal{N}(\tilde{x}|x,Ïƒ^2I)}
\Big[\Big\Vert s_{\theta}( \tilde{x},\sigma ) + \frac{\epsilon}{Ïƒ}\Big\Vert_2^2\Big]  \\
& =\mathcal{l}(\theta;\sigma) \tag{2.15}
\end{align}
$$
è¿™ç§ä¼˜åŒ–æ–¹æ³•å¯ä»¥å¥—å›VDMä¼˜åŒ–æ¨¡å¼ï¼Œä½†æ˜¯ä¸å¤ªç›´è§‚ã€‚æˆ‘ä»¬ä¸‹é¢ä»‹ç»ä¸€ä¸ªæ›´ç›´è§‚çš„æ¨ç†ï¼ŒåŸºäºTweedie å…¬å¼çš„åˆ†æ•°æ¨ç†ã€‚

***
å°è¯•æ€è€ƒï¼šåœ¨å‰æ–‡è®²VDMæ—¶ï¼Œæ˜¯æ–¹å·®ä½æœªçŸ¥ï¼Œè¿™é‡Œè¿˜æ˜¯æ–¹å·®ä½å‚æ•°æœªçŸ¥ã€‚ä»–ä»¬æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆè”ç³»å‘¢ï¼Ÿ
***
### 7.3 åŸºäºåˆ†æ•°ä¼˜åŒ–çš„æ‰©æ•£æ¨¡å‹ï¼ˆTweedie å…¬å¼ï¼‰
ä»‹ç»å®Œâ€œåˆ†æ•°â€çš„åŸºç¡€çŸ¥è¯†ï¼Œæˆ‘ä»¬å›åˆ°æ‰©æ•£æ¨¡å‹çš„ç†è®ºã€‚ä¸ºäº†å¾—å‡ºæ‰©æ•£æ¨¡å‹çš„åˆ†æ•°å‡½æ•°çš„ä¼˜åŒ–ç­–ç•¥ï¼Œæˆ‘ä»¬å¼•å…¥ Tweedie å…¬å¼ã€‚ï¼šTweedie å…¬å¼æ¥è‡ªè´å¶æ–¯ä¼°è®¡ã€‚è´å¶æ–¯ä¼°è®¡çš„é—®é¢˜å®šä¹‰ä¸ºæ ¹æ®ä¸€äº›è§‚æµ‹æ•°æ®Â $ğ‘¥$Â æ¥ä¼°è®¡æœªçŸ¥å‚æ•°Â $ğœƒ$ï¼Œå¦‚æœç”¨å‡æ–¹è¯¯å·®(MSE)æŸå¤±å‡½æ•°æ¥è¡¡é‡ä¼°è®¡çš„å‡†ç¡®æ€§çš„è¯ï¼Œæˆ‘ä»¬å°†é—®é¢˜å»ºæ¨¡ä¸ºï¼š
$$
L= \mathbb{E}[(\hat{\theta}(x)-\theta)^2]
$$
æ•´ä¸ªé—®é¢˜æœ¬è´¨å…¶å®å°±æ˜¯æ±‚è§£ï¼Œ $x$ çš„æ¡ä»¶ä¸‹ï¼Œ $\theta$ å€¼çš„æœŸæœ›ï¼š
$$
\hat{\theta}(x)=\mathbb{E}[\theta|x]=\int \theta p(\theta|x)d\theta \tag{1.120}
$$
è€ŒTweedieå…¬å¼ï¼Œå°±æ˜¯ä¸€ç§ä¼°è®¡ $\theta$ çš„æ–¹æ¡ˆã€‚å‡è®¾ $p(x|\theta)=\mathcal{N}(\theta,\sigma^2)$ï¼Œå¯ä»¥é€šè¿‡è§‚æµ‹æ•°æ®ä¼°è®¡å‡ºå‚æ•°ğœï¼Œåˆ™æœ‰ï¼š
$$
\begin{align}
\hat{\theta}(x)=\mathbb{E}[\theta|x] &=\int \theta p(\theta|x)d\theta \\
&= x+\sigma^2\frac{d}{dx} \log p(x) \tag{1.121}
\end{align}
$$
è¿™ä¸ªå…¬å¼çš„ä¼˜ç‚¹æ˜¯ä¸€ç›´ä¿æœ‰ç€ $ğ‘(ğœƒ)$Â çš„é›å½¢è€Œæ²¡æœ‰æ¢ç©¶å®ƒçš„å…·ä½“æ ·å­ã€‚æ­¤å…¬å¼ä¸“ä¾›å·²çŸ¥æ–¹å·®ï¼Œæ±‚ä¸å‡ºæ¥å‡å€¼æ—¶ä½¿ç”¨ã€‚ä»æ•°å­¦ä¸Šè®²ï¼Œå¯¹äºæ»¡è¶³é«˜æ–¯åˆ†å¸ƒçš„å˜é‡Â $ğ‘§ \sim \mathcal{ğ‘}(ğ‘§;Î¼_ğ‘§,Î£_ğ‘§)$ï¼ŒTweedie å…¬å¼å¦‚ä¸‹ï¼š
$$
\mathbb{E}[ğœ‡_z|z]=z+ğ›´_z âˆ‡_z \logâ¡ p(z) \tag{1.122}
$$
æ­¤æ—¶æˆ‘ä»¬æ„é€ å‡ºäº†â€åˆ†æ•°â€œå…¬å¼ã€‚æˆ‘ä»¬ä»å‰æ–‡çš„æ¨ç† $q(x_t|x_0)=\mathcal{N}(x_t;\sqrt{\bar{\alpha}_t}x_0,(1-\bar{\alpha}_t)I)$ å¼€å§‹ï¼Œå°è¯•å°†ä¸Šé¢çš„æ¨è®ºç”¨åˆ°ä¹‹å‰VDMçš„æ¨ç†ã€‚åˆ©ç”¨Tweedieå…¬å¼ï¼Œæˆ‘ä»¬å¾—å‡ºï¼š
$$
\mathbb{ğ¸}[ğœ‡_{x_t}|x_t]=x_t+(1-\bar{\alpha}_t)âˆ‡_{x_t} \logâ¡ ğ‘(x_t) \tag{1.123}
$$
è¿™ä¹ˆåšçš„ç›®çš„æ˜¯æˆ‘ä»¬å‘ç°å…¬å¼ $q(x_t|x_0)=\mathcal{N}(x_t;\sqrt{\bar{\alpha}_t}x_0,(1-\bar{\alpha}_t)I)$  é‡Œé¢â€œæ–¹å·®å¾ˆå¥½æ±‚ï¼Œå‡å€¼å¤ªéš¾æ±‚ï¼ˆå› ä¸ºæœ‰$x_0$ï¼‰â€œã€‚æˆ‘ä»¬æœ‰å¿…è¦é¿å…è¾ƒå°‘å¯¹å‡å€¼çš„çš„ä½¿ç”¨ï¼Œå¦‚æœ‰å¿…è¦è¿˜éœ€è¦å¯¹å‡å€¼ç»™å‡ºä¸€ç§æ–°çš„å½¢å¼ã€‚ä¸ºäº†ç¬¦å·çš„ç®€æ´æ€§ï¼Œæˆ‘ä»¬å°† $âˆ‡_{x_t}\log p(x_t)$ å†™ä¸º $âˆ‡ \log p(x_t)$Â ã€‚æ ¹æ® Tweedie å…¬å¼ï¼Œç”± $ğ‘¥_ğ‘¡$ ç”Ÿæˆçš„çœŸå®å‡å€¼ $Î¼_{ğ‘¥_ğ‘¡}=\sqrt{\bar{Î±}_t}ğ‘¥_0$ ï¼Œå¯å®šä¹‰ä¸ºï¼š
$$
\begin{align}
\sqrt{\bar{Î±}_t}ğ‘¥_0 &= x_t+(1-\bar{\alpha}_t)âˆ‡_{x_t} \logâ¡ ğ‘(x_t) \tag{1.124} \\
\therefore x_0 &= \frac{x_t+(1-\bar{\alpha}_t)âˆ‡_{x_t} \logâ¡ ğ‘(x_t)} {\sqrt{\bar{Î±}_t}} \tag{1.125}
\end{align}
$$
ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¬å¼ï¼ˆ1.125ï¼‰å†æ¬¡ä»£å…¥æˆ‘ä»¬çš„çœŸå®å»å™ªè½¬ç§»å‡å€¼ $Î¼_ğ‘(ğ‘¥_ğ‘¡,ğ‘¥_0)$å¹¶æ¨å¯¼å‡ºæ–°çš„å½¢å¼ï¼š
$$
\begin{align}
\mu_q(x_t,x_0) &=\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t){{x}}_{0}}{1-\bar{{\alpha}}_{t}} 
\tag{1.126} \\
&= \frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+\sqrt{\bar{{\alpha}}_{t-1}}(1-{\alpha}_t)\frac{x_t+(1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t)} {\sqrt{\bar{Î±}_t}} }{1-\bar{{\alpha}}_{t}} \tag{1.127} \\
&= \frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t+(1-{\alpha}_t)\frac{x_t+(1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t)} {\sqrt{Î±_t}} }{1-\bar{\alpha}_{t}} \tag{1.128} \\
&= \frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1}){{x}}_t}{1-\bar{\alpha}_{t}} +
\frac{(1-{\alpha}_t)x_t}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}} + \frac{(1-\alpha_t)(1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t) }{(1-\bar{\alpha}_{t})\sqrt{Î±_t}} \tag{1.129} \\
&= \Big(\frac{\sqrt{{\alpha}_t}(1-\bar{{\alpha}}_{t-1})}{1-\bar{\alpha}_{t}} +
\frac{1-{\alpha}_t}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}} \Big)x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.130} \\
&= \Big(\frac{{\alpha}_t(1-\bar{{\alpha}}_{t-1})}{(1-\bar{\alpha}_{t})\sqrt{{\alpha}_t}} +
\frac{1-{\alpha}_t}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}} \Big)x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.131} \\
&= \frac{{\alpha}_t -\bar{{\alpha}}_{t}+ 1-{\alpha}_t}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}}x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.132} \\
&= \frac{ 1-\bar{{\alpha}}_{t}}{(1-\bar{\alpha}_{t})\sqrt{Î±_t}}x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.133} \\
&= \frac{ 1}{\sqrt{Î±_t}}x_t+ \frac{1-\alpha_t}{\sqrt{Î±_t}}âˆ‡ \logâ¡ ğ‘(x_t) \tag{1.134} \\
\end{align}
$$
å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®è¿‘è§†å»å™ªå‡å€¼ $\mu_\theta(x_t,t)$ ä¸ºï¼š
$$
\mu_\theta(x_t,t) = \frac{1}{\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{1-\bar{{\alpha}}_t}\sqrt{\alpha_t}}s_\theta(x_t,t) \tag{1.135}
$$
ç›¸åº”çš„ä¼˜åŒ–é—®é¢˜å¯ä»¥å˜ä¸ºï¼š
$$
\begin{align}
&~~~~\arg\min_{{{\theta}}} D_{\text{KL}}(q({{x}}_{t-1}|{{x}}_t,{{x}}_0)\Vert p_{{\theta}}({{x}}_{t-1}|{{x}}_t))\\
&=\arg\min_{{{\theta}}} D_{\text{KL}}(\mathcal{N} ({{x}}_{t-1}; Î¼_q, Î£_q(t)) \Vert \mathcal{N} ({{x}}_{t-1}; Î¼_{{\theta}}, Î£_q(t))) \tag{1.136} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert \frac{1}{\sqrt{\alpha_t}}x_t + \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}s_\theta(x_t,t) âˆ’ \frac{1}{\sqrt{\alpha_t}}x_t - \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}âˆ‡ \logâ¡ ğ‘(x_t)\Big\Vert_2^2 \right] \tag{1.137} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert  \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}s_\theta(x_t,t) - \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}âˆ‡ \logâ¡ ğ‘(x_t)\Big\Vert_2^2 \right] \tag{1.138} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \left[ \Big\Vert  \frac{1-{\alpha}_t}{\sqrt{\alpha_t}}(s_\theta(x_t,t) - âˆ‡ \logâ¡ ğ‘(x_t))\Big\Vert_2^2 \right] \tag{1.139} \\
&=\arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \frac{(1-{\alpha}_t)^2}{\alpha_t} \left[\Vert s_\theta(x_t,t) - âˆ‡ \logâ¡ ğ‘(x_t)\Vert_2^2 \right] \tag{1.140} \\
\end{align}
$$
è¿™é‡Œï¼Œ$s_Î¸(x_t, t)$ å¯ä»¥æ˜¯ä¸€ä¸ªç¥ç»ç½‘ç»œï¼Œç”¨æ¥å­¦ä¹ é¢„æµ‹åˆ†æ•°å‡½æ•°ï¼ˆscore functionï¼‰ $âˆ‡_{x_t} \log  p(x_t)$ã€‚ $âˆ‡_{x_t} \log  p(x_t)$ å°±æ˜¯åˆ†æ•°å‡½æ•°ï¼Œ å…¶æ€§è´¨åé¢ä¼šè¯¦ç»†é˜è¿°ã€‚æ•é”çš„è¯»è€…ä¼šæ³¨æ„åˆ°ï¼Œåˆ†æ•°å‡½æ•° $âˆ‡ \logâ¡ p(x_t)$ åœ¨å½¢å¼ä¸Šä¸æºå™ªå£° $ğœ–_0$ éå¸¸ç›¸ä¼¼ã€‚å°†Tweedieå…¬å¼ï¼ˆ1.125ï¼‰ä¸é‡å‚æ•°åŒ–æŠ€å·§å…¬å¼ï¼ˆ1.105ï¼‰ç»“åˆèµ·æ¥ï¼Œå¯ä»¥æ˜ç¡®åœ°å±•ç¤ºè¿™ä¸€ç‚¹ï¼š
$$
\begin{align}
x_0 = \frac{x_t+(1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t)} {\sqrt{\bar{Î±}_t}} &= \frac{x_t-\sqrt{1-\bar{\alpha}_t}\epsilon_0}{\sqrt{\bar{\alpha}_t}} \tag{1.141} \\
\therefore (1-\bar{\alpha}_t)âˆ‡ \logâ¡ ğ‘(x_t) &= -\sqrt{1-\bar{\alpha}_t}\epsilon_0 \tag{1.142} \\
âˆ‡ \logâ¡ ğ‘(x_t) &= - \frac{1}{\sqrt{1-\bar{\alpha}_t}}\epsilon_0 \tag{1.143} \\
\end{align}
$$

ä¸ç®¡æ˜¯ä»éƒä¹‹ä¸‡å…¬å¼å¾—åˆ°çš„
$$
\begin{align}
\nabla _{\tilde{x}} \log q_Ïƒ(\tilde{x}|x) &= - \frac{\epsilon}{ğœ} \\
q(x_t|x_0)&=\mathcal{N}(x_t;\sqrt{\bar{\alpha}_t}x_0,(1-\bar{\alpha}_t)I)
\end{align}
$$
è¿˜æ˜¯Tweedieå…¬å¼å¾—åˆ°çš„ $âˆ‡ \logâ¡ ğ‘(x_t) = - \frac{1}{\sqrt{1-\bar{\alpha}_t}}\epsilon_0$ æˆ‘ä»¬éƒ½èƒ½å¾—åˆ°
$$
\arg\min_{{{\theta}}} D_{\text{KL}}(q({{x}}_{t-1}|{{x}}_t,{{x}}_0)\Vert p_{{\theta}}({{x}}_{t-1}|{{x}}_t)) = \arg\min_{{{\theta}}} \frac{1}{2Ïƒ_q^2 (t)} \frac{(1-{\alpha}_t)^2}{\alpha_t} \left[\Vert s_\theta(x_t,t) + \frac{1}{\sqrt{1-\bar{\alpha}_t}}\epsilon_0 \Vert_2^2 \right]
$$
ä»ç›®å‰æ¥è®²ï¼Œæˆ‘ä»¬ç”¨æ•°å­¦è¯æ˜è¯å®äº†ï¼šå­¦ä¹ ç¥ç»ç½‘ç»œé¢„æµ‹åŸå§‹å›¾åƒ $ğ‘¥_0$ï¼›å­¦ä¹ ç¥ç»ç½‘ç»œé¢„æµ‹æºå™ªå£°Â $ğœ–_0$ï¼›å­¦ä¹ ä¸€å®šå™ªå£°æ°´å¹³ä¸‹çš„å›¾åƒåˆ†æ•°å‡½æ•° $âˆ‡ \logâ¡ p(x_t)$ã€‚éƒ½å¯ä»¥ä¼˜åŒ–VDMå‡½æ•°ã€‚æˆ‘ä»¬åœ¨çœ‹è®ºæ–‡æ—¶å¦‚æœé‡åˆ°æŸäº›äººç”¨ä¸€ç§æ–¹æ³•æ¨ç†ï¼Œè¯·ä¸è¦æƒŠæ…Œã€‚å…¶å®å†…éƒ¨åŸç†æ˜¯ä¸€æ ·çš„ã€‚



[1] Jonathan Ho, Ajay Jain, Pieter Abbeel. Denoising Diffusion Probabilistic Models. arXiv preprint  arXiv:2006.11239v2.
[2] Yang Song, Jascha Sohl-Dickstein, Diederik P. Kingma, Abhishek Kumar, Stefano Ermon, Ben Poole. Score-Based Generative Modeling through Stochastic Differential Equations. arXiv:2011.13456
[3] Yang Song, and Stefano Ermon. Generative Modeling by Estimating Gradients of the Data Distribution. arXiv:1907.05600
[4] Pascal Vincent. A Connection Between Score Matching and Denoising Autoencoders